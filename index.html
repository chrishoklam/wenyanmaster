&lt;!--
   * WenyanMaster - 文言大師之旅 © 2025
   * All rights reserved. Unauthorized copying or reproduction is prohibited.
   --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh-TW&quot;&gt;
   &lt;head&gt;
      &lt;meta charset=&quot;UTF-8&quot;&gt;
      &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
      &lt;title&gt;文言大師之旅&lt;/title&gt;
      &lt;link rel=&quot;manifest&quot; href=&quot;manifest.json&quot;&gt;
      &lt;!-- iOS 额外配置 --&gt;
      &lt;link rel=&quot;apple-touch-icon&quot; href=&quot;https://i.imgur.com/tuMkTTR.png&quot;&gt;
      &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;
      &lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black-translucent&quot;&gt;
      &lt;meta name=&quot;apple-mobile-web-app-title&quot; content=&quot;文言大師之旅&quot;&gt;
      &lt;meta name=&quot;theme-color&quot; content=&quot;#ffffff&quot;&gt;
      &lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;
      &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css&quot;&gt;
      &lt;!-- 添加html2canvas库 - 用于截图功能 --&gt;
      &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js&quot;&gt;&lt;/script&gt;
      &lt;script&gt;
         tailwind.config = {
             darkMode: &#39;class&#39;,
             theme: {
                 extend: {
                     colors: {
                         primary: &#39;#5D5CDE&#39;,
                         /* 遊戲界面顏色 */
                         paper: {
                             light: &#39;#f9f9ec&#39;,
                             dark: &#39;#2a2a2a&#39;
                         }
                     },
                     fontFamily: {
                         &#39;sans&#39;: [&#39;Noto Sans TC&#39;, &#39;sans-serif&#39;],
                         &#39;serif&#39;: [&#39;&quot;Noto Serif TC&quot;&#39;, &#39;serif&#39;],
                     }
                 }
             }
         }
      &lt;/script&gt;
      &lt;style&gt;
         @import url(&#39;https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&amp;family=Noto+Serif+TC:wght@400;500;700&amp;display=swap&#39;);
         body {
         overflow-x: hidden;
         }
         /* 滑塊樣式 */
         input:checked + .slider:before {
           transform: translateX(21px);
         }
         .game-mode-switch-container {
           min-width: 120px;
           justify-content: center;
         }
         /* 8-bit 像素風格頭像樣式 */
         .pixel-avatar {
         image-rendering: pixelated;
         image-rendering: -moz-crisp-edges;
         image-rendering: crisp-edges;
         width: 100%;
         height: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         }
         .avatar-option {
         width: 60px;
         height: 60px;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.2s ease;
         overflow: hidden;
         position: relative;
         border: 2px solid transparent;
         background-color: #f0f0f0;
         }
         .dark .avatar-option {
         background-color: #333;
         }
         .avatar-option:hover {
         transform: scale(1.05);
         box-shadow: 0 3px 8px rgba(0,0,0,0.2);
         }
         .avatar-option.selected {
         border-color: #5D5CDE;
         box-shadow: 0 0 0 2px rgba(93, 92, 222, 0.3);
         }
         .book {
         perspective: 1200px;
         }
         .page {
         transform-origin: center left;
         transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1.000);
         transform-style: preserve-3d;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
         }
         .page.turned {
         transform: rotateY(-180deg);
         }
         .page-content {
         backface-visibility: hidden;
         }
         .page-back {
         backface-visibility: hidden;
         transform: rotateY(180deg);
         }
         .character {
         animation: fadeIn 0.5s ease-in-out;
         text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
         }
         .dark .character {
         text-shadow: 0 2px 5px rgba(255, 255, 255, 0.2);
         }
         .option-btn {
         transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
         animation: flyIn 0.6s cubic-bezier(0.19, 1, 0.22, 1) backwards;
         transform-style: preserve-3d;
         perspective: 1000px;
         position: relative;
         overflow: hidden;
         will-change: transform;
         }
         .option-btn:nth-child(1) { animation-delay: 0s; }
         .option-btn:nth-child(2) { animation-delay: 0.1s; }
         .option-btn:nth-child(3) { animation-delay: 0.2s; }
         .option-btn:before {
         content: &#39;&#39;;
         position: absolute;
         top: -50%;
         left: -50%;
         width: 200%;
         height: 200%;
         background: linear-gradient(
         to bottom right,
         rgba(255, 255, 255, 0.3) 0%,
         rgba(255, 255, 255, 0) 50%,
         rgba(255, 255, 255, 0) 100%
         );
         transform: rotate(30deg);
         transition: transform 0.7s;
         }
         .option-btn:hover:before {
         transform: rotate(30deg) translate(10%, 10%);
         }
         .option-btn:hover {
         transform: translateY(-3px) translateZ(20px) rotateX(10deg);
         box-shadow: 0 15px 25px rgba(0, 0, 0, 0.4);
         }
         @keyframes flyIn {
         0% {
         opacity: 0;
         transform: translateZ(-300px) scale(0.5) rotateX(20deg);
         }
         70% {
         opacity: 1;
         transform: translateZ(50px) scale(1.05) rotateX(-5deg);
         }
         100% {
         transform: translateZ(0) scale(1) rotateX(0);
         }
         }
         .option-btn.correct {
         background-color: rgba(34, 197, 94, 0.8);
         color: white;
         animation: correct-pulse 0.5s ease-in-out;
         }
         @keyframes correct-pulse {
         0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
         50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
         100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
         }
         .option-btn.incorrect {
         background-color: rgba(239, 68, 68, 0.8);
         color: white;
         animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
         }
         @keyframes shake {
         10%, 90% { transform: translate3d(-1px, 0, 0); }
         20%, 80% { transform: translate3d(2px, 0, 0); }
         30%, 50%, 70% { transform: translate3d(-3px, 0, 0); }
         40%, 60% { transform: translate3d(3px, 0, 0); }
         }
         .dark .option-btn {
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
         }
         .dark .page {
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
         }
         /* 統一動畫定義 */
         /* 淡入淡出動畫 */
         @keyframes fadeIn {
         from { opacity: 0; transform: translateY(10px); }
         to { opacity: 1; transform: translateY(0); }
         }
         @keyframes fadeOut {
         from { opacity: 1; }
         to { opacity: 0; }
         }
         @keyframes fadeInOut {
         0% { opacity: 0; transform: translate(-50%, -20px); }
         15% { opacity: 1; transform: translate(-50%, 0); }
         85% { opacity: 1; transform: translate(-50%, 0); }
         100% { opacity: 0; transform: translate(-50%, -20px); }
         }
         /* 震動效果 */
         @keyframes screen-shake {
         0%, 100% { transform: translateX(0); }
         10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
         20%, 40%, 60%, 80% { transform: translateX(5px); }
         }
         @keyframes game-over-shake {
         0%, 100% { transform: translateX(0); }
         10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
         20%, 40%, 60%, 80% { transform: translateX(10px); }
         }
         /* 脈動效果 */
         @keyframes heart-pulse {
         0% { transform: scale(1); }
         50% { transform: scale(1.2); }
         100% { transform: scale(1); }
         }
         @keyframes countdownPulse {
         0% { transform: scale(1.2); opacity: 0.5; }
         50% { transform: scale(1.5); opacity: 1; }
         100% { transform: scale(1); opacity: 0.7; }
         }
         @keyframes correct-pulse {
         0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
         50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
         100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
         }
         /* 特效動畫 */
         @keyframes bounce {
         0%, 100% { transform: translateY(0); }
         50% { transform: translateY(-10px); }
         }
         @keyframes inkSplash {
         0% { transform: scale(0); opacity: 0.8; }
         70% { opacity: 0.3; }
         100% { transform: scale(15); opacity: 0; }
         }
         @keyframes flyIn {
         0% {
         opacity: 0;
         transform: translateZ(-300px) scale(0.5) rotateX(20deg);
         }
         70% {
         opacity: 1;
         transform: translateZ(50px) scale(1.05) rotateX(-5deg);
         }
         100% {
         transform: translateZ(0) scale(1) rotateX(0);
         }
         }
         @keyframes pauseMenuAppear {
         from { opacity: 0; transform: scale(0.9); }
         to { opacity: 1; transform: scale(1); }
         }
         /* 動畫類 */
         .fade-out {
         animation: fadeOut 0.5s ease forwards;
         }
         .screen-shake {
         animation: screen-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
         }
         .game-over-shake {
         animation: game-over-shake 0.8s ease-in-out;
         }
         .animate-pulse {
         animation: heart-pulse 1.5s ease-in-out infinite;
         }
         .animate-bounce {
         animation: bounce 1s ease infinite;
         }
         .pause-countdown-number {
         animation: countdownPulse 1s ease-out;
         }
         /* 墨滴效果 - 使用CSS變量 */
         :root {
         --ink-drop-color: rgba(0, 0, 0, 0.7);
         --ink-drop-color-dark: rgba(255, 255, 255, 0.5);
         --ink-animation-duration: 2s;
         --ink-animation-timing: cubic-bezier(0.165, 0.84, 0.44, 1);
         }
         .ink-drop {
         position: absolute;
         top: 0;
         left: 0;
         width: 10px;
         height: 10px;
         border-radius: 50%;
         background-color: var(--ink-drop-color);
         opacity: 0;
         transform: scale(0);
         animation: inkSplash var(--ink-animation-duration) var(--ink-animation-timing) forwards;
         }
         .dark .ink-drop {
         background-color: var(--ink-drop-color-dark);
         }
         /* 3D书本 */
         .book {
         transform-style: preserve-3d;
         }
         .book:after {
         content: &#39;&#39;;
         position: absolute;
         top: 0;
         right: 0;
         bottom: 0;
         width: 30px;
         background: linear-gradient(to right, rgba(0,0,0,0.1), rgba(0,0,0,0.4));
         transform: translateX(100%) rotateY(90deg);
         transform-origin: left;
         }
         /* 成就徽章樣式 */
         .achievement-seal {
         width: 80px;
         height: 80px;
         position: relative;
         display: inline-flex;
         justify-content: center;
         align-items: center;
         margin: 0 0px 0px;
         transform: rotate(-5deg);
         }
         .achievement-seal svg {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         }
         .seal-text {
         position: relative;
         z-index: 5;
         font-family: &#39;Noto Serif TC&#39;, serif;
         font-weight: bold;
         text-align: center;
         display: flex;
         flex-direction: column;
         color: #fff;
         line-height: 1.2;
         }
         .seal-title {
         font-size: 14px;
         margin-bottom: 2px;
         }
         .seal-desc {
         font-size: 10px;
         opacity: 0.9;
         }
         .achievements-container {
         display: flex;
         flex-wrap: wrap;
         justify-content: center;
         margin-bottom: 10px;
         }
         /* 暫停菜單動畫 */
         @keyframes pauseMenuAppear {
         from { opacity: 0; transform: scale(0.9); }
         to { opacity: 1; transform: scale(1); }
         }
         #pause-overlay &gt; div {
         animation: pauseMenuAppear 0.3s ease-out;
         }
         /* 倒計時數字動畫 */
         .pause-countdown-number {
         animation: countdownPulse 1s ease-out;
         }
         @keyframes countdownPulse {
         0% { transform: scale(1.2); opacity: 0.5; }
         50% { transform: scale(1.5); opacity: 1; }
         100% { transform: scale(1); opacity: 0.7; }
         }
         /* 優化篇章列表和段落選擇器的滾動條樣式 */
         #passage-list, #paragraph-list, .paragraph-options {
         scrollbar-width: thin;
         scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
         }
         #passage-list::-webkit-scrollbar, #paragraph-list::-webkit-scrollbar, .paragraph-options::-webkit-scrollbar {
         width: 6px;
         }
         #passage-list::-webkit-scrollbar-track, #paragraph-list::-webkit-scrollbar-track, .paragraph-options::-webkit-scrollbar-track {
         background: transparent;
         }
         #passage-list::-webkit-scrollbar-thumb, #paragraph-list::-webkit-scrollbar-thumb, .paragraph-options::-webkit-scrollbar-thumb {
         background-color: rgba(156, 163, 175, 0.5);
         border-radius: 6px;
         }
         /* 確保篇章和段落選擇器有合適的內距 */
         .passage-item, #paragraph-list &gt; div {
         padding: 0.5rem;
         margin-bottom: 0.25rem;
         }
         /* 確保可見性指示器 */
         .passage-item.hidden, #paragraph-selector.hidden {
         display: none;
         }
         /* 優化段落選項容器 */
         .paragraph-options {
         max-height: 300px;
         overflow-y: auto;
         margin-bottom: 10px;
         padding-right: 10px;
         }
         /* 改進確定按鈕樣式和位置 */
         #confirm-paragraphs {
         position: sticky;
         bottom: 0;
         margin-top: 10px;
         width: 100%;
         padding: 8px;
         font-weight: 500;
         box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
         }
      &lt;/style&gt;
      &lt;!-- 慶祝動畫和載入動畫樣式 --&gt;
      &lt;style&gt;
         #confetti-canvas {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         pointer-events: none;
         z-index: 100;
         }
         /* 墨水擴散動畫樣式 - 簡化版 */
         #loading-container {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(245, 242, 234, 1); /* 完全不透明背景 */
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 9999; /* 更高的 z-index 確保覆蓋所有元素 */
         opacity: 0;
         animation: fadeIn 0.15s ease forwards;
         overflow: hidden;
         }
         #main-splash {
         position: absolute;
         width: 220px;
         height: 220px;
         top: 50%;
         left: 50%;
         background-color: rgba(0, 0, 0, 0.85);
         border-radius: 50%;
         transform-origin: center;
         transform: translate(-50%, -50%) scale(0);
         opacity: 0;
         animation: mainSplash 0.8s cubic-bezier(0.19, 1, 0.22, 1) forwards;
         }
         @keyframes mainSplash {
         0% { 
         transform: translate(-50%, -50%) scale(0); 
         opacity: 0.9;
         border-radius: 50%;
         }
         20% { 
         opacity: 0.8;
         }
         100% { 
         transform: translate(-50%, -50%) scale(4.5); 
         opacity: 0;
         border-radius: 48%;
         }
         }
         @keyframes fadeIn {
         from { opacity: 0; }
         to { opacity: 1; }
         }
         @keyframes fadeOut {
         from { opacity: 1; }
         to { opacity: 0; }
         }
         .fade-out {
         animation: fadeOut 0.5s ease forwards;
         }
         /* 啟動界面樣式 */
         #start-screen {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-image: url(&#39;https://i.imgur.com/ACyJYTg.png&#39;);
         background-color: rgba(0, 0, 0, 0.7);
         background-blend-mode: overlay;
         background-size: cover;
         background-position: center;
         display: flex;
         flex-direction: column;
         justify-content: center;
         align-items: center;
         z-index: 10000;
         transition: opacity 0.8s ease;
         }
         .start-title {
         font-size: 2.5rem;
         font-weight: bold;
         color: white;
         text-align: center;
         margin-bottom: 3rem;
         text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
         line-height: 1.3;
         }
         .start-button {
         position: relative;
         padding: 0.8rem 2.5rem;
         color: white;
         border: none;
         font-size: 1.25rem;
         font-weight: 500;
         cursor: pointer;
         transition: all 0.3s ease;
         margin-bottom: 2.5rem;
         /* 純黑白水墨風格 */
         background-color: rgba(0, 0, 0, 0.9);
         border-radius: 0.5rem;
         overflow: hidden;
         /* 簡潔陰影 */
         box-shadow: 
         0 4px 10px rgba(0, 0, 0, 0.4),
         inset 0 0 3px rgba(255, 255, 255, 0.15);
         /* 添加毛筆邊緣效果 */
         border: 1px solid rgba(255, 255, 255, 0.1);
         }
         .start-button::before {
         content: &#39;&#39;;
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         /* 輕微的黑白變化，模擬墨跡濃淡 */
         background: 
         radial-gradient(ellipse at top left, rgba(60, 60, 60, 0.5) 0%, transparent 70%),
         radial-gradient(ellipse at bottom right, rgba(20, 20, 20, 0.8) 0%, transparent 70%);
         opacity: 0.7;
         z-index: -1;
         }
         .start-button::after {
         content: &#39;&#39;;
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         /* 水墨紋理效果 */
         background-image: url(&#39;data:image/svg+xml;utf8,
         &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;100&quot; height=&quot;100&quot; viewBox=&quot;0 0 100 100&quot;&gt;
            &lt;filter id=&quot;noise&quot;&gt;
               &lt;feTurbulence type=&quot;fractalNoise&quot; baseFrequency=&quot;0.8&quot; numOctaves=&quot;2&quot; stitchTiles=&quot;stitch&quot;/&gt;
               &lt;feColorMatrix type=&quot;matrix&quot; values=&quot;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.3 0&quot;/&gt;
            &lt;/filter&gt;
            &lt;rect width=&quot;100%&quot; height=&quot;100%&quot; filter=&quot;url(%23noise)&quot;/&gt;
         &lt;/svg&gt;
         &#39;);
         opacity: 0.07;
         mix-blend-mode: overlay;
         z-index: -1;
         pointer-events: none;
         }
         .start-button:hover {
         transform: translateY(-2px);
         box-shadow: 
         0 6px 12px rgba(0, 0, 0, 0.5),
         inset 0 0 5px rgba(255, 255, 255, 0.2);
         /* 懸停時變暗一點，模擬墨色加深 */
         background-color: rgba(0, 0, 0, 1);
         }
         .start-button:active {
         transform: translateY(0);
         box-shadow: 
         0 2px 6px rgba(0, 0, 0, 0.4),
         inset 0 0 3px rgba(255, 255, 255, 0.1);
         }
         .version-info {
         color: rgba(255, 255, 255, 0.8);
         font-size: 0.9rem;
         }
      &lt;/style&gt;
   &lt;/head&gt;
   &lt;body class=&quot;bg-white font-serif min-h-screen bg-cover bg-center bg-fixed&quot; style=&quot;background-image: url(&#39;https://i.imgur.com/ACyJYTg.png&#39;); background-color: rgba(255, 255, 255, 0.8); background-blend-mode: overlay;&quot;&gt;
      &lt;!-- 啟動界面 --&gt;
      &lt;div id=&quot;start-screen&quot; class=&quot;fixed inset-0 z-50 flex flex-col items-center justify-center bg-cover bg-center&quot; style=&quot;background-image: url(&#39;https://i.imgur.com/ACyJYTg.png&#39;); background-color: rgba(0, 0, 0, 0.7); background-blend-mode: overlay;&quot;&gt;
         &lt;div class=&quot;text-center p-8 max-w-xl&quot;&gt;
            &lt;h1 class=&quot;start-title mb-10 text-4xl md:text-5xl font-bold text-white leading-tight drop-shadow-lg&quot;&gt;文言大師之旅&lt;/h1&gt;
            &lt;button id=&quot;start-journey-btn&quot; class=&quot;start-button text-xl font-medium px-8 py-3 bg-primary hover:bg-primary/90 text-white rounded-lg transform transition hover:scale-105&quot;&gt;
            進入
            &lt;/button&gt;
            &lt;p class=&quot;version-info mt-10 text-white/70 text-sm&quot;&gt;v1.4.3&lt;/p&gt;
         &lt;/div&gt;
      &lt;/div&gt;
      &lt;!-- 暫停菜單覆蓋層 - 改進按鈕垂直居中 --&gt;
      &lt;div id=&quot;pause-overlay&quot; class=&quot;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden&quot;&gt;
         &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-8 py-12 max-w-sm w-full mx-4 flex flex-col items-center justify-center&quot;&gt;
            &lt;div id=&quot;pause-buttons&quot; class=&quot;flex justify-center gap-8 mb-8&quot;&gt;
               &lt;button id=&quot;restart-from-pause-btn&quot; class=&quot;w-16 h-16 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors flex items-center justify-center text-xl&quot; title=&quot;重新開始&quot;&gt;
               &lt;i class=&quot;fas fa-redo&quot;&gt;&lt;/i&gt;
               &lt;/button&gt;
               &lt;button id=&quot;continue-btn&quot; class=&quot;w-16 h-16 bg-primary text-white rounded-full hover:bg-opacity-90 flex items-center justify-center text-xl&quot; title=&quot;繼續遊戲&quot;&gt;
               &lt;i class=&quot;fas fa-play&quot;&gt;&lt;/i&gt;
               &lt;/button&gt;
               &lt;button id=&quot;return-home-btn&quot; class=&quot;w-16 h-16 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors flex items-center justify-center text-xl&quot; title=&quot;返回主頁&quot;&gt;
               &lt;i class=&quot;fas fa-home&quot;&gt;&lt;/i&gt;
               &lt;/button&gt;
            &lt;/div&gt;
            &lt;!-- 隱藏的倒計時顯示 --&gt;
            &lt;div id=&quot;countdown-resume&quot; class=&quot;hidden text-center&quot;&gt;
               &lt;p class=&quot;text-gray-600 dark:text-gray-300 mb-3&quot;&gt;遊戲將在以下時間後繼續&lt;/p&gt;
               &lt;div class=&quot;text-4xl font-bold text-primary pause-countdown-number&quot;&gt;3&lt;/div&gt;
            &lt;/div&gt;
         &lt;/div&gt;
      &lt;/div&gt;
      &lt;!-- 設置按鈕 - 絕對固定不滾動 --&gt;
      &lt;div id=&quot;settings-button&quot; style=&quot;position: fixed; top: 16px; left: 16px; width: 48px; height: 48px; background-color: #92400e; color: white; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 9999; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s;&quot;&gt;
         &lt;i class=&quot;fas fa-cog text-xl&quot;&gt;&lt;/i&gt;
      &lt;/div&gt;
      &lt;!-- 設置菜單 --&gt;
      &lt;div id=&quot;settings-menu&quot; class=&quot;fixed top-0 left-0 w-full h-full bg-black bg-opacity-70 flex items-center justify-center z-50 hidden&quot;&gt;
         &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4&quot;&gt;
            &lt;div class=&quot;flex justify-between items-center mb-6&quot;&gt;
               &lt;h2 class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100&quot;&gt;設置&lt;/h2&gt;
               &lt;button id=&quot;close-settings&quot; class=&quot;text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100&quot;&gt;
               &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
               &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col gap-3&quot;&gt;
               &lt;button data-section=&quot;help&quot; class=&quot;settings-option py-3 px-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center hover:bg-gray-100 dark:hover:bg-gray-600&quot;&gt;
               &lt;i class=&quot;fas fa-question-circle text-primary mr-3&quot;&gt;&lt;/i&gt;
               &lt;span class=&quot;text-gray-800 dark:text-gray-200 font-semibold&quot;&gt;遊玩說明&lt;/span&gt;
               &lt;/button&gt;
               &lt;button data-section=&quot;records&quot; class=&quot;settings-option py-3 px-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center hover:bg-gray-100 dark:hover:bg-gray-600&quot;&gt;
               &lt;i class=&quot;fas fa-trophy text-amber-500 mr-3&quot;&gt;&lt;/i&gt;
               &lt;span class=&quot;text-gray-800 dark:text-gray-200 font-semibold&quot;&gt;我的記錄&lt;/span&gt;
               &lt;/button&gt;
               &lt;button data-section=&quot;achievements&quot; class=&quot;settings-option py-3 px-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center hover:bg-gray-100 dark:hover:bg-gray-600&quot;&gt;
               &lt;i class=&quot;fas fa-medal text-yellow-500 mr-3&quot;&gt;&lt;/i&gt;
               &lt;span class=&quot;text-gray-800 dark:text-gray-200 font-semibold&quot;&gt;歷史成就&lt;/span&gt;
               &lt;/button&gt;
               &lt;button data-section=&quot;saveload&quot; class=&quot;settings-option py-3 px-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center hover:bg-gray-100 dark:hover:bg-gray-600&quot;&gt;
               &lt;i class=&quot;fas fa-save text-cyan-500 mr-3&quot;&gt;&lt;/i&gt;
               &lt;span class=&quot;text-gray-800 dark:text-gray-200 font-semibold&quot;&gt;保存及載入進度&lt;/span&gt;
               &lt;/button&gt;
               &lt;button data-section=&quot;version&quot; class=&quot;settings-option py-3 px-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center hover:bg-gray-100 dark:hover:bg-gray-600&quot;&gt;
               &lt;i class=&quot;fas fa-code-branch text-green-500 mr-3&quot;&gt;&lt;/i&gt;
               &lt;span class=&quot;text-gray-800 dark:text-gray-200 font-semibold&quot;&gt;版本資訊&lt;/span&gt;
               &lt;/button&gt;
               &lt;button data-section=&quot;about&quot; class=&quot;settings-option py-3 px-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center hover:bg-gray-100 dark:hover:bg-gray-600&quot;&gt;
               &lt;i class=&quot;fas fa-user text-blue-500 mr-3&quot;&gt;&lt;/i&gt;
               &lt;span class=&quot;text-gray-800 dark:text-gray-200 font-semibold&quot;&gt;關於製作者&lt;/span&gt;
               &lt;/button&gt;
            &lt;/div&gt;
         &lt;/div&gt;
      &lt;/div&gt;
      &lt;!-- 詳細信息模態框 --&gt;
      &lt;div id=&quot;info-modal&quot; class=&quot;fixed top-0 left-0 w-full h-full bg-black bg-opacity-70 flex items-center justify-center z-50 hidden&quot;&gt;
         &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg max-w-lg w-full mx-4 max-h-[80vh] flex flex-col&quot;&gt;
            &lt;!-- 固定在頂部的標題欄，不參與滾動 --&gt;
            &lt;div class=&quot;flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-20 shadow-sm&quot;&gt;
               &lt;h3 id=&quot;info-modal-title&quot; class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100&quot;&gt;&lt;/h3&gt;
               &lt;button id=&quot;close-info-modal&quot; class=&quot;text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100&quot;&gt;
               &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
               &lt;/button&gt;
            &lt;/div&gt;
            &lt;!-- 內容區域可滾動 --&gt;
            &lt;div class=&quot;overflow-y-auto p-6 pt-2 flex-1&quot;&gt;
               &lt;div id=&quot;info-modal-content&quot; class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
         &lt;/div&gt;
      &lt;/div&gt;
      &lt;!-- 頭像選擇模態框 --&gt;
      &lt;div id=&quot;avatar-selector-modal&quot; class=&quot;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden&quot;&gt;
         &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-5 max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto&quot;&gt;
            &lt;div class=&quot;flex justify-between items-center mb-4&quot;&gt;
               &lt;h3 class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100&quot;&gt;選擇頭像&lt;/h3&gt;
               &lt;button id=&quot;close-avatar-selector&quot; class=&quot;text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100&quot;&gt;
               &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
               &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class=&quot;grid grid-cols-4 gap-3 md:grid-cols-5 md:gap-4&quot; id=&quot;avatar-grid&quot;&gt;
               &lt;!-- 頭像會通過JS動態生成 --&gt;
            &lt;/div&gt;
         &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;container mx-auto px-4 pt-16 pb-8 max-w-2xl&quot;&gt;
         &lt;header class=&quot;mb-8 text-center&quot;&gt;
            &lt;h1 class=&quot;text-3xl md:text-4xl font-bold text-gray-800 dark:text-gray-100 mb-2&quot;&gt;文言大師之旅&lt;/h1&gt;
            &lt;p class=&quot;text-gray-600 dark:text-gray-300 text-m&quot;&gt;踏上屬於自己的征途&lt;/p&gt;
         &lt;/header&gt;
         &lt;div class=&quot;passage-selector mb-6&quot;&gt;
            &lt;div id=&quot;passage-container&quot; class=&quot;bg-amber-800 rounded-lg overflow-hidden transition-all duration-300 shadow-md z-50&quot; style=&quot;max-height: 46px;&quot;&gt;
               &lt;div id=&quot;passage-header&quot; class=&quot;flex justify-between items-center cursor-pointer p-3 text-white&quot;&gt;
                  &lt;h3 class=&quot;text-lg font-medium&quot;&gt;選擇篇章&lt;/h3&gt;
                  &lt;i id=&quot;passage-toggle&quot; class=&quot;fas fa-chevron-down transition-transform duration-300&quot;&gt;&lt;/i&gt;
               &lt;/div&gt;
               &lt;div id=&quot;passage-content&quot; class=&quot;px-3 pb-3 hidden&quot;&gt;
                  &lt;div class=&quot;categories mb-3 flex flex-wrap gap-2 justify-between&quot;&gt;
                     &lt;button class=&quot;category-btn p-2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 rounded-md hover:bg-amber-200 dark:hover:bg-amber-700 text-sm flex-1&quot; data-category=&quot;中一&quot;&gt;中一&lt;/button&gt;
                     &lt;button class=&quot;category-btn p-2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 rounded-md hover:bg-amber-200 dark:hover:bg-amber-700 text-sm flex-1&quot; data-category=&quot;中二&quot;&gt;中二&lt;/button&gt;
                     &lt;button class=&quot;category-btn p-2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 rounded-md hover:bg-amber-200 dark:hover:bg-amber-700 text-sm flex-1&quot; data-category=&quot;中三&quot;&gt;中三&lt;/button&gt;
                     &lt;button class=&quot;category-btn p-2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 rounded-md hover:bg-amber-200 dark:hover:bg-amber-700 text-sm flex-1&quot; data-category=&quot;指定文言&quot;&gt;指定文言&lt;/button&gt;
                     &lt;button class=&quot;category-btn p-2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 rounded-md hover:bg-amber-200 dark:hover:bg-amber-700 text-sm flex-1&quot; data-category=&quot;文學&quot;&gt;文學&lt;/button&gt;
                     &lt;button class=&quot;category-btn p-2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 rounded-md hover:bg-amber-200 dark:hover:bg-amber-700 text-sm flex-1&quot; data-category=&quot;其他&quot;&gt;其他&lt;/button&gt;
                  &lt;/div&gt;
                  &lt;div id=&quot;passage-list&quot; class=&quot;bg-white dark:bg-gray-800 rounded-md p-2 max-h-60 overflow-y-auto&quot;&gt;
                     &lt;!-- 篇章項目會在初始化時自動生成 --&gt;
                     &lt;!-- 空分類提示信息 --&gt;
                     &lt;div id=&quot;empty-category-message&quot; class=&quot;p-4 text-center hidden&quot;&gt;
                        &lt;i class=&quot;fas fa-info-circle text-amber-500 text-xl mb-2&quot;&gt;&lt;/i&gt;
                        &lt;p class=&quot;text-gray-600 dark:text-gray-300&quot;&gt;此分類暫無篇章，請選擇其他分類&lt;/p&gt;
                     &lt;/div&gt;
                  &lt;/div&gt;
                  &lt;!--選擇區域段落 (默認隱藏) --&gt;
                  &lt;div id=&quot;paragraph-selector&quot; class=&quot;mt-3 bg-white dark:bg-gray-800 rounded-md p-3 hidden&quot;&gt;
                     &lt;p class=&quot;text-gray-700 dark:text-gray-300 mb-2 font-medium&quot;&gt;選擇背誦段落：&lt;/p&gt;
                     &lt;div id=&quot;paragraph-list&quot; class=&quot;space-y-2&quot;&gt;
                        &lt;!-- 段落選項將在選擇篇章後動態生成 --&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;mt-3&quot;&gt;
                        &lt;button id=&quot;confirm-paragraphs&quot; class=&quot;px-3 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 text-base font-medium w-full&quot;&gt;
                        確定
                        &lt;/button&gt;
                     &lt;/div&gt;
                  &lt;/div&gt;
               &lt;/div&gt;
            &lt;/div&gt;
         &lt;/div&gt;
         &lt;div class=&quot;book relative mb-8&quot;&gt;
            &lt;!-- 用戶資料容器 - 修改成與遊戲頁面相似大小 --&gt;
            &lt;div id=&quot;user-profile-container&quot; class=&quot;page rounded-lg overflow-hidden bg-white dark:bg-gray-800 p-6 md:p-8 min-h-[400px] shadow-md&quot;&gt;
               &lt;div class=&quot;flex flex-col h-full justify-center items-center&quot;&gt;
                  &lt;div id=&quot;change-avatar-btn&quot; class=&quot;user-avatar-container w-24 h-24 md:w-32 md:h-32 bg-amber-100 dark:bg-amber-800 rounded-full flex items-center justify-center mb-6 relative cursor-pointer hover:shadow-lg transition-shadow&quot;&gt;
                     &lt;div id=&quot;user-avatar&quot; class=&quot;w-full h-full flex items-center justify-center overflow-hidden&quot;&gt;
                        &lt;!-- 默認頭像 --&gt;
                        &lt;i class=&quot;fas fa-user text-4xl md:text-5xl text-amber-800 dark:text-amber-100&quot;&gt;&lt;/i&gt;
                     &lt;/div&gt;
                  &lt;/div&gt;
                  &lt;div class=&quot;text-center w-full max-w-md&quot;&gt;
                     &lt;div class=&quot;flex justify-center items-center gap-3 mb-4&quot;&gt;
                        &lt;!-- 顯示模式 --&gt;
                        &lt;div id=&quot;name-display-mode&quot; class=&quot;flex items-center&quot;&gt;
                           &lt;h3 id=&quot;user-name&quot; class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100&quot;&gt;文言大師&lt;/h3&gt;
                           &lt;button id=&quot;edit-name-btn&quot; class=&quot;ml-2 w-7 h-7 flex items-center justify-center bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary transition-colors&quot;&gt;
                           &lt;i class=&quot;fas fa-pen text-xs&quot;&gt;&lt;/i&gt;
                           &lt;/button&gt;
                        &lt;/div&gt;
                        &lt;!-- 編輯模式 (默認隱藏) --&gt;
                        &lt;div id=&quot;name-edit-mode&quot; class=&quot;flex flex-col items-center gap-2 hidden w-full max-w-xs mx-auto&quot;&gt;
                           &lt;div class=&quot;w-full relative&quot;&gt;
                              &lt;input type=&quot;text&quot; id=&quot;user-name-input&quot; class=&quot;w-full text-xl font-bold text-gray-800 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 border-2 border-primary/70 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary shadow-sm&quot; maxlength=&quot;12&quot;&gt;
                              &lt;div class=&quot;absolute right-3 bottom-2 text-xs text-gray-500 dark:text-gray-400&quot; id=&quot;char-counter&quot;&gt;0/12&lt;/div&gt;
                           &lt;/div&gt;
                           &lt;div class=&quot;flex gap-3 mt-1&quot;&gt;
                              &lt;button id=&quot;save-name-btn&quot; class=&quot;w-9 h-9 flex items-center justify-center bg-green-500 hover:bg-green-600 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors&quot;&gt;
                              &lt;i class=&quot;fas fa-check&quot;&gt;&lt;/i&gt;
                              &lt;/button&gt;
                              &lt;button id=&quot;cancel-name-btn&quot; class=&quot;w-9 h-9 flex items-center justify-center bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-gray-400 transition-colors&quot;&gt;
                              &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
                              &lt;/button&gt;
                           &lt;/div&gt;
                        &lt;/div&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;w-full mb-4&quot;&gt;
                        &lt;div class=&quot;flex justify-between items-center mb-2&quot;&gt;
                           &lt;div class=&quot;flex items-center&quot;&gt;
                              &lt;span id=&quot;user-level&quot; class=&quot;bg-primary text-white text-sm py-0.5 px-2 rounded-full mr-2&quot;&gt;Lv.1&lt;/span&gt;
                              &lt;span class=&quot;text-sm text-gray-600 dark:text-gray-400&quot;&gt;經驗值&lt;/span&gt;
                           &lt;/div&gt;
                           &lt;span id=&quot;exp-text&quot; class=&quot;text-sm text-gray-600 dark:text-gray-400&quot;&gt;0 / 100&lt;/span&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                           &lt;div id=&quot;exp-bar&quot; class=&quot;h-full bg-amber-500 rounded-full transition-all duration-300&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;
                        &lt;/div&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;mt-6&quot;&gt;
                        &lt;div class=&quot;mb-4&quot;&gt;
                           &lt;h4 class=&quot;text-md font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center justify-between&quot;&gt;
                              成就
                              &lt;button id=&quot;manage-achievements-btn&quot; class=&quot;text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-md px-2 py-1 focus:outline-none transition-colors&quot;&gt;
                              &lt;i class=&quot;fas fa-cog text-xs&quot;&gt;&lt;/i&gt;
                              &lt;/button&gt;
                           &lt;/h4&gt;
                           &lt;div id=&quot;achievements-display&quot; class=&quot;flex justify-center flex-wrap gap-2&quot;&gt;
                              &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-400 italic&quot;&gt;從設置菜單的「歷史成就」中選擇展示&lt;/p&gt;
                           &lt;/div&gt;
                        &lt;/div&gt;
                     &lt;/div&gt;
                  &lt;/div&gt;
               &lt;/div&gt;
            &lt;/div&gt;
            &lt;!-- 遊戲界面容器 --&gt;
            &lt;div id=&quot;game-page&quot; class=&quot;page rounded-lg overflow-hidden hidden&quot;&gt;
               &lt;div class=&quot;page-content bg-paper-light dark:bg-paper-dark p-6 md:p-8 min-h-[400px] flex flex-col justify-between&quot;&gt;
                  &lt;!-- 遊戲控制區域 --&gt;
                  &lt;div class=&quot;flex justify-between items-center mb-4&quot;&gt;
                     &lt;div class=&quot;flex flex-col gap-2&quot;&gt;
                        &lt;!-- 進度條 --&gt;
                        &lt;div class=&quot;w-full max-w-[200px]&quot;&gt;
                           &lt;div class=&quot;flex justify-between items-center text-xs text-gray-600 dark:text-gray-400 mb-1&quot;&gt;
                              &lt;span&gt;進度&lt;/span&gt;
                              &lt;span id=&quot;progress-text&quot;&gt;0 / &lt;span id=&quot;total-chars&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
                           &lt;/div&gt;
                           &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                              &lt;div id=&quot;progress-bar&quot; class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;
                           &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;!-- 生命值 --&gt;
                        &lt;div id=&quot;lives&quot; class=&quot;flex text-red-500 dark:text-red-400 text-2xl&quot;&gt;
                           &lt;i class=&quot;fas fa-heart mx-0.5&quot;&gt;&lt;/i&gt;
                           &lt;i class=&quot;fas fa-heart mx-0.5&quot;&gt;&lt;/i&gt;
                           &lt;i class=&quot;fas fa-heart mx-0.5&quot;&gt;&lt;/i&gt;
                        &lt;/div&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;flex items-center gap-2&quot;&gt;
                        &lt;div id=&quot;stopwatch&quot; class=&quot;text-gray-700 dark:text-gray-300 px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg text-base flex items-center&quot;&gt;
                           &lt;i class=&quot;fas fa-stopwatch mr-2&quot;&gt;&lt;/i&gt;&lt;span id=&quot;timer&quot; class=&quot;font-medium&quot;&gt;00:00.0&lt;/span&gt;
                        &lt;/div&gt;
                        &lt;!-- 暫停按鈕或返回主頁按鈕 --&gt;
                        &lt;button id=&quot;pause-btn&quot; class=&quot;p-2 bg-primary text-white rounded-lg hover:bg-opacity-90 text-xl flex items-center justify-center w-10 h-10&quot; title=&quot;暫停遊戲&quot;&gt;
                        &lt;i class=&quot;fas fa-pause&quot;&gt;&lt;/i&gt;
                        &lt;/button&gt;
                        &lt;button id=&quot;return-home-btn-game&quot; class=&quot;p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-xl flex items-center justify-center w-10 h-10 hidden&quot; title=&quot;返回主頁&quot;&gt;
                        &lt;i class=&quot;fas fa-home&quot;&gt;&lt;/i&gt;
                        &lt;/button&gt;
                     &lt;/div&gt;
                  &lt;/div&gt;
                  &lt;div class=&quot;text-center&quot;&gt;
                     &lt;div class=&quot;passage-info mb-4&quot;&gt;
                        &lt;h2 id=&quot;passage-title&quot; class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100&quot;&gt;《論四端》&lt;/h2&gt;
                        &lt;p id=&quot;passage-author&quot; class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;孟子&lt;/p&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;current-text my-6&quot;&gt;
                        &lt;div id=&quot;game-start-screen&quot; class=&quot;flex flex-col items-center justify-center&quot;&gt;
                           &lt;div class=&quot;flex flex-col items-center justify-center gap-3&quot;&gt;
                              &lt;div class=&quot;flex items-center justify-center gap-3&quot;&gt;
                                 &lt;button id=&quot;start-game-btn&quot; class=&quot;px-6 py-3 bg-primary text-white rounded-lg hover:bg-opacity-90 transform hover:scale-105 transition-transform text-lg&quot;&gt;
                                 開始
                                 &lt;/button&gt;
                                 &lt;button id=&quot;view-full-text-btn&quot; class=&quot;p-3 bg-amber-100 text-amber-800 rounded-lg hover:bg-amber-200 flex items-center justify-center&quot; title=&quot;查看完整文章&quot;&gt;
                                 &lt;i class=&quot;fas fa-search text-xl&quot;&gt;&lt;/i&gt;
                                 &lt;/button&gt;
                              &lt;/div&gt;
                              &lt;!-- 單人/雙人模式切換 - 改為滑塊 --&gt;
                              &lt;div class=&quot;game-mode-switch-container flex items-center my-2&quot;&gt;
                                &lt;span class=&quot;text-sm font-medium text-gray-700 dark:text-gray-300 mr-3&quot;&gt;單人&lt;/span&gt;
                                &lt;label class=&quot;relative inline-block w-14 h-6&quot;&gt;
                                  &lt;input type=&quot;checkbox&quot; id=&quot;game-mode-switch&quot; class=&quot;opacity-0 w-0 h-0&quot;&gt;
                                  &lt;span class=&quot;slider round absolute cursor-pointer inset-0 bg-teal-600 transition-all duration-300 rounded-full before:content-[&#39;&#39;] before:absolute before:h-5 before:w-5 before:left-0.5 before:bottom-0.5 before:bg-white before:rounded-full before:transition before:duration-300&quot;&gt;&lt;/span&gt;
                                &lt;/label&gt;
                                &lt;span class=&quot;text-sm font-medium text-gray-700 dark:text-gray-300 ml-3&quot;&gt;雙人&lt;/span&gt;
                              &lt;/div&gt;
                           &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div id=&quot;game-content&quot; class=&quot;hidden&quot;&gt;
                           &lt;!-- 單人模式遊戲界面 --&gt;
                           &lt;div id=&quot;single-player-ui&quot; class=&quot;flex flex-col items-center justify-center&quot;&gt;
                              &lt;div class=&quot;flex items-center justify-center&quot;&gt;
                                 &lt;div id=&quot;last-answered-chars&quot; class=&quot;text-lg md:text-xl text-gray-700 dark:text-gray-300 whitespace-nowrap overflow-x-auto max-w-full h-12 flex items-center&quot;&gt;&lt;/div&gt;
                                 &lt;div id=&quot;current-char&quot; class=&quot;character text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 min-w-[1.2em] flex items-center justify-center ml-1&quot;&gt;&lt;/div&gt;
                                 &lt;div class=&quot;text-lg text-gray-400 dark:text-gray-500&quot;&gt;...&lt;/div&gt;
                              &lt;/div&gt;
                              &lt;div id=&quot;completed-text&quot; class=&quot;hidden&quot;&gt;&lt;/div&gt;
                           &lt;/div&gt;
                           &lt;!-- 雙人模式遊戲界面 --&gt;
                           &lt;div id=&quot;multiplayer-ui&quot; class=&quot;hidden flex flex-col h-full&quot;&gt;
                              &lt;!-- 上方玩家區域 --&gt;
                              &lt;div id=&quot;player-top&quot; class=&quot;w-full pb-4 mb-2 border-b border-gray-300 dark:border-gray-700 relative&quot; style=&quot;transform: rotate(180deg);&quot;&gt;
                                 &lt;div class=&quot;flex flex-col items-center&quot;&gt;
                                    &lt;!-- 上方玩家控制欄 --&gt;
                                    &lt;div class=&quot;w-full flex justify-between items-center px-4 mb-2&quot;&gt;
                                       &lt;div class=&quot;flex flex-col gap-1 max-w-[150px] w-full&quot;&gt;
                                          &lt;div id=&quot;stopwatch-top&quot; class=&quot;text-gray-700 dark:text-gray-300 px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg text-base flex items-center&quot;&gt;
                                             &lt;i class=&quot;fas fa-stopwatch mr-2&quot;&gt;&lt;/i&gt;&lt;span id=&quot;timer-top&quot; class=&quot;font-medium&quot;&gt;00:00.0&lt;/span&gt;
                                          &lt;/div&gt;
                                          &lt;!-- 上方玩家進度條 --&gt;
                                          &lt;div class=&quot;px-3&quot;&gt;
                                             &lt;div class=&quot;flex justify-between items-center text-xs text-gray-600 dark:text-gray-400&quot;&gt;
                                                &lt;span&gt;進度&lt;/span&gt;
                                                &lt;span id=&quot;progress-text-top&quot;&gt;0 / &lt;span id=&quot;total-chars-top&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
                                             &lt;/div&gt;
                                             &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                                                &lt;div id=&quot;progress-bar-top&quot; class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;
                                             &lt;/div&gt;
                                          &lt;/div&gt;
                                       &lt;/div&gt;
                                       &lt;button id=&quot;pause-btn-top&quot; class=&quot;p-2 bg-primary text-white rounded-lg hover:bg-opacity-90 text-xl flex items-center justify-center w-10 h-10&quot; title=&quot;暫停遊戲&quot; style=&quot;transform: rotate(180deg);&quot;&gt;
                                       &lt;i class=&quot;fas fa-pause&quot;&gt;&lt;/i&gt;
                                       &lt;/button&gt;
                                    &lt;/div&gt;
                                    &lt;div class=&quot;flex items-center justify-center&quot;&gt;
                                       &lt;div id=&quot;last-answered-chars-top&quot; class=&quot;text-lg md:text-xl text-gray-700 dark:text-gray-300 whitespace-nowrap overflow-x-auto max-w-full h-12 flex items-center&quot;&gt;&lt;/div&gt;
                                       &lt;div id=&quot;current-char-top&quot; class=&quot;character text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 min-w-[1.2em] flex items-center justify-center ml-1&quot;&gt;&lt;/div&gt;
                                       &lt;div class=&quot;text-lg text-gray-400 dark:text-gray-500&quot;&gt;...&lt;/div&gt;
                                    &lt;/div&gt;
                                    &lt;div id=&quot;options-container-top&quot; class=&quot;grid grid-cols-3 gap-3 md:gap-4 mt-4 w-full px-4&quot;&gt;&lt;/div&gt;
                                    &lt;!-- 上方玩家錯誤屏障 --&gt;
                                    &lt;div id=&quot;top-player-error-overlay&quot; class=&quot;absolute inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center&quot; style=&quot;transform: rotate(180deg);&quot;&gt;
                                       &lt;div class=&quot;text-white font-bold flex items-center&quot;&gt;
                                          &lt;span id=&quot;top-error-timer&quot; class=&quot;text-3xl text-red-500&quot;&gt;●●●&lt;/span&gt;
                                       &lt;/div&gt;
                                    &lt;/div&gt;
                                 &lt;/div&gt;
                              &lt;/div&gt;
                              &lt;!-- 中間區域 - 僅用於倒計時 --&gt;
                              &lt;div class=&quot;flex-grow flex items-center justify-center relative min-h-[50px]&quot;&gt;
                                 &lt;!-- 倒計時區域 - 增加覆蓋整個畫面的半透明黑色背景並加大綠點 --&gt;
                                 &lt;div id=&quot;multiplayer-countdown&quot; class=&quot;fixed inset-0 flex items-center justify-center hidden bg-black bg-opacity-70 z-[1000]&quot;&gt;
                                    &lt;div class=&quot;text-5xl font-bold text-green-500&quot;&gt;●●●&lt;/div&gt;
                                 &lt;/div&gt;
                              &lt;/div&gt;
                              &lt;!-- 下方玩家區域 --&gt;
                              &lt;div id=&quot;player-bottom&quot; class=&quot;w-full pt-4 mt-2 border-t border-gray-300 dark:border-gray-700 relative&quot;&gt;
                                 &lt;div class=&quot;flex flex-col items-center&quot;&gt;
                                    &lt;!-- 下方玩家控制欄 --&gt;
                                    &lt;div class=&quot;w-full flex justify-between items-center px-4 mb-2&quot;&gt;
                                       &lt;div class=&quot;flex flex-col gap-1 max-w-[150px] w-full&quot;&gt;
                                          &lt;div id=&quot;stopwatch-bottom&quot; class=&quot;text-gray-700 dark:text-gray-300 px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg text-base flex items-center&quot;&gt;
                                             &lt;i class=&quot;fas fa-stopwatch mr-2&quot;&gt;&lt;/i&gt;&lt;span id=&quot;timer-bottom&quot; class=&quot;font-medium&quot;&gt;00:00.0&lt;/span&gt;
                                          &lt;/div&gt;
                                          &lt;!-- 下方玩家進度條 --&gt;
                                          &lt;div class=&quot;px-3&quot;&gt;
                                             &lt;div class=&quot;flex justify-between items-center text-xs text-gray-600 dark:text-gray-400&quot;&gt;
                                                &lt;span&gt;進度&lt;/span&gt;
                                                &lt;span id=&quot;progress-text-bottom&quot;&gt;0 / &lt;span id=&quot;total-chars-bottom&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
                                             &lt;/div&gt;
                                             &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                                                &lt;div id=&quot;progress-bar-bottom&quot; class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;
                                             &lt;/div&gt;
                                          &lt;/div&gt;
                                       &lt;/div&gt;
                                       &lt;button id=&quot;pause-btn-bottom&quot; class=&quot;p-2 bg-primary text-white rounded-lg hover:bg-opacity-90 text-xl flex items-center justify-center w-10 h-10&quot; title=&quot;暫停遊戲&quot;&gt;
                                       &lt;i class=&quot;fas fa-pause&quot;&gt;&lt;/i&gt;
                                       &lt;/button&gt;
                                    &lt;/div&gt;
                                    &lt;div class=&quot;flex items-center justify-center&quot;&gt;
                                       &lt;div id=&quot;last-answered-chars-bottom&quot; class=&quot;text-lg md:text-xl text-gray-700 dark:text-gray-300 whitespace-nowrap overflow-x-auto max-w-full h-12 flex items-center&quot;&gt;&lt;/div&gt;
                                       &lt;div id=&quot;current-char-bottom&quot; class=&quot;character text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 min-w-[1.2em] flex items-center justify-center ml-1&quot;&gt;&lt;/div&gt;
                                       &lt;div class=&quot;text-lg text-gray-400 dark:text-gray-500&quot;&gt;...&lt;/div&gt;
                                    &lt;/div&gt;
                                    &lt;div id=&quot;options-container-bottom&quot; class=&quot;grid grid-cols-3 gap-3 md:gap-4 mt-4 w-full px-4&quot;&gt;&lt;/div&gt;
                                    &lt;!-- 下方玩家錯誤屏障 --&gt;
                                    &lt;div id=&quot;bottom-player-error-overlay&quot; class=&quot;absolute inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center&quot;&gt;
                                       &lt;div class=&quot;text-white font-bold flex items-center&quot;&gt;
                                          &lt;span id=&quot;bottom-error-timer&quot; class=&quot;text-3xl text-red-500&quot;&gt;●●●&lt;/span&gt;
                                       &lt;/div&gt;
                                    &lt;/div&gt;
                                 &lt;/div&gt;
                              &lt;/div&gt;
                           &lt;/div&gt;
                           &lt;!-- 雙人模式暫停菜單 --&gt;
                           &lt;div id=&quot;multiplayer-pause-overlay&quot; class=&quot;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden&quot;&gt;
                              &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-8 py-12 max-w-sm w-full mx-4 flex flex-col items-center justify-center&quot;&gt;
                                 &lt;div id=&quot;multiplayer-pause-buttons&quot; class=&quot;flex justify-center gap-8 mb-8&quot;&gt;
                                    &lt;button id=&quot;multiplayer-continue-btn&quot; class=&quot;w-16 h-16 bg-primary text-white rounded-full hover:bg-opacity-90 flex items-center justify-center text-xl&quot; title=&quot;繼續遊戲&quot;&gt;
                                    &lt;i class=&quot;fas fa-play&quot;&gt;&lt;/i&gt;
                                    &lt;/button&gt;
                                    &lt;button id=&quot;multiplayer-return-btn&quot; class=&quot;w-16 h-16 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors flex items-center justify-center text-xl&quot; title=&quot;返回主頁&quot;&gt;
                                    &lt;i class=&quot;fas fa-home&quot;&gt;&lt;/i&gt;
                                    &lt;/button&gt;
                                 &lt;/div&gt;
                                 &lt;!-- 隱藏的倒計時顯示 --&gt;
                                 &lt;div id=&quot;multiplayer-countdown-resume&quot; class=&quot;hidden text-center&quot;&gt;
                                    &lt;p class=&quot;text-gray-600 dark:text-gray-300 mb-3&quot;&gt;遊戲將在以下時間後繼續&lt;/p&gt;
                                    &lt;div class=&quot;text-4xl font-bold text-primary pause-countdown-number&quot;&gt;3&lt;/div&gt;
                                 &lt;/div&gt;
                              &lt;/div&gt;
                           &lt;/div&gt;
                        &lt;/div&gt;
                     &lt;/div&gt;
                  &lt;/div&gt;
                  &lt;div id=&quot;options-container&quot; class=&quot;grid grid-cols-3 gap-3 md:gap-4 mb-4&quot;&gt;
                     &lt;!-- Options will be generated here --&gt;
                  &lt;/div&gt;
                  &lt;div id=&quot;feedback&quot; class=&quot;text-center h-6 text-lg&quot;&gt;&lt;/div&gt;
               &lt;/div&gt;
            &lt;/div&gt;
         &lt;/div&gt;
         &lt;!-- 移除底部的遊玩說明按鈕，因為已經放在齒輪菜單中 --&gt;
      &lt;/div&gt;
      &lt;!-- 版本號 --&gt;
      &lt;div class=&quot;text-center py-3 text-gray-500 dark:text-gray-400 text-sm&quot;&gt;
         &lt;p&gt;v1.4.3&lt;/p&gt;
         &lt;p&gt;WenyanMaster - 文言大師之旅 © 2025&lt;/p&gt;
      &lt;/div&gt;
      &lt;script&gt;
         // 添加用於頭像的兩個全局變量
         let userSelectedAvatar = null;
         let avatarPixelData = {
             // 定義頭像 - 部分保留，部分重新設計著重呈現物件形狀
             &#39;villager&#39;: { name: &#39;普通村民&#39;, colors: [&#39;#5D4037&#39;, &#39;#8D6E63&#39;, &#39;#D7CCC8&#39;, &#39;#FFF8E1&#39;] }, // 重新設計
             &#39;rabbit&#39;: { name: &#39;兔子&#39;, colors: [&#39;#FFEBEE&#39;, &#39;#FFCDD2&#39;, &#39;#9E9E9E&#39;, &#39;#424242&#39;] }, // 重新設計
             &#39;panda&#39;: { name: &#39;熊貓&#39;, colors: [&#39;#212121&#39;, &#39;#424242&#39;, &#39;#FFFFFF&#39;, &#39;#90A4AE&#39;] }, // 重新設計
             &#39;whale&#39;: { name: &#39;鯨魚&#39;, colors: [&#39;#0D47A1&#39;, &#39;#1565C0&#39;, &#39;#81D4FA&#39;, &#39;#E1F5FE&#39;] }, // 重新設計
             &#39;bread&#39;: { name: &#39;麵包&#39;, colors: [&#39;#AA7942&#39;, &#39;#D2B48C&#39;, &#39;#FFFDE7&#39;, &#39;#FFECB3&#39;] }, // 重新設計
             &#39;chicken&#39;: { name: &#39;雞&#39;, colors: [&#39;#FF6F00&#39;, &#39;#FFA000&#39;, &#39;#FFECB3&#39;, &#39;#F44336&#39;] }, // 保留
             &#39;dragon&#39;: { name: &#39;神龍&#39;, colors: [&#39;#00695C&#39;, &#39;#009688&#39;, &#39;#FFD54F&#39;, &#39;#D32F2F&#39;] }, // 重新設計
             &#39;bomb&#39;: { name: &#39;炸彈&#39;, colors: [&#39;#263238&#39;, &#39;#37474F&#39;, &#39;#546E7A&#39;, &#39;#FF3D00&#39;] }, // 保留
             &#39;fox&#39;: { name: &#39;狐狸&#39;, colors: [&#39;#E65100&#39;, &#39;#FF6D00&#39;, &#39;#FBE9E7&#39;, &#39;#37474F&#39;] }, // 重新設計
             &#39;wizard&#39;: { name: &#39;魔法师&#39;, colors: [&#39;#311B92&#39;, &#39;#5E35B1&#39;, &#39;#D1C4E9&#39;, &#39;#FFC400&#39;] }, // 重新設計
             &#39;assassin&#39;: { name: &#39;刺客&#39;, colors: [&#39;#212121&#39;, &#39;#424242&#39;, &#39;#EEE&#39;, &#39;#D50000&#39;] }, // 重新設計
             &#39;husky&#39;: { name: &#39;哈士奇&#39;, colors: [&#39;#455A64&#39;, &#39;#78909C&#39;, &#39;#CFD8DC&#39;, &#39;#ECEFF1&#39;] }, // 保留
             &#39;werewolf&#39;: { name: &#39;狼人&#39;, colors: [&#39;#5D4037&#39;, &#39;#795548&#39;, &#39;#FFC107&#39;, &#39;#F5F5F5&#39;] }, // 保留
             &#39;cat&#39;: { name: &#39;猫&#39;, colors: [&#39;#616161&#39;, &#39;#9E9E9E&#39;, &#39;#E0E0E0&#39;, &#39;#FFC107&#39;] }, // 保留
             &#39;orange&#39;: { name: &#39;橙子&#39;, colors: [&#39;#FF9800&#39;, &#39;#F57C00&#39;, &#39;#4CAF50&#39;, &#39;#1B5E20&#39;] }, // 保留
             &#39;mask&#39;: { name: &#39;面具&#39;, colors: [&#39;#FFFFFF&#39;, &#39;#EEEEEE&#39;, &#39;#9E9E9E&#39;, &#39;#212121&#39;] }, // 保留
             &#39;sparrow&#39;: { name: &#39;麻雀&#39;, colors: [&#39;#795548&#39;, &#39;#8D6E63&#39;, &#39;#A1887F&#39;, &#39;#BCAAA4&#39;] }, // 保留
             &#39;watermelon&#39;: { name: &#39;西瓜&#39;, colors: [&#39;#4CAF50&#39;, &#39;#388E3C&#39;, &#39;#E91E63&#39;, &#39;#1B5E20&#39;] }, // 保留
             &#39;capybara&#39;: { name: &#39;卡皮巴拉&#39;, colors: [&#39;#8D6E63&#39;, &#39;#A1887F&#39;, &#39;#D7CCC8&#39;, &#39;#6D4C41&#39;] }, // 保留
             &#39;sunflower&#39;: { name: &#39;向日葵&#39;, colors: [&#39;#FFEB3B&#39;, &#39;#FBC02D&#39;, &#39;#795548&#39;, &#39;#33691E&#39;] }, // 重新設計
             // 重新設計的頭像 - 著重呈現物件形狀
             &#39;lemon&#39;: { name: &#39;檸檬&#39;, colors: [&#39;#FFEB3B&#39;, &#39;#FFEE58&#39;, &#39;#AFB42B&#39;, &#39;#C0CA33&#39;] }, // 重新設計
             &#39;angel&#39;: { name: &#39;天使&#39;, colors: [&#39;#FAFAFA&#39;, &#39;#F5F5F5&#39;, &#39;#80DEEA&#39;, &#39;#FFEE58&#39;] }, // 重新設計
             &#39;pirate&#39;: { name: &#39;海盜&#39;, colors: [&#39;#3E2723&#39;, &#39;#5D4037&#39;, &#39;#CFD8DC&#39;, &#39;#D32F2F&#39;] }, // 已實現
             &#39;unicorn&#39;: { name: &#39;獨角獸&#39;, colors: [&#39;#FAFAFA&#39;, &#39;#E1BEE7&#39;, &#39;#AB47BC&#39;, &#39;#FFD54F&#39;] }, // 已實現
             &#39;iceflower&#39;: { name: &#39;冰花&#39;, colors: [&#39;#E3F2FD&#39;, &#39;#B3E5FC&#39;, &#39;#03A9F4&#39;, &#39;#0277BD&#39;] }, // 已實現
             &#39;snowman&#39;: { name: &#39;雪人&#39;, colors: [&#39;#ECEFF1&#39;, &#39;#CFD8DC&#39;, &#39;#546E7A&#39;, &#39;#EF5350&#39;] }, // 保留
             &#39;mummy&#39;: { name: &#39;木乃伊&#39;, colors: [&#39;#F5F5F5&#39;, &#39;#E0E0E0&#39;, &#39;#BDBDBD&#39;, &#39;#757575&#39;] }, // 保留
             // 重新設計的頭像
             &#39;candy&#39;: { name: &#39;糖果&#39;, colors: [&#39;#F06292&#39;, &#39;#EC407A&#39;, &#39;#81C784&#39;, &#39;#4CAF50&#39;] },
             &#39;butterfly&#39;: { name: &#39;蝴蝶&#39;, colors: [&#39;#9C27B0&#39;, &#39;#BA68C8&#39;, &#39;#EC407A&#39;, &#39;#7B1FA2&#39;] },
             &#39;lightning&#39;: { name: &#39;閃電&#39;, colors: [&#39;#FFEB3B&#39;, &#39;#FDD835&#39;, &#39;#FBC02D&#39;, &#39;#F9A825&#39;] },
             &#39;crown&#39;: { name: &#39;皇冠&#39;, colors: [&#39;#FFC107&#39;, &#39;#FFD54F&#39;, &#39;#F44336&#39;, &#39;#B71C1C&#39;] },
             &#39;moon&#39;: { name: &#39;月球&#39;, colors: [&#39;#ECEFF1&#39;, &#39;#CFD8DC&#39;, &#39;#B0BEC5&#39;, &#39;#546E7A&#39;] }
         }
         
         // 定義頭像解鎖所需等級
         window.avatarUnlockLevels = {
         &#39;villager&#39;: 1,  // 預設解鎖「普通村民」頭像
         &#39;rabbit&#39;: 4,    // 4級解鎖「兔子」頭像
         &#39;panda&#39;: 7,     // 7級解鎖「熊貓」頭像
         &#39;whale&#39;: 10,    // 10級解鎖「鯨魚」頭像
         &#39;bread&#39;: 13,    // 13級解鎖「麵包」頭像
         &#39;chicken&#39;: 16,  // 16級解鎖「雞」頭像
         &#39;dragon&#39;: 19,   // 19級解鎖「神龍」頭像
         &#39;bomb&#39;: 22,     // 22級解鎖「炸彈」頭像
         &#39;fox&#39;: 25,      // 25級解鎖「狐狸」頭像
         &#39;wizard&#39;: 28,   // 28級解鎖「魔法师」頭像
         &#39;assassin&#39;: 31, // 31級解鎖「刺客」頭像
         &#39;husky&#39;: 34,    // 34級解鎖「哈士奇」頭像
         &#39;werewolf&#39;: 37, // 37級解鎖「狼人」頭像
         &#39;cat&#39;: 40,      // 40級解鎖「猫」頭像
         &#39;orange&#39;: 43,   // 43級解鎖「橙子」頭像
         &#39;mask&#39;: 46,     // 46級解鎖「面具」頭像
         &#39;sparrow&#39;: 49,  // 49級解鎖「麻雀」頭像
         &#39;watermelon&#39;: 52, // 52級解鎖「西瓜」頭像
         &#39;capybara&#39;: 55, // 55級解鎖「卡皮巴拉」頭像
         &#39;sunflower&#39;: 58, // 58級解鎖「向日葵」頭像
         &#39;lemon&#39;: 61,    // 61級解鎖「檸檬」頭像
         &#39;angel&#39;: 64,    // 64級解鎖「天使」頭像
         &#39;pirate&#39;: 67,   // 67級解鎖「海盜」頭像
         &#39;unicorn&#39;: 70,  // 70級解鎖「獨角獸」頭像
         &#39;iceflower&#39;: 73, // 73級解鎖「冰花」頭像
         &#39;candy&#39;: 84,    // 84級解鎖「糖果」頭像
         &#39;butterfly&#39;: 88, // 88級解鎖「蝴蝶」頭像
         &#39;lightning&#39;: 92, // 92級解鎖「閃電」頭像
         &#39;crown&#39;: 96,    // 96級解鎖「皇冠」頭像
         &#39;moon&#39;: 100,     // 100級解鎖「月球」頭像
         &#39;snowman&#39;: 76,  // 76級解鎖「雪人」頭像
         &#39;mummy&#39;: 80,    // 80級解鎖「木乃伊」頭像
         };
         
         document.addEventListener(&#39;DOMContentLoaded&#39;, function() {
             // 確保移除深色模式類
             document.documentElement.classList.remove(&#39;dark&#39;);
             
             // 添加視窗大小變化監聽
             window.addEventListener(&#39;resize&#39;, function() {
                 // 如果篇章選擇器已打開
                 if (passageContent &amp;&amp; !passageContent.classList.contains(&#39;hidden&#39;)) {
                     const passageList = document.getElementById(&#39;passage-list&#39;);
                     if (passageList) {
                         passageList.style.maxHeight = Math.max(60, window.innerHeight * 0.2) + &#39;px&#39;;
                     }
                     
                     // 如果段落選擇器也打開
                     const paragraphSelector = document.getElementById(&#39;paragraph-selector&#39;);
                     const paragraphList = document.getElementById(&#39;paragraph-list&#39;);
                     if (paragraphSelector &amp;&amp; !paragraphSelector.classList.contains(&#39;hidden&#39;) &amp;&amp; paragraphList) {
                         // 調整段落選項容器的高度
                         const paragraphOptions = paragraphList.querySelector(&#39;.paragraph-options&#39;);
                         if (paragraphOptions) {
                             // 每段約70px高，最少200px，最多視口高度的50%
                             const paragraphCount = document.querySelectorAll(&#39;.paragraph-checkbox&#39;).length;
                             const calculatedHeight = Math.min(
                                 Math.max(200, paragraphCount * 70),
                                 window.innerHeight * 0.5
                             );
                             paragraphOptions.style.maxHeight = calculatedHeight + &#39;px&#39;;
                         }
                     }
                     
                     // 更新容器高度
                     if (passageContainer) {
                         // 計算當前所有內容的實際高度
                         const passageContentHeight = document.getElementById(&#39;passage-content&#39;).scrollHeight;
                         // 增加額外空間，確保容器高度充足
                         const totalHeight = Math.max(600, passageContentHeight + 50);
                         passageContainer.style.maxHeight = totalHeight + &#39;px&#39;;
                     }
                 }
             });
             console.log(&quot;DOM加載完成，開始初始化...&quot;);
             
             // 隱藏主界面，直到用戶點擊「開始旅程」
             const mainContainer = document.querySelector(&#39;.container&#39;);
             const startScreen = document.getElementById(&#39;start-screen&#39;);
             const startJourneyBtn = document.getElementById(&#39;start-journey-btn&#39;);
             const settingsButton = document.getElementById(&#39;settings-button&#39;);
             
             // 初始隱藏主內容和設置按鈕
             if (mainContainer) mainContainer.style.display = &#39;none&#39;;
             if (settingsButton) settingsButton.style.display = &#39;none&#39;;
             
             // 開始旅程按鈕事件
             if (startJourneyBtn &amp;&amp; startScreen &amp;&amp; mainContainer) {
                 startJourneyBtn.addEventListener(&#39;click&#39;, function() {
                     // 先禁用按鈕防止重複點擊
                     startJourneyBtn.disabled = true;
                     
                     // 1. 讓啟動界面淡出
                     startScreen.style.opacity = &#39;0&#39;;
                     
                     // 2. 在淡出過程中（大約400ms後）播放墨水擴散動畫
                     setTimeout(() =&gt; {
                         // 創建墨水擴散動畫
                         const loadingAnimation = document.createElement(&#39;div&#39;);
                         loadingAnimation.id = &#39;loading-container&#39;;
                         loadingAnimation.innerHTML = `&lt;div id=&quot;main-splash&quot;&gt;&lt;/div&gt;`;
                         document.body.appendChild(loadingAnimation);
                         
                         // 3. 淡出完全結束后（大約800ms）隱藏啟動界面並顯示主界面
                         setTimeout(() =&gt; {
                             // 隱藏啟動界面
                             startScreen.style.display = &#39;none&#39;;
                             // 顯示主界面
                             mainContainer.style.display = &#39;block&#39;;
                             
                             // 顯示用戶資料容器，隱藏遊戲界面
                             const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                             const gamePage = document.getElementById(&#39;game-page&#39;);
                             if (userProfileContainer) {
                                 userProfileContainer.classList.remove(&#39;hidden&#39;);
                             }
                             
                             // 4. 最後顯示設置按鈕
                             setTimeout(() =&gt; {
                                 settingsButton.style.display = &#39;flex&#39;;
                                 
                                 // 墨水動畫淡出並移除
                                 loadingAnimation.classList.add(&#39;fade-out&#39;);
                                 setTimeout(() =&gt; {
                                     if (loadingAnimation.parentNode) {
                                         loadingAnimation.parentNode.removeChild(loadingAnimation);
                                     }
                                     // 重新啟用按鈕（雖然啟動界面已經隱藏）
                                     startJourneyBtn.disabled = false;
                                 }, 500);
                             }, 100); // 短暫延遲後顯示設置按鈕
                         }, 400); // 總共約800ms的淡出時間
                     }, 400); // 淡出到一半時開始播放墨水擴散動畫
                 });
             }
             
             // 新增暫停功能相關變量
             let isPaused = false;
             let resumeCountdown = null;
             
             // 添加追蹤用戶是否使用過暫停功能的變量
             let hasPaused = false;
             
             // 計時器相關變量 - 修改為支持暫停/繼續
             let startTime = null;
             let elapsedTimeBeforePause = 0; // 保存暫停前的累計時間
             let timerInterval = null;
             const timerElement = document.getElementById(&#39;timer&#39;);
             
             // 文言文數據 - 您可以在此處添加更多篇章
         
             const passages = {
                 &#39;四塊玉&#39;: {
                     title: &#39;《四塊玉．閒適》&#39;,
                     author: &#39;關漢卿&#39;,
                     category: &#39;其他&#39;, 
                     paragraphs: [
                         &#39;南畝耕，東山卧。世態人情經歷多。閒將往事思量過，賢的是他，愚的是我，爭甚麼？&#39;
                     ]
                 },
             };
             
             // 重新生成篇章列表
             generatePassageItems();
         
             // 自動生成內容和初始化
             initializePassages();
             
             // 定义全局变量
             const startGameBtn = document.getElementById(&#39;start-game-btn&#39;);
             const gameStartScreen = document.getElementById(&#39;game-start-screen&#39;);
             const gameContent = document.getElementById(&#39;game-content&#39;);
             const gamePage = document.getElementById(&#39;game-page&#39;);
             
             // 当前选择的篇章键值，初始设定为一个随機篇章
              /*let currentPassageKey = &#39;&#39;;
             
             // 函數：隨機選擇篇章並加載
             function loadRandomPassage() {
                 // 獲取所有篇章的鍵值
                 const passageKeys = Object.keys(passages);
                 if (passageKeys.length === 0) return;
                 
                 // 隨機選擇一個篇章
                 const randomIndex = Math.floor(Math.random() * passageKeys.length);
                 const randomPassageKey = passageKeys[randomIndex];
                 currentPassageKey = randomPassageKey;
                 
                 // 獲取所有段落索引
                 const selectedPassage = passages[randomPassageKey];
                 const paragraphIndices = [];
                 for (let i = 0; i &lt; selectedPassage.paragraphs.length; i++) {
                     paragraphIndices.push(i);
                 }
                 
                 // 加載選中的篇章（所有段落）
                 loadSelectedParagraphs(randomPassageKey, paragraphIndices);
             }*/
             
             // 初始化默認篇章資料但不顯示遊戲界面的函數
             function initializePassageData() {
                 // 僅預載隨機篇章資料，不自動顯示遊戲界面
                 if (Object.keys(passages).length &gt; 0) {
                     // 隨機選擇一個篇章但只載入資料，不顯示遊戲界面
                     const passageKeys = Object.keys(passages);
                     const randomIndex = Math.floor(Math.random() * passageKeys.length);
                     const randomPassageKey = passageKeys[randomIndex];
                     
                     // 初始化當前篇章鍵值
                     currentPassageKey = randomPassageKey;
                     
                     // 獲取所有段落索引但不顯示遊戲界面
                     const selectedPassage = passages[randomPassageKey];
                     const paragraphIndices = [];
                     for (let i = 0; i &lt; selectedPassage.paragraphs.length; i++) {
                         paragraphIndices.push(i);
                     }
                     
                     // 加載篇章資料，但不顯示遊戲界面 (第三個參數為false表示不顯示遊戲界面)
                     loadSelectedParagraphs(randomPassageKey, paragraphIndices, false);
                 }
                 
                 // 確保用戶資料容器顯示，遊戲界面隱藏
                 const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                 if (userProfileContainer) {
                     userProfileContainer.classList.remove(&#39;hidden&#39;);
                 }
                 
                 // 確保遊戲頁面隱藏，直到用戶選擇篇章
                 if (gamePage) {
                     gamePage.classList.add(&#39;hidden&#39;);
                 }
             }
             
             // 頁面加載後初始化篇章資料，但不顯示遊戲界面
             setTimeout(() =&gt; {
                 // 初始化篇章資料但不顯示遊戲界面
                 initializePassageData();
                 
                 // 確保顯示開始畫面 (遊戲內容仍然隱藏)
                 if (gameStartScreen &amp;&amp; gameContent) {
                     gameStartScreen.classList.remove(&#39;hidden&#39;);
                     gameContent.classList.add(&#39;hidden&#39;);
                 }
             }, 300);
             
             // 追蹤錯誤次數
             let wrongAnswersCount = 0;
             
             // 创建倒计时容器
             const countdownContainer = document.createElement(&#39;div&#39;);
             countdownContainer.className = &#39;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden&#39;;
             countdownContainer.id = &#39;countdown-container&#39;;
             document.body.appendChild(countdownContainer);
             
             const countdownNumber = document.createElement(&#39;div&#39;);
             countdownNumber.className = &#39;text-8xl md:text-9xl font-bold text-white countdown-number&#39;;
             countdownContainer.appendChild(countdownNumber);
             
             // 添加倒计时样式
             const style = document.createElement(&#39;style&#39;);
             style.textContent = `
                 @keyframes countdown-pulse {
                     0% { transform: scale(0.8); opacity: 0; }
                     20% { transform: scale(1.2); opacity: 1; }
                     70% { transform: scale(0.9); opacity: 1; }
                     100% { transform: scale(1); opacity: 0.7; }
                 }
                 .countdown-number {
                     animation: countdown-pulse 1s ease-in-out;
                     text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 30px rgba(93, 92, 222, 0.6);
                 }
             `;
             document.head.appendChild(style);
             
             // 初始化暫停功能
             initializePauseSystem();
             
             // 自動生成篇章列表
             generatePassageItems();
             
             // 更新暫停/返回主頁按鈕顯示狀態
             function updateGameControlButtons(gameState) {
                 const pauseBtn = document.getElementById(&#39;pause-btn&#39;);
                 const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                 
                 if (!pauseBtn || !returnHomeBtn) return;
                 
                 if (gameState === &#39;not-started&#39; || gameState === &#39;completed&#39; || gameState === &#39;failed&#39;) {
                     // 遊戲開始前、完成後或失敗後，顯示返回主頁按鈕
                     pauseBtn.classList.add(&#39;hidden&#39;);
                     returnHomeBtn.classList.remove(&#39;hidden&#39;);
                 } else if (gameState === &#39;playing&#39;) {
                     // 遊戲進行中，顯示暫停按鈕
                     pauseBtn.classList.remove(&#39;hidden&#39;);
                     returnHomeBtn.classList.add(&#39;hidden&#39;);
                 }
             }
             
             // 為遊戲界面中的返回主頁按鈕添加點擊事件
             const returnHomeGameBtn = document.getElementById(&#39;return-home-btn-game&#39;);
             if (returnHomeGameBtn) {
                 returnHomeGameBtn.addEventListener(&#39;click&#39;, async function() {
                     console.log(&quot;遊戲界面中的返回主頁按鈕被點擊&quot;);
                     
                     try {
                         // 顯示水墨過渡動畫
                         await showLoadingAnimation();
                         console.log(&quot;水墨過渡動畫播放完成&quot;);
                         
                         // 執行與暫停菜單中返回主頁相同的操作
                         // 重置遊戲狀態
                         currentPosition = 0;
                         correctAnswers = 0;
                         lives = 3;
                         successfulChars = 0;
                         wrongAnswersCount = 0;
                         lastAnsweredChars = [];
                         
                         const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                         if (lastAnsweredCharsElem) {
                             lastAnsweredCharsElem.textContent = &#39;&#39;;
                         }
                         
                         canSelect = true;
                         isPaused = false;
                         hasPaused = false;
                         updateLives();
                         
                         if (feedback) {
                             feedback.textContent = &#39;&#39;;
                         }
                         
                         // 停止計時器
                         stopStopwatch();
                         elapsedTimeBeforePause = 0;
                         if (timerElement) {
                             timerElement.textContent = &quot;00:00.0&quot;;
                         }
                         
                         // 更新進度條
                         const progressText = document.getElementById(&#39;progress-text&#39;);
                         const progressBar = document.getElementById(&#39;progress-bar&#39;);
                         
                         if (progressText) {
                             progressText.textContent = `0 / ${totalNonPunctChars}`;
                         }
                         
                         if (progressBar) {
                             progressBar.style.width = &#39;0%&#39;;
                         }
                         
                         // 獲取需要操作的元素
                         const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                         const gamePage = document.getElementById(&#39;game-page&#39;);
                         
                         // 隱藏遊戲界面
                         gamePage.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important;&#39;;
                         gamePage.classList.add(&#39;hidden&#39;);
                         gamePage.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                         
                         // 顯示用戶資料界面
                         userProfileContainer.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important;&#39;;
                         userProfileContainer.classList.remove(&#39;hidden&#39;);
                         userProfileContainer.classList.add(&#39;block&#39;);
                         
                         // 確保書本頁面回到初始狀態
                         const bookPage = document.querySelector(&#39;.page&#39;);
                         if (bookPage &amp;&amp; bookPage.classList.contains(&#39;turned&#39;)) {
                             bookPage.classList.remove(&#39;turned&#39;);
                         }
                         
                         // 滾動到頁面頂部
                         window.scrollTo({
                             top: 0,
                             behavior: &#39;smooth&#39;
                         });
                         
                         // 清空選項並恢復原始的網格佈局
                         if (optionsContainer) {
                             optionsContainer.innerHTML = &#39;&#39;;
                             optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                         }
                         
                         // 重新啟用設置按鈕
                         window.enableSettingsButton();
                         
                         console.log(&quot;從遊戲界面返回主頁成功&quot;);
                     } catch (error) {
                         console.error(&quot;返回主頁按鈕處理發生錯誤:&quot;, error);
                         alert(&quot;返回主頁時發生錯誤，請重新載入頁面&quot;);
                         // 即使發生錯誤，仍嘗試啟用設置按鈕
                         try {
                             window.enableSettingsButton();
                         } catch (e) {
                             console.error(&quot;啟用設置按鈕時發生錯誤:&quot;, e);
                         }
                     }
                 });
             }
                 
             // 双人模式变量定义
             window.multiplayerMode = {
                 active: false,
                 players: [
                     { currentPosition: 0, correctAnswers: 0, lastAnsweredChars: [], canSelect: true, errorTimer: null },
                     { currentPosition: 0, correctAnswers: 0, lastAnsweredChars: [], canSelect: true, errorTimer: null }
                 ],
                 winner: null,
                 gameStarted: false
             };
             
             // 添加双人模式切换功能 - 使用滑塊
             const gameModeSwitch = document.getElementById(&#39;game-mode-switch&#39;);
             
             if (gameModeSwitch) {
                 // 设置单人/双人模式切换
                 window.gameMode = &#39;single&#39;; // 默认为单人模式
                 
                 gameModeSwitch.addEventListener(&#39;change&#39;, function() {
                     if (this.checked) {
                         // 切换到双人模式
                         window.gameMode = &#39;multi&#39;;
                         console.log(&quot;切換到雙人模式&quot;);
                     } else {
                         // 切换到单人模式
                         window.gameMode = &#39;single&#39;;
                         console.log(&quot;切換到單人模式&quot;);
                     }
                 });
             }
             
             // 双人模式确认对话框
             function showMultiplayerConfirm() {
                 // 创建确认对话框
                 const confirmDialog = document.createElement(&#39;div&#39;);
                 confirmDialog.className = &#39;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[1000]&#39;;
                 confirmDialog.id = &#39;multiplayer-confirm-dialog&#39;;
                 
                 confirmDialog.innerHTML = `
                     &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm w-full mx-4 text-center&quot;&gt;
                         &lt;h3 class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100 mb-4&quot;&gt;雙人對戰模式&lt;/h3&gt;
                         &lt;p class=&quot;text-gray-600 dark:text-gray-300 mb-5&quot;&gt;準備開始雙人對戰！上方玩家（螢幕上半部）和下方玩家（螢幕下半部）將同時挑戰。&lt;/p&gt;
                         &lt;div class=&quot;flex justify-center gap-6&quot;&gt;
                             &lt;button id=&quot;start-multi-btn&quot; class=&quot;px-5 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90&quot;&gt;開始&lt;/button&gt;
                             &lt;button id=&quot;cancel-multi-btn&quot; class=&quot;px-5 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600&quot;&gt;返回&lt;/button&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
                 `;
                 
                 document.body.appendChild(confirmDialog);
                 
                 // 添加按钮事件
                 document.getElementById(&#39;start-multi-btn&#39;).addEventListener(&#39;click&#39;, function() {
                     document.body.removeChild(confirmDialog);
                     startMultiplayerGame();
                 });
                 
                 document.getElementById(&#39;cancel-multi-btn&#39;).addEventListener(&#39;click&#39;, function() {
                     document.body.removeChild(confirmDialog);
                     // 切换回单人模式
                     if (singleModeBtn) singleModeBtn.click();
                 });
             }
             
             // 开始双人游戏
             function startMultiplayerGame() {
                 window.multiplayerMode.active = true;
                 window.multiplayerMode.gameStarted = false;
                 window.multiplayerMode.winner = null;
                 
                 // 重置双人模式状态
                 window.multiplayerMode.players.forEach(player =&gt; {
                     player.currentPosition = 0;
                     player.correctAnswers = 0;
                     player.lastAnsweredChars = [];
                     player.canSelect = true;
                 });
                 
                 // 隐藏开始屏幕，显示游戏内容
                 if (gameStartScreen) {
                     gameStartScreen.classList.add(&#39;hidden&#39;);
                 }
                 
                 if (gameContent) {
                     gameContent.classList.remove(&#39;hidden&#39;);
                 }
                 
                 // 显示双人UI，隐藏单人UI
                 const singlePlayerUI = document.getElementById(&#39;single-player-ui&#39;);
                 const multiplayerUI = document.getElementById(&#39;multiplayer-ui&#39;);
                 
                 if (singlePlayerUI &amp;&amp; multiplayerUI) {
                     singlePlayerUI.classList.add(&#39;hidden&#39;);
                     multiplayerUI.classList.remove(&#39;hidden&#39;);
                     
                     // 在進入雙人模式時隱藏選擇篇章容器、「文言大師之旅」標題等於遊戲過程無關的元素
                     const headerElement = document.querySelector(&#39;header&#39;);
                     if (headerElement) {
                         headerElement.style.display = &#39;none&#39;;
                     }
                     
                     const passageSelector = document.querySelector(&#39;.passage-selector&#39;);
                     if (passageSelector) {
                         passageSelector.style.display = &#39;none&#39;;
                     }
                     
                     // 隐藏设置按钮和版本号
                     if (document.getElementById(&#39;settings-button&#39;)) {
                         document.getElementById(&#39;settings-button&#39;).style.display = &#39;none&#39;;
                     }
                     
                     // 隐藏底部版本信息
                     const versionInfo = document.querySelector(&#39;.text-center.py-3.text-gray-500&#39;);
                     if (versionInfo) {
                         versionInfo.style.display = &#39;none&#39;;
                     }
                     
                     // 隱藏單人模式的秒錶、生命值、篇章名稱等元素
                     const stopwatch = document.getElementById(&#39;stopwatch&#39;);
                     if (stopwatch) {
                         stopwatch.style.display = &#39;none&#39;;
                     }
                     
                     const lives = document.getElementById(&#39;lives&#39;);
                     if (lives) {
                         lives.style.display = &#39;none&#39;;
                     }
                     
                     // 隱藏單人模式的進度條
                     const progressContainer = document.querySelector(&#39;.w-full.max-w-\\[200px\\]&#39;);
                     if (progressContainer) {
                         progressContainer.style.display = &#39;none&#39;;
                     }
                     
                     const passageInfo = document.querySelector(&#39;.passage-info&#39;);
                     if (passageInfo) {
                         passageInfo.style.display = &#39;none&#39;;
                     }
                     
                     const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                     if (returnHomeBtn) {
                         returnHomeBtn.style.display = &#39;none&#39;;
                     }
                     
                     // 設置雙人模式總字數
                     const totalCharsTop = document.getElementById(&#39;total-chars-top&#39;);
                     const totalCharsBottom = document.getElementById(&#39;total-chars-bottom&#39;);
                     
                     if (totalCharsTop) totalCharsTop.textContent = totalNonPunctChars;
                     if (totalCharsBottom) totalCharsBottom.textContent = totalNonPunctChars;
                     
                     // 重置計時器變量但不立即啟動計時器
                     elapsedTimeBeforePauseTop = 0;
                     elapsedTimeBeforePauseBottom = 0;
                     multiplayerTimersStarted = false;
                     
                     // 清除上一局遊戲顯示的字符
                     const lastAnsweredCharsTop = document.getElementById(&#39;last-answered-chars-top&#39;);
                     const lastAnsweredCharsBottom = document.getElementById(&#39;last-answered-chars-bottom&#39;);
                     const currentCharTop = document.getElementById(&#39;current-char-top&#39;);
                     const currentCharBottom = document.getElementById(&#39;current-char-bottom&#39;);
                     
                     if (lastAnsweredCharsTop) lastAnsweredCharsTop.innerHTML = &#39;&#39;;
                     if (lastAnsweredCharsBottom) lastAnsweredCharsBottom.innerHTML = &#39;&#39;;
                     if (currentCharTop) currentCharTop.textContent = &#39;&#39;;
                     if (currentCharBottom) currentCharBottom.textContent = &#39;&#39;;
                     
                     // 重置進度顯示
                     const progressBarTop = document.getElementById(&#39;progress-bar-top&#39;);
                     const progressBarBottom = document.getElementById(&#39;progress-bar-bottom&#39;);
                     const progressTextTop = document.getElementById(&#39;progress-text-top&#39;);
                     const progressTextBottom = document.getElementById(&#39;progress-text-bottom&#39;);
                     
                     if (progressBarTop) progressBarTop.style.width = &#39;0%&#39;;
                     if (progressBarBottom) progressBarBottom.style.width = &#39;0%&#39;;
                     if (progressTextTop) progressTextTop.textContent = `0 / ${totalNonPunctChars}`;
                     if (progressTextBottom) progressTextBottom.textContent = `0 / ${totalNonPunctChars}`;
                 }
                 
                 // 添加雙人模式暫停按鈕事件
                 setupMultiplayerPauseButtons();
                 
                 // 开始游戏倒计时
                 const multiplayerCountdown = document.getElementById(&#39;multiplayer-countdown&#39;);
                 if (multiplayerCountdown) {
                     multiplayerCountdown.classList.remove(&#39;hidden&#39;);
                     
                     // 使用绿点倒计时
                     let countdownDots = 3;
                     let countdownText = &#39;&#39;;
                     
                     function updateCountdownDots() {
                         countdownText = &#39;&#39;;
                         for (let i = 0; i &lt; countdownDots; i++) {
                             countdownText += &#39;●&#39;;
                         }
                         multiplayerCountdown.querySelector(&#39;div&#39;).textContent = countdownText;
                         
                         if (countdownDots &gt; 0) {
                             countdownDots--;
                             setTimeout(updateCountdownDots, 1000);
                         } else {
                             // 倒计时结束，开始游戏
                             multiplayerCountdown.classList.add(&#39;hidden&#39;);
                             window.multiplayerMode.gameStarted = true;
                             
                             // 在倒計時結束後啟動計時器
                             multiplayerTimersStarted = true;
                             startMultiplayerTimers();
                             
                             // 为两位玩家生成选项
                             updateMultiplayerDisplay();
                         }
                     }
                     
                     updateCountdownDots();
                 }
             }
             
             // 設置雙人模式的暫停按鈕功能
             function setupMultiplayerPauseButtons() {
                 const pauseBtnTop = document.getElementById(&#39;pause-btn-top&#39;);
                 const pauseBtnBottom = document.getElementById(&#39;pause-btn-bottom&#39;);
                 const multiplayerPauseOverlay = document.getElementById(&#39;multiplayer-pause-overlay&#39;);
                 const multiplayerContinueBtn = document.getElementById(&#39;multiplayer-continue-btn&#39;);
                 const multiplayerReturnBtn = document.getElementById(&#39;multiplayer-return-btn&#39;);
                 const multiplayerCountdownResume = document.getElementById(&#39;multiplayer-countdown-resume&#39;);
                 
                 // 雙人模式暫停狀態
                 let isMultiplayerPaused = false;
                 let multiplayerResumeCountdown = null;
                 
                 // 暫停函數
                 function pauseMultiplayerGame() {
                     if (isMultiplayerPaused) return;
                     
                     isMultiplayerPaused = true;
                     
                     // 暫停兩位玩家的計時器
                     stopMultiplayerTimers();
                     
                     // 禁止選擇選項
                     window.multiplayerMode.players.forEach(player =&gt; {
                         player.canSelect = false;
                     });
                     
                     // 顯示暫停覆蓋層
                     if (multiplayerPauseOverlay) {
                         multiplayerPauseOverlay.classList.remove(&#39;hidden&#39;);
                     }
                 }
                 
                 // 繼續遊戲函數
                 function resumeMultiplayerGame() {
                     if (!isMultiplayerPaused) return;
                     
                     isMultiplayerPaused = false;
                     
                     // 隱藏暫停覆蓋層
                     if (multiplayerPauseOverlay) {
                         multiplayerPauseOverlay.classList.add(&#39;hidden&#39;);
                     }
                     
                     // 確保計時器標記為已啟動
                     multiplayerTimersStarted = true;
                     
                     // 恢復計時器
                     startMultiplayerTimers();
                     
                     // 允許選擇選項
                     window.multiplayerMode.players.forEach(player =&gt; {
                         player.canSelect = true;
                     });
                 }
                 
                 // 上方玩家暫停按鈕
                 if (pauseBtnTop) {
                     pauseBtnTop.addEventListener(&#39;click&#39;, function() {
                         if (!window.multiplayerMode.gameStarted || window.multiplayerMode.winner !== null) return;
                         pauseMultiplayerGame();
                     });
                 }
                 
                 // 下方玩家暫停按鈕
                 if (pauseBtnBottom) {
                     pauseBtnBottom.addEventListener(&#39;click&#39;, function() {
                         if (!window.multiplayerMode.gameStarted || window.multiplayerMode.winner !== null) return;
                         pauseMultiplayerGame();
                     });
                 }
                 
                 // 繼續遊戲按鈕
                 if (multiplayerContinueBtn) {
                     multiplayerContinueBtn.addEventListener(&#39;click&#39;, function() {
                         // 隱藏按鈕，顯示倒計時
                         const pauseButtons = document.getElementById(&#39;multiplayer-pause-buttons&#39;);
                         if (pauseButtons) {
                             pauseButtons.classList.add(&#39;hidden&#39;);
                         }
                         
                         if (multiplayerCountdownResume) {
                             multiplayerCountdownResume.classList.remove(&#39;hidden&#39;);
                         }
                         
                         let count = 3;
                         const countdownNumber = multiplayerCountdownResume.querySelector(&#39;.pause-countdown-number&#39;);
                         if (countdownNumber) {
                             countdownNumber.textContent = count;
                         }
                         
                         // 清除可能存在的倒計時
                         if (multiplayerResumeCountdown) {
                             clearInterval(multiplayerResumeCountdown);
                         }
                         
                         // 開始新的倒計時
                         multiplayerResumeCountdown = setInterval(function() {
                             count--;
                             if (countdownNumber) {
                                 countdownNumber.textContent = count;
                                 countdownNumber.style.animation = &#39;none&#39;;
                                 void countdownNumber.offsetWidth; // 重置動畫
                                 countdownNumber.style.animation = &#39;countdownPulse 1s ease-out&#39;;
                             }
                             
                             if (count &lt;= 0) {
                                 clearInterval(multiplayerResumeCountdown);
                                 multiplayerResumeCountdown = null;
                                 
                                 // 恢復遊戲
                                 resumeMultiplayerGame();
                                 
                                 // 重置界面
                                 if (pauseButtons) {
                                     pauseButtons.classList.remove(&#39;hidden&#39;);
                                 }
                                 if (multiplayerCountdownResume) {
                                     multiplayerCountdownResume.classList.add(&#39;hidden&#39;);
                                 }
                             }
                         }, 1000);
                     });
                 }
                 
                 // 返回主頁按鈕 - 修改為直接返回遊戲開始界面
                 if (multiplayerReturnBtn) {
                     multiplayerReturnBtn.addEventListener(&#39;click&#39;, function() {
                         // 隱藏暫停覆蓋層
                         if (multiplayerPauseOverlay) {
                             multiplayerPauseOverlay.classList.add(&#39;hidden&#39;);
                         }
                         
                         // 清除倒計時
                         if (multiplayerResumeCountdown) {
                             clearInterval(multiplayerResumeCountdown);
                             multiplayerResumeCountdown = null;
                         }
                         
                         // 重置界面
                         const pauseButtons = document.getElementById(&#39;multiplayer-pause-buttons&#39;);
                         if (pauseButtons) {
                             pauseButtons.classList.remove(&#39;hidden&#39;);
                         }
                         if (multiplayerCountdownResume) {
                             multiplayerCountdownResume.classList.add(&#39;hidden&#39;);
                         }
                         
                         // 重置雙人模式狀態
                         window.multiplayerMode.active = false;
                         isMultiplayerPaused = false;
                         
                         // 停止計時器
                         stopMultiplayerTimers();
                         
                         // 重要：完全重置計時器相關變量
                         timerTopInterval = null;
                         timerBottomInterval = null;
                         startTimeTop = null;
                         startTimeBottom = null;
                         elapsedTimeBeforePauseTop = 0;
                         elapsedTimeBeforePauseBottom = 0;
                         
                         // 重新顯示之前隱藏的元素
                         const headerElement = document.querySelector(&#39;header&#39;);
                         if (headerElement) {
                             headerElement.style.display = &#39;block&#39;;
                         }
                         
                         const passageSelector = document.querySelector(&#39;.passage-selector&#39;);
                         if (passageSelector) {
                             passageSelector.style.display = &#39;block&#39;;
                         }
                         
                         // 恢復設置按鈕和版本號
                         if (document.getElementById(&#39;settings-button&#39;)) {
                             document.getElementById(&#39;settings-button&#39;).style.display = &#39;flex&#39;;
                         }
                         
                         // 恢復底部版本信息
                         const versionInfo = document.querySelector(&#39;.text-center.py-3.text-gray-500&#39;);
                         if (versionInfo) {
                             versionInfo.style.display = &#39;block&#39;;
                         }
                         
                         // 恢復單人模式UI元素
                         const stopwatch = document.getElementById(&#39;stopwatch&#39;);
                         if (stopwatch) {
                             stopwatch.style.display = &#39;block&#39;;
                         }
                         
                         const lives = document.getElementById(&#39;lives&#39;);
                         if (lives) {
                             lives.style.display = &#39;block&#39;;
                         }
                         
                     // 恢復單人模式進度條
                     const progressContainer = document.querySelector(&#39;.w-full.max-w-\\[200px\\]&#39;);
                     if (progressContainer) {
                         progressContainer.style.display = &#39;block&#39;;
                     }

                         const passageInfo = document.querySelector(&#39;.passage-info&#39;);
                         if (passageInfo) {
                             passageInfo.style.display = &#39;block&#39;;
                         }
                         
                         // 確保返回主頁按鈕顯示
                         const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                         if (returnHomeBtn) {
                             returnHomeBtn.classList.remove(&#39;hidden&#39;);
                             returnHomeBtn.style.display = &#39;flex&#39;;
                         }
                         
                         // 直接返回遊戲開始界面, 不觸發返回主頁按鈕
                         const gameStartScreen = document.getElementById(&#39;game-start-screen&#39;);
                         const gameContent = document.getElementById(&#39;game-content&#39;);
                         const gamePage = document.getElementById(&#39;game-page&#39;);
                         
                         if (gameStartScreen &amp;&amp; gameContent &amp;&amp; gamePage) {
                             // 隱藏遊戲內容，顯示開始畫面
                             gameContent.classList.add(&#39;hidden&#39;);
                             gameStartScreen.classList.remove(&#39;hidden&#39;);
                             
                             // 顯示遊戲頁面
                             gamePage.classList.remove(&#39;hidden&#39;);
                             gamePage.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important;&#39;;
                             
                             // 確保書本頁面翻轉效果生效
                             const bookPage = document.querySelector(&#39;.page&#39;);
                             if (bookPage) {
                                 bookPage.classList.add(&#39;turned&#39;);
                             }
                             
                             // 切換回單人模式 - 使用gameModeSwitch
                             if (gameModeSwitch &amp;&amp; gameModeSwitch.checked) {
                                 gameModeSwitch.checked = false;
                                 window.gameMode = &#39;single&#39;;
                                 console.log(&quot;返回主頁：已切換到單人模式&quot;);
                             }
                         }
                     });
                 }
                 
                 // 鍵盤事件 - ESC 鍵暫停/繼續
                 document.addEventListener(&#39;keydown&#39;, function(e) {
                     if (e.key === &#39;Escape&#39; &amp;&amp; window.multiplayerMode.active &amp;&amp; window.multiplayerMode.gameStarted) {
                         if (isMultiplayerPaused) {
                             // 如果已暫停，按ESC將觸發繼續按鈕
                             if (multiplayerContinueBtn) {
                                 multiplayerContinueBtn.click();
                             }
                         } else {
                             // 如果未暫停，按ESC將暫停遊戲
                             pauseMultiplayerGame();
                         }
                     }
                 });
             }
             
             // 雙人模式計時器相關變量
             let timerTopInterval = null;
             let timerBottomInterval = null;
             let startTimeTop = null;
             let startTimeBottom = null;
             let elapsedTimeBeforePauseTop = 0;
             let elapsedTimeBeforePauseBottom = 0;
             let multiplayerTimersStarted = false; // 標記計時器是否已經開始
             
             // 開始雙人模式計時器
             function startMultiplayerTimers() {
                 // 如果計時器尚未開始或已被暫停，則啟動計時器
                 if (!multiplayerTimersStarted) {
                     console.log(&quot;雙人模式計時器尚未啟動，等待倒計時結束&quot;);
                     return;
                 }
                 
                 const timerTopElement = document.getElementById(&#39;timer-top&#39;);
                 const timerBottomElement = document.getElementById(&#39;timer-bottom&#39;);
                 
                 // 設置開始時間 - 考慮先前累積的時間
                 startTimeTop = new Date();
                 startTimeBottom = new Date();
                 
                 console.log(&quot;開始雙人模式計時器&quot;);
                 
                 // 啟動上方玩家計時器
                 timerTopInterval = setInterval(function() {
                     if (!timerTopElement) return;
                     
                     const currentTime = new Date();
                     const totalElapsedMs = elapsedTimeBeforePauseTop + (currentTime - startTimeTop);
                     
                     // 轉換為時間格式
                     const totalElapsedDate = new Date(totalElapsedMs);
                     const minutes = String(totalElapsedDate.getUTCMinutes()).padStart(2, &#39;0&#39;);
                     const seconds = String(totalElapsedDate.getUTCSeconds()).padStart(2, &#39;0&#39;);
                     const tenths = Math.floor(totalElapsedDate.getUTCMilliseconds() / 100);
                     
                     timerTopElement.textContent = `${minutes}:${seconds}.${tenths}`;
                 }, 100);
                 
                 // 啟動下方玩家計時器
                 timerBottomInterval = setInterval(function() {
                     if (!timerBottomElement) return;
                     
                     const currentTime = new Date();
                     const totalElapsedMs = elapsedTimeBeforePauseBottom + (currentTime - startTimeBottom);
                     
                     // 轉換為時間格式
                     const totalElapsedDate = new Date(totalElapsedMs);
                     const minutes = String(totalElapsedDate.getUTCMinutes()).padStart(2, &#39;0&#39;);
                     const seconds = String(totalElapsedDate.getUTCSeconds()).padStart(2, &#39;0&#39;);
                     const tenths = Math.floor(totalElapsedDate.getUTCMilliseconds() / 100);
                     
                     timerBottomElement.textContent = `${minutes}:${seconds}.${tenths}`;
                 }, 100);
             }
             
             // 停止雙人模式計時器
             function stopMultiplayerTimers() {
                 // 停止上方玩家計時器並保存累計時間
                 if (timerTopInterval) {
                     clearInterval(timerTopInterval);
                     timerTopInterval = null;
                     
                     if (startTimeTop) {
                         const currentTime = new Date();
                         elapsedTimeBeforePauseTop += (currentTime - startTimeTop);
                         startTimeTop = null;
                     }
                 }
                 
                 // 停止下方玩家計時器並保存累計時間
                 if (timerBottomInterval) {
                     clearInterval(timerBottomInterval);
                     timerBottomInterval = null;
                     
                     if (startTimeBottom) {
                         const currentTime = new Date();
                         elapsedTimeBeforePauseBottom += (currentTime - startTimeBottom);
                         startTimeBottom = null;
                     }
                 }
                 
                 // 標記計時器未啟動
                 multiplayerTimersStarted = false;
             }
             
             // 更新双人模式显示
             function updateMultiplayerDisplay() {
                 // 更新上方玩家
                 updatePlayerDisplay(0);
                 // 更新下方玩家
                 updatePlayerDisplay(1);
                 
                 // 更新進度條
                 updateMultiplayerProgress();
                 
                 // 隱藏單人模式進度條
                 const singleProgressContainer = document.querySelector(&#39;.w-full.max-w-\\[200px\\]&#39;);
                 if (singleProgressContainer) {
                     singleProgressContainer.style.display = &#39;none&#39;;
                 }
             }
             
             // 更新雙人模式進度條
             function updateMultiplayerProgress() {
                 // 上方玩家進度
                 const player1 = window.multiplayerMode.players[0];
                 const player1Progress = player1.correctAnswers;
                 const totalCharsTop = document.getElementById(&#39;total-chars-top&#39;);
                 const progressTextTop = document.getElementById(&#39;progress-text-top&#39;);
                 const progressBarTop = document.getElementById(&#39;progress-bar-top&#39;);
                 
                 // 下方玩家進度
                 const player2 = window.multiplayerMode.players[1];
                 const player2Progress = player2.correctAnswers;
                 const totalCharsBottom = document.getElementById(&#39;total-chars-bottom&#39;);
                 const progressTextBottom = document.getElementById(&#39;progress-text-bottom&#39;);
                 const progressBarBottom = document.getElementById(&#39;progress-bar-bottom&#39;);
                 
                 // 更新顯示
                 if (totalCharsTop) totalCharsTop.textContent = totalNonPunctChars;
                 if (progressTextTop) progressTextTop.textContent = `${player1Progress} / ${totalNonPunctChars}`;
                 if (progressBarTop) {
                     const progressPercentage = (totalNonPunctChars &gt; 0) ? (player1Progress / totalNonPunctChars * 100) : 0;
                     progressBarTop.style.width = `${progressPercentage}%`;
                 }
                 
                 if (totalCharsBottom) totalCharsBottom.textContent = totalNonPunctChars;
                 if (progressTextBottom) progressTextBottom.textContent = `${player2Progress} / ${totalNonPunctChars}`;
                 if (progressBarBottom) {
                     const progressPercentage = (totalNonPunctChars &gt; 0) ? (player2Progress / totalNonPunctChars * 100) : 0;
                     progressBarBottom.style.width = `${progressPercentage}%`;
                 }
             }
             
             // 更新单个玩家显示
             function updatePlayerDisplay(playerIndex) {
                 const player = window.multiplayerMode.players[playerIndex];
                 const position = player.currentPosition;
                 const isTop = playerIndex === 0;
                 const prefix = isTop ? &#39;top&#39; : &#39;bottom&#39;;
                 
                 const currentCharElement = document.getElementById(`current-char-${prefix}`);
                 const optionsContainer = document.getElementById(`options-container-${prefix}`);
                 const lastAnsweredCharsElement = document.getElementById(`last-answered-chars-${prefix}`);
                 
                 if (!currentCharElement || !optionsContainer) return;
                 
                 // 跳过标点符号
                 while (position &lt; content.length &amp;&amp; isPunctuation(content[position])) {
                     player.currentPosition++;
                 }
                 
                 // 更新当前字符显示
                 if (player.currentPosition &lt; content.length) {
                     currentCharElement.textContent = &#39;&#39;;
                     
                     // 生成选项
                     generateMultiplayerOptions(playerIndex);
                     
                     // 更新已回答字符
                     if (lastAnsweredCharsElement &amp;&amp; player.lastAnsweredChars.length &gt; 0) {
                         let htmlContent = &#39;&#39;;
                         
                         // 找出最后一个非标点符号字符的索引
                         let lastNonPunctIndex = -1;
                         for (let i = player.lastAnsweredChars.length - 1; i &gt;= 0; i--) {
                             if (!isPunctuation(player.lastAnsweredChars[i])) {
                                 lastNonPunctIndex = i;
                                 break;
                             }
                         }
                         
                         // 构建HTML内容
                         for (let i = 0; i &lt; player.lastAnsweredChars.length; i++) {
                             // 如果是最后一个非标点符号字符，加粗放大
                             if (i === lastNonPunctIndex) {
                                 htmlContent += `&lt;span class=&quot;text-2xl md:text-3xl font-bold&quot;&gt;${player.lastAnsweredChars[i]}&lt;/span&gt;`;
                             } else {
                                 htmlContent += player.lastAnsweredChars[i];
                             }
                         }
                         
                         lastAnsweredCharsElement.innerHTML = htmlContent;
                     }
                 } else {
                     // 玩家已完成游戏
                     handleMultiplayerGameEnd(playerIndex);
                 }
             }
             
             // 为玩家生成选项
             function generateMultiplayerOptions(playerIndex) {
                 const player = window.multiplayerMode.players[playerIndex];
                 const pos = player.currentPosition;
                 const isTop = playerIndex === 0;
                 const prefix = isTop ? &#39;top&#39; : &#39;bottom&#39;;
                 
                 const optionsContainer = document.getElementById(`options-container-${prefix}`);
                 if (!optionsContainer || pos &gt;= content.length) return;
                 
                 // 清空选项容器
                 optionsContainer.innerHTML = &#39;&#39;;
                 
                 // 获取正确答案
                 const correctAnswer = content[pos];
                 
                 // 生成两个干扰选项
                 let options = [correctAnswer];
                 
                 while (options.length &lt; 3) {
                     const randomIndex = Math.floor(Math.random() * content.length);
                     const randomChar = content[randomIndex];
                     
                     // 确保不重复且不是标点符号
                     if (!options.includes(randomChar) &amp;&amp; 
                         !isPunctuation(randomChar) &amp;&amp; 
                         randomChar !== correctAnswer) {
                         options.push(randomChar);
                     }
                 }
                 
                 // 打乱选项顺序
                 options = shuffleArray(options);
                 
                 // 创建选项按钮
                 options.forEach(option =&gt; {
                     const btn = document.createElement(&#39;button&#39;);
                     btn.className = &#39;option-btn h-16 md:h-20 text-2xl md:text-3xl bg-white dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none&#39;;
                     btn.textContent = option;
                     
                     btn.addEventListener(&#39;click&#39;, function() {
                         const playerObj = window.multiplayerMode.players[playerIndex];
                         if (!playerObj.canSelect || !window.multiplayerMode.gameStarted) return;
                         
                         if (option === correctAnswer) {
                             handleMultiplayerCorrectAnswer(playerIndex, btn);
                         } else {
                             handleMultiplayerIncorrectAnswer(playerIndex, btn);
                         }
                     });
                     
                     optionsContainer.appendChild(btn);
                 });
             }
             
             // 处理双人模式正确答案
             function handleMultiplayerCorrectAnswer(playerIndex, btn) {
                 const player = window.multiplayerMode.players[playerIndex];
                 player.correctAnswers++;
                 
                 // 添加动画效果
                 btn.classList.add(&#39;correct&#39;);
                 
                 // 添加当前字符到已回答字符列表
                 player.lastAnsweredChars.push(content[player.currentPosition]);
                 
                 // 保存当前位置并前进
                 const savedPosition = player.currentPosition;
                 player.currentPosition++;
                 
                 // 检查并添加标点符号
                 while (player.currentPosition &lt; content.length &amp;&amp; isPunctuation(content[player.currentPosition])) {
                     player.lastAnsweredChars.push(content[player.currentPosition]);
                     player.currentPosition++;
                 }
                 
                 // 如果超出最大显示字符限制，移除最早的字符
                 const MAX_DISPLAYED_CHARS = 15;
                 while (player.lastAnsweredChars.length &gt; MAX_DISPLAYED_CHARS) {
                     player.lastAnsweredChars.shift();
                 }
                 
                 // 即時更新進度條
                 updateMultiplayerProgress();
                 
                 //雙人模式節奏快速
                 setTimeout(() =&gt; {
                     updatePlayerDisplay(playerIndex);
                 }, 10); 
             }
             
             // 处理双人模式错误答案
             function handleMultiplayerIncorrectAnswer(playerIndex, btn) {
                 const player = window.multiplayerMode.players[playerIndex];
                 const isTop = playerIndex === 0;
                 const prefix = isTop ? &#39;top&#39; : &#39;bottom&#39;;
                 
                 // 添加错误效果
                 btn.classList.add(&#39;incorrect&#39;);
                 
                 // 禁用选择3秒
                 player.canSelect = false;
                 
                 // 显示错误覆盖层和红点计时器
                 const errorOverlay = document.getElementById(`${prefix}-player-error-overlay`);
                 const errorTimer = document.getElementById(`${prefix}-error-timer`);
                 
                 if (errorOverlay &amp;&amp; errorTimer) {
                     // 显示覆盖层
                     errorOverlay.classList.remove(&#39;hidden&#39;);
                     errorOverlay.style.display = &#39;flex&#39;;
                     
                     // 红点计时
                     let dots = 3;
                     errorTimer.textContent = &#39;●●●&#39;;
                     
                     // 清除之前的计时器
                     if (player.errorTimer) {
                         clearInterval(player.errorTimer);
                     }
                     
                     // 设置新计时器
                     player.errorTimer = setInterval(() =&gt; {
                         dots--;
                         let dotText = &#39;&#39;;
                         for (let i = 0; i &lt; dots; i++) {
                             dotText += &#39;●&#39;;
                         }
                         errorTimer.textContent = dotText;
                         
                         if (dots &lt;= 0) {
                             clearInterval(player.errorTimer);
                             player.errorTimer = null;
                             errorOverlay.classList.add(&#39;hidden&#39;);
                             // 確保錯誤覆蓋層完全隱藏
                             errorOverlay.style.display = &#39;none&#39;;
                             player.canSelect = true;
                             
                             // 移除按钮错误效果
                             btn.classList.remove(&#39;incorrect&#39;);
                         }
                     }, 1000);
                 }
             }
             
             // 處理雙人模式遊戲結束
             function handleMultiplayerGameEnd(winnerIndex) {
                 // 如果已經有獲勝者，不再處理
                 if (window.multiplayerMode.winner !== null) return;
                 
                 // 設置獲勝者
                 window.multiplayerMode.winner = winnerIndex;
                 window.multiplayerMode.gameStarted = false;
                 
                 // 停止計時器
                 stopMultiplayerTimers();
                 
                 // 創建獲勝提示層
                 const victoryOverlay = document.createElement(&#39;div&#39;);
                 victoryOverlay.className = &#39;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[1000]&#39;;
                 victoryOverlay.id = &#39;multiplayer-victory-overlay&#39;;
                 
                 // 獲取雙方進度
                 const player1Progress = window.multiplayerMode.players[0].correctAnswers;
                 const player2Progress = window.multiplayerMode.players[1].correctAnswers;
                 
                 // 獲取勝利玩家的計時器內容
                 const winnerTimerElement = winnerIndex === 0 ? 
                     document.getElementById(&#39;timer-top&#39;) : 
                     document.getElementById(&#39;timer-bottom&#39;);
                 
                 const winnerTime = winnerTimerElement ? winnerTimerElement.textContent : &quot;00:00.0&quot;;
                 
                 victoryOverlay.innerHTML = `
                     &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center&quot;&gt;
                         &lt;h2 class=&quot;text-2xl font-bold text-green-600 dark:text-green-400 mb-6&quot;&gt;${winnerIndex === 0 ? &#39;上方&#39; : &#39;下方&#39;}玩家獲勝！&lt;/h2&gt;
                         &lt;div class=&quot;bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-5&quot;&gt;
                             &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;完成時間: ${winnerTime}&lt;/p&gt;
                             &lt;div class=&quot;flex justify-between items-center mt-2 px-4&quot;&gt;
                                 &lt;span class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;上方玩家&lt;/span&gt;
                                 &lt;span class=&quot;font-medium&quot;&gt;${player1Progress} 字&lt;/span&gt;
                             &lt;/div&gt;
                             &lt;div class=&quot;flex justify-between items-center mt-1 px-4&quot;&gt;
                                 &lt;span class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;下方玩家&lt;/span&gt;
                                 &lt;span class=&quot;font-medium&quot;&gt;${player2Progress} 字&lt;/span&gt;
                             &lt;/div&gt;
                         &lt;/div&gt;
                         &lt;div class=&quot;flex justify-center gap-6 mt-4&quot;&gt;
                             &lt;button id=&quot;restart-multi-btn&quot; class=&quot;w-12 h-12 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors flex items-center justify-center text-xl&quot;&gt;
                                 &lt;i class=&quot;fas fa-redo&quot;&gt;&lt;/i&gt;
                             &lt;/button&gt;
                             &lt;button id=&quot;return-home-multi-btn&quot; class=&quot;w-12 h-12 bg-primary text-white rounded-full hover:bg-opacity-90 flex items-center justify-center text-xl&quot;&gt;
                                 &lt;i class=&quot;fas fa-home&quot;&gt;&lt;/i&gt;
                             &lt;/button&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
                 `;
                 
                 document.body.appendChild(victoryOverlay);
                 
                 // 添加按鈕事件
                 document.getElementById(&#39;restart-multi-btn&#39;).addEventListener(&#39;click&#39;, function() {
                     // 移除勝利提示
                     document.body.removeChild(victoryOverlay);
                     // 重新開始雙人遊戲
                     startMultiplayerGame();
                 });
                 
                 document.getElementById(&#39;return-home-multi-btn&#39;).addEventListener(&#39;click&#39;, function() {
                     // 移除勝利提示
                     document.body.removeChild(victoryOverlay);
                     
                     // 重置狀態
                     window.multiplayerMode.active = false;
                     
                     // 重要：完全重置計時器相關變量
                     if (timerTopInterval) {
                         clearInterval(timerTopInterval);
                         timerTopInterval = null;
                     }
                     if (timerBottomInterval) {
                         clearInterval(timerBottomInterval);
                         timerBottomInterval = null;
                     }
                     startTimeTop = null;
                     startTimeBottom = null;
                     elapsedTimeBeforePauseTop = 0;
                     elapsedTimeBeforePauseBottom = 0;
                     multiplayerTimersStarted = false;
                     
                     // 顯示單人UI，隱藏雙人UI
                     const singlePlayerUI = document.getElementById(&#39;single-player-ui&#39;);
                     const multiplayerUI = document.getElementById(&#39;multiplayer-ui&#39;);
                     
                     if (singlePlayerUI &amp;&amp; multiplayerUI) {
                         multiplayerUI.classList.add(&#39;hidden&#39;);
                     }
                     
                     // 切換回單人模式 - 使用新的滑塊
                     if (gameModeSwitch &amp;&amp; gameModeSwitch.checked) {
                         gameModeSwitch.checked = false;
                         window.gameMode = &#39;single&#39;;
                         console.log(&quot;勝利返回：已切換到單人模式&quot;);
                     }
                     
                     // 重新顯示之前隱藏的元素
                     const headerElement = document.querySelector(&#39;header&#39;);
                     if (headerElement) {
                         headerElement.style.display = &#39;block&#39;;
                     }
                     
                     const passageSelector = document.querySelector(&#39;.passage-selector&#39;);
                     if (passageSelector) {
                         passageSelector.style.display = &#39;block&#39;;
                     }
                     
                     // 恢復設置按鈕和版本號
                     if (document.getElementById(&#39;settings-button&#39;)) {
                         document.getElementById(&#39;settings-button&#39;).style.display = &#39;flex&#39;;
                     }
                     
                     // 恢復底部版本信息
                     const versionInfo = document.querySelector(&#39;.text-center.py-3.text-gray-500&#39;);
                     if (versionInfo) {
                         versionInfo.style.display = &#39;block&#39;;
                     }
                     
                     // 恢復單人模式UI元素
                     const stopwatch = document.getElementById(&#39;stopwatch&#39;);
                     if (stopwatch) {
                         stopwatch.style.display = &#39;block&#39;;
                     }
                     
                     const lives = document.getElementById(&#39;lives&#39;);
                     if (lives) {
                         lives.style.display = &#39;block&#39;;
                     }
                     
                     // 恢復單人模式進度條
                     const progressContainer = document.querySelector(&#39;.w-full.max-w-\\[200px\\]&#39;);
                     if (progressContainer) {
                         progressContainer.style.display = &#39;block&#39;;
                     }
                     
                     const passageInfo = document.querySelector(&#39;.passage-info&#39;);
                     if (passageInfo) {
                         passageInfo.style.display = &#39;block&#39;;
                     }
                     
                     // 確保返回主頁按鈕顯示
                     const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                     if (returnHomeBtn) {
                         returnHomeBtn.classList.remove(&#39;hidden&#39;);
                         returnHomeBtn.style.display = &#39;flex&#39;;
                     }
                     
                     // 確保暫停按鈕隱藏
                     const pauseBtn = document.getElementById(&#39;pause-btn&#39;);
                     if (pauseBtn) {
                         pauseBtn.classList.add(&#39;hidden&#39;);
                     }
                     
                     // 直接返回遊戲開始界面
                     const gameStartScreen = document.getElementById(&#39;game-start-screen&#39;);
                     const gameContent = document.getElementById(&#39;game-content&#39;);
                     
                     if (gameStartScreen &amp;&amp; gameContent) {
                         // 隱藏遊戲內容，顯示開始畫面
                         gameContent.classList.add(&#39;hidden&#39;);
                         gameStartScreen.classList.remove(&#39;hidden&#39;);
                     }
                     
                     console.log(&quot;已重置計時器並更新遊戲控制按鈕&quot;);
                 });
             }
             
             // 开始游戏按钮事件
             if (startGameBtn) {
                 startGameBtn.addEventListener(&#39;click&#39;, function() {
                     // 根据当前模式进入相应游戏
                     if (window.gameMode === &#39;multi&#39;) {
                         // 显示双人模式确认对话框
                         showMultiplayerConfirm();
                     } else {
                         // 单人模式原有逻辑
                         gameStartScreen.classList.add(&#39;hidden&#39;);
                         countdownContainer.classList.remove(&#39;hidden&#39;);
                         
                         // 確保選擇背誦段落界面關閉
                         passageContent.classList.add(&#39;hidden&#39;);
                         passageToggle.style.transform = &#39;rotate(0deg)&#39;;
                         passageContainer.style.maxHeight = &#39;46px&#39;;
                         
                         // 重置暫停狀態
                         hasPaused = false;
                         
                         // 在倒計時期間禁用設置按鈕
                         window.disableSettingsButton();
                         
                         let countdown = 3;
                         
                         // 显示倒计时
                         function showCountdown() {
                             if (countdown &gt; 0) {
                                 countdownNumber.textContent = countdown;
                                 countdownNumber.style.animation = &#39;none&#39;;
                                 void countdownNumber.offsetWidth; // 重置动画
                                 countdownNumber.style.animation = &#39;countdown-pulse 1s ease-in-out&#39;;
                                 
                                 countdown--;
                                 setTimeout(showCountdown, 1000);
                             } else {
                                 // 倒计时结束，显示&quot;开始！&quot;
                                 countdownNumber.textContent = &#39;開始！&#39;;
                                 countdownNumber.style.animation = &#39;none&#39;;
                                 void countdownNumber.offsetWidth;
                                 countdownNumber.style.animation = &#39;countdown-pulse 0.7s ease-in-out&#39;;
                                 
                                 // 开始游戏
                                 setTimeout(function() {
                                     countdownContainer.classList.add(&#39;hidden&#39;);
                                     gameContent.classList.remove(&#39;hidden&#39;);
                                     
                                     // 确保显示单人UI
                                     const singlePlayerUI = document.getElementById(&#39;single-player-ui&#39;);
                                     const multiplayerUI = document.getElementById(&#39;multiplayer-ui&#39;);
                                     
                                     if (singlePlayerUI &amp;&amp; multiplayerUI) {
                                         singlePlayerUI.classList.remove(&#39;hidden&#39;);
                                         multiplayerUI.classList.add(&#39;hidden&#39;);
                                     }
                                     
                                     // 切換按鈕顯示為暫停按鈕
                                     updateGameControlButtons(&#39;playing&#39;);
                                     
                                     // 重置並開始秒表 (確保從0開始)
                                     elapsedTimeBeforePause = 0; // 重置累計時間
                                     resetStopwatch();
                                     
                                     // 遊戲開始后重新啟用設置按鈕
                                     window.enableSettingsButton();
                                     
                                     // 显示游戏内容
                                     updateDisplay();
                                 }, 800);
                             }
                         }
                         
                         showCountdown();
                     }
                 });
             } else {
                 console.error(&quot;開始遊戲按鈕未找到&quot;);
             }
             
             // 选择篇章功能
             const passageContainer = document.getElementById(&#39;passage-container&#39;);
             const passageHeader = document.getElementById(&#39;passage-header&#39;);
             const passageToggle = document.getElementById(&#39;passage-toggle&#39;);
             const passageContent = document.getElementById(&#39;passage-content&#39;);
             const categoryBtns = document.querySelectorAll(&#39;.category-btn&#39;);
             const passageList = document.getElementById(&#39;passage-list&#39;);
             
         // 完整的事件監聽函數替換
         if (passageHeader &amp;&amp; passageToggle &amp;&amp; passageContent) {
         // 篇章選擇器默認關閉
         // 用戶需要點擊才會打開
         
         // 在全局變量區域添加一個標記
         let isFirstTimeOpeningSelector = true; // 標記是否是首次打開篇章選擇器
         
         // 切换篇章選擇器
         passageHeader.addEventListener(&#39;click&#39;, function() {
         console.log(&quot;篇章標頭被點擊&quot;);
         
         if (passageContent.classList.contains(&#39;hidden&#39;)) {
         // 打開篇章選擇器
         console.log(&quot;打開篇章選擇器&quot;);
         passageContent.classList.remove(&#39;hidden&#39;);
         passageToggle.style.transform = &#39;rotate(180deg)&#39;;
         
         // 添加更自然的開啟動畫效果
         passageContent.style.opacity = &#39;0&#39;;
         passageContent.style.transform = &#39;translateY(-20px)&#39;;
         passageContent.style.transition = &#39;opacity 0.3s ease, transform 0.3s ease&#39;;
         passageContainer.style.transition = &#39;max-height 0.5s cubic-bezier(0.19, 1, 0.22, 1)&#39;;
         passageContainer.style.maxHeight = &#39;500px&#39;; // 立即設置足夠的高度
         
         // 觸發重繪並應用動畫
         setTimeout(() =&gt; {
             passageContent.style.opacity = &#39;1&#39;;
             passageContent.style.transform = &#39;translateY(0)&#39;;
         }, 10);
         
         // 自動關閉段落選擇器
         const paragraphSelector = document.getElementById(&#39;paragraph-selector&#39;);
         if (paragraphSelector) {
             console.log(&quot;自動關閉段落選擇器&quot;);
             paragraphSelector.classList.add(&#39;hidden&#39;);
         }
         
         // 首次打開時不預設任何篇章，但再次打開時加載上次的篇章
         const shouldPreselect = !isFirstTimeOpeningSelector &amp;&amp; currentPassageKey &amp;&amp; currentPassageKey.length &gt; 0;
         
         if (shouldPreselect) {
             // 如果不是首次打開並且有上次選擇的篇章，則自動打開該篇章
             const passageItems = document.querySelectorAll(&#39;.passage-item&#39;);
             passageItems.forEach(item =&gt; {
                 if (item.dataset.value === currentPassageKey) {
                     // 移除所有篇章的active樣式
                     passageItems.forEach(i =&gt; 
                         i.classList.remove(&#39;active&#39;, &#39;bg-amber-100&#39;, &#39;dark:bg-amber-900&#39;));
                     
                     // 添加當前篇章的active樣式
                     item.classList.add(&#39;active&#39;, &#39;bg-amber-100&#39;, &#39;dark:bg-amber-900&#39;);
                     
                     // 顯示該篇章的段落選擇器
                     if (paragraphSelector &amp;&amp; paragraphSelector.classList.contains(&#39;hidden&#39;)) {
                         // 只有在段落選擇器隱藏時才調用，避免重複加載
                         showParagraphSelector(currentPassageKey);
                     }
                     
                     // 如果篇章項目當前是隱藏的，則打開其所屬的分類
                     if (item.classList.contains(&#39;hidden&#39;)) {
                         const category = item.dataset.category;
                         // 找到並激活對應的分類按鈕
                         categoryBtns.forEach(btn =&gt; {
                             if (btn.dataset.category === category) {
                                 // 移除所有按鈕的active樣式
                                 categoryBtns.forEach(b =&gt; b.classList.remove(&#39;active&#39;, &#39;bg-amber-200&#39;, &#39;dark:bg-amber-700&#39;));
                                 
                                 // 添加當前按鈕的active樣式
                                 btn.classList.add(&#39;active&#39;, &#39;bg-amber-200&#39;, &#39;dark:bg-amber-700&#39;);
                                 
                                 // 顯示該分類下的所有篇章
                                 passageItems.forEach(i =&gt; {
                                     if (i.dataset.category === category) {
                                         i.classList.remove(&#39;hidden&#39;);
                                     } else {
                                         i.classList.add(&#39;hidden&#39;);
                                     }
                                 });
                             }
                         });
                     }
                 }
             });
         }
         
         // 更新標記，表示篇章選擇器已被打開過
         isFirstTimeOpeningSelector = false;
         
         } else {
         // 關閉篇章選擇器 - 添加收縮動畫
         console.log(&quot;關閉篇章選擇器&quot;);
         passageToggle.style.transform = &#39;rotate(0deg)&#39;;
             
             // 添加淡出動畫效果
             passageContent.style.opacity = &#39;0&#39;;
             passageContent.style.transform = &#39;translateY(10px)&#39;;
             
             // 先收縮容器高度，然後隱藏內容
             passageContainer.style.transition = &#39;max-height 0.4s cubic-bezier(0.6, 0.04, 0.98, 0.335)&#39;;
             passageContainer.style.maxHeight = &#39;46px&#39;;
             
             // 延遲隱藏內容，讓收縮動畫先完成
             setTimeout(() =&gt; {
                 passageContent.classList.add(&#39;hidden&#39;);
                 
                 // 重置動畫狀態，為下次打開做準備
                 setTimeout(() =&gt; {
                     passageContent.style.transition = &#39;none&#39;;
                     passageContent.style.opacity = &#39;1&#39;;
                     passageContent.style.transform = &#39;translateY(0)&#39;;
                 }, 50);
                 
                 // 強制隱藏段落選擇器
                 const paragraphSelector = document.getElementById(&#39;paragraph-selector&#39;);
                 if (paragraphSelector) {
                     console.log(&quot;隱藏段落選擇器&quot;);
                     paragraphSelector.classList.add(&#39;hidden&#39;);
                     
                     // 重置段落選擇器動畫狀態
                     setTimeout(() =&gt; {
                         paragraphSelector.style.transition = &#39;none&#39;;
                         paragraphSelector.style.opacity = &#39;1&#39;;
                         paragraphSelector.style.transform = &#39;translateY(0)&#39;;
                     }, 50);
                 } else {
                     console.error(&quot;找不到段落選擇器元素&quot;);
                 }
             }, 300); // 等待收縮動畫完成
         }
         });
         }            
             // 分类按钮点击事件
             categoryBtns.forEach(btn =&gt; {
                 btn.addEventListener(&#39;click&#39;, function() {
                     // 移除所有按钮的active样式
                     categoryBtns.forEach(b =&gt; b.classList.remove(&#39;active&#39;, &#39;bg-amber-200&#39;, &#39;dark:bg-amber-700&#39;));
                     
                     // 添加当前按钮的active样式
                     this.classList.add(&#39;active&#39;, &#39;bg-amber-200&#39;, &#39;dark:bg-amber-700&#39;);
                     
                     // 過濾篇章列表
                     const category = this.dataset.category;
                     const passageItems = document.querySelectorAll(&#39;.passage-item&#39;);
                     const emptyMessage = document.getElementById(&#39;empty-category-message&#39;);
                     
                     if (!emptyMessage) {
                         console.error(&quot;空分類提示元素未找到&quot;);
                         return;
                     }
                     
                     // 先隱藏所有篇章和提示信息
                     passageItems.forEach(item =&gt; {
                         item.classList.add(&#39;hidden&#39;);
                     });
                     emptyMessage.classList.add(&#39;hidden&#39;);
                     
                     // 檢查顯示符合分類的篇章
                     let hasVisibleItems = false;
                     passageItems.forEach(item =&gt; {
                         if (item.dataset.category === category) {
                             item.classList.remove(&#39;hidden&#39;);
                             hasVisibleItems = true;
                         }
                     });
                     
                     // 如果該分類沒有篇章，顯示提示信息
                     if (!hasVisibleItems) {
                         emptyMessage.classList.remove(&#39;hidden&#39;);
                     }
                     
                     // 隐藏段落选择器
                     const paragraphSelector = document.getElementById(&#39;paragraph-selector&#39;);
                     if (paragraphSelector) {
                         paragraphSelector.classList.add(&#39;hidden&#39;);
                     }
                     
                     // 確保篇章列表容器有足夠高度並可滾動
                     const passageList = document.getElementById(&#39;passage-list&#39;);
                     if (passageList) {
                         // 計算合適的最大高度 (視口高度的20%)
                         const maxHeight = Math.max(60, window.innerHeight * 0.2) + &#39;px&#39;;
                         passageList.style.maxHeight = maxHeight;
                         
                         // 確保容器可滾動
                         passageList.style.overflowY = &#39;auto&#39;;
                     }
                     
                     // 確保主容器有足夠空間顯示列表
                     if (passageContainer) {
                         // 視口高度的60%，但至少600px
                         passageContainer.style.maxHeight = Math.max(600, window.innerHeight * 0.6) + &#39;px&#39;;
                     }
                 });
             });
             
             // 自動生成篇章項目的函數
             function generatePassageItems() {
                 const container = document.getElementById(&#39;passage-list&#39;);
                 if (!container) {
                     console.error(&quot;篇章列表容器未找到&quot;);
                     return;
                 }
                 
                 // 保存空分類提示消息
                 const emptyMessage = document.getElementById(&#39;empty-category-message&#39;);
                 let savedEmptyMsg = null;
                 if (emptyMessage) {
                     savedEmptyMsg = emptyMessage.cloneNode(true);
                 }
                 
                 // 清空容器
                 container.innerHTML = &#39;&#39;;
                 
                 // 恢復空分類提示消息
                 if (savedEmptyMsg) {
                     container.appendChild(savedEmptyMsg);
                 }
                 
                 // 為每個篇章創建項目
                 Object.keys(passages).forEach(key =&gt; {
                     const passage = passages[key];
                     
                     // 創建篇章項目元素
                     const item = document.createElement(&#39;div&#39;);
                     item.className = &#39;passage-item p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer hidden&#39;;
                     item.dataset.value = key;
                     item.dataset.category = passage.category || &#39;其他&#39;; // 使用篇章中定義的分類
                     item.textContent = `${passage.title} - ${passage.author}`;
                     
                     // 添加到容器中
                     container.appendChild(item);
                 });
                 
                 // 添加篇章項目的點擊事件
                 addPassageItemListeners();
             }
             
             // 为篇章项添加点击事件监听
             function addPassageItemListeners() {
                 document.querySelectorAll(&#39;.passage-item&#39;).forEach(item =&gt; {
                     item.addEventListener(&#39;click&#39;, function() {
                         // 移除所有篇章的active样式
                         document.querySelectorAll(&#39;.passage-item&#39;).forEach(i =&gt; 
                             i.classList.remove(&#39;active&#39;, &#39;bg-amber-100&#39;, &#39;dark:bg-amber-900&#39;));
                         
                         // 添加当前篇章的active样式
                         this.classList.add(&#39;active&#39;, &#39;bg-amber-100&#39;, &#39;dark:bg-amber-900&#39;);
                         
                         // 获取选中的篇章
                         const passageKey = this.dataset.value;
                         currentPassageKey = passageKey;
                         
                         // 显示段落选择器
                         showParagraphSelector(passageKey);
                     });
                 });
             }
             
             // 自動為所有篇章生成內容
             function initializePassages() {
                 Object.keys(passages).forEach(key =&gt; {
                     if (!passages[key].content) {
                         passages[key].content = passages[key].paragraphs.join(&#39;&#39;);
                     }
                 });
             }
             
             // 显示段落选择器
             function showParagraphSelector(passageKey) {
                 // 添加动画效果 - 用于段落选择器的打开过渡
                 const paragraphSelector = document.getElementById(&#39;paragraph-selector&#39;);
                 const paragraphList = document.getElementById(&#39;paragraph-list&#39;);
                 const selectedPassage = passages[passageKey];
                 
                 if (!paragraphSelector || !paragraphList) {
                     console.error(&quot;段落選擇器元素未找到&quot;);
                     return;
                 }
                 
                 if (!selectedPassage) {
                     console.error(&quot;選中的篇章不存在:&quot;, passageKey);
                     return;
                 }
                 
                 // 清空段落列表
                 paragraphList.innerHTML = &#39;&#39;;
                 
                 // 添加&quot;全文&quot;选项
                 const allOption = document.createElement(&#39;div&#39;);
                 allOption.className = &#39;flex items-center mb-2&#39;;
                 allOption.innerHTML = `
                     &lt;input type=&quot;checkbox&quot; id=&quot;paragraph-all&quot; class=&quot;mr-2 h-4 w-4 text-primary&quot; checked&gt;
                     &lt;label for=&quot;paragraph-all&quot; class=&quot;text-gray-700 dark:text-gray-300 cursor-pointer font-medium&quot;&gt;全文&lt;/label&gt;
                 `;
                 paragraphList.appendChild(allOption);
                 
                 // 全选按钮逻辑
                 const allCheckbox = allOption.querySelector(&#39;input&#39;);
                 if (allCheckbox) {
                     allCheckbox.addEventListener(&#39;change&#39;, function() {
                         // 获取所有段落复选框
                         const paragraphCheckboxes = paragraphOptionsContainer.querySelectorAll(&#39;.paragraph-checkbox&#39;);
                         
                         // 设置所有段落复选框与全选框状态一致
                         paragraphCheckboxes.forEach(checkbox =&gt; {
                             checkbox.checked = this.checked;
                         });
                     });
                 }
                 
                 // 创建包含所有段落选项的容器
                 const paragraphOptionsContainer = document.createElement(&#39;div&#39;);
                 paragraphOptionsContainer.className = &#39;paragraph-options overflow-y-auto&#39;;
                 paragraphList.appendChild(paragraphOptionsContainer);
                 
                 // 添加各段落选项
                 selectedPassage.paragraphs.forEach((paragraph, index) =&gt; {
                     const paragraphOption = document.createElement(&#39;div&#39;);
                     paragraphOption.className = &#39;flex items-center mb-2&#39;;
                     paragraphOption.innerHTML = `
                         &lt;input type=&quot;checkbox&quot; id=&quot;paragraph-${index+1}&quot; class=&quot;mr-2 h-4 w-4 text-primary paragraph-checkbox&quot; data-index=&quot;${index}&quot; checked&gt;
                         &lt;label for=&quot;paragraph-${index+1}&quot; class=&quot;text-gray-700 dark:text-gray-300 cursor-pointer flex-1&quot;&gt;
                             &lt;span class=&quot;font-medium&quot;&gt;第${index+1}段：&lt;/span&gt;
                             &lt;span class=&quot;text-sm&quot;&gt;${paragraph.substring(0, 20)}${paragraph.length &gt; 20 ? &#39;...&#39; : &#39;&#39;}&lt;/span&gt;
                         &lt;/label&gt;
                     `;
                     paragraphOptionsContainer.appendChild(paragraphOption);
                     
                     // 段落复选框逻辑
                     const checkbox = paragraphOption.querySelector(&#39;input&#39;);
                     if (checkbox) {
                         checkbox.addEventListener(&#39;change&#39;, function() {
                             // 检查是否所有段落都被选中
                             const paragraphCheckboxes = paragraphOptionsContainer.querySelectorAll(&#39;.paragraph-checkbox&#39;);
                             const allCheckbox = document.getElementById(&#39;paragraph-all&#39;);
                             
                             if (allCheckbox &amp;&amp; paragraphCheckboxes) {
                                 const allChecked = Array.from(paragraphCheckboxes).every(cb =&gt; cb.checked);
                                 allCheckbox.checked = allChecked;
                             }
                         });
                     }
                 });
                 
                 // 显示段落选择器
                 // 先置頂，避免顯示延遲
                 paragraphSelector.style.cssText = &#39;transform: translateY(-20px); opacity: 0;&#39;;
                 paragraphSelector.classList.remove(&#39;hidden&#39;);
                 
                 // 強制觸發重繪
                 void paragraphSelector.offsetWidth;
                 
                 // 應用動畫 - 較長的過渡時間提供更流暢的體驗
                 paragraphSelector.style.transition = &#39;transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s ease-out&#39;;
                 paragraphSelector.style.transform = &#39;translateY(0)&#39;;
                 paragraphSelector.style.opacity = &#39;1&#39;;
                 
                 // 設置段落列表的滾動屬性
                 if (paragraphOptionsContainer) {
                     // 根據段落數量動態調整高度，增加每段高度並提高最小值
                     const paragraphCount = selectedPassage.paragraphs.length;
                     // 每段約70px高，最少200px，最多視口高度的50%
                     const calculatedHeight = Math.min(
                         Math.max(200, paragraphCount * 70),
                         window.innerHeight * 0.5
                     );
                     paragraphOptionsContainer.style.maxHeight = calculatedHeight + &#39;px&#39;;
                     paragraphOptionsContainer.style.overflowY = &#39;auto&#39;;
                 }
                 
                 // 確保容器高度足夠 - 使用動態計算的高度
                 if (passageContainer) {
                     // 計算當前所有內容的實際高度，包括段落選擇器和確認按鈕
                     const paragraphSelectorHeight = paragraphSelector.scrollHeight;
                     const passageContentHeight = document.getElementById(&#39;passage-content&#39;).scrollHeight;
                     // 增加額外空間，確保容器高度充足
                     const totalHeight = Math.max(600, passageContentHeight + 50);
                     passageContainer.style.maxHeight = totalHeight + &#39;px&#39;;
                     passageContainer.style.transition = &#39;max-height 0.3s ease&#39;;
                 }
                 
                 // 重新绑定确认按钮事件
                 setupConfirmButton();
             }
             
             // 設置確認按鈕事件
             function setupConfirmButton() {
                 const confirmBtn = document.getElementById(&#39;confirm-paragraphs&#39;);
                 if (!confirmBtn) {
                     console.error(&quot;確認按鈕元素未找到&quot;);
                     return;
                 }
                 
                 // 移除現有的事件監聽器
                 const newConfirmBtn = confirmBtn.cloneNode(true);
                 confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
                 
                 // 添加新的事件監聽器 - 改為異步函數以支持等待水墨過渡動畫
                 newConfirmBtn.addEventListener(&#39;click&#39;, async function() {
                     console.log(&quot;確認按鈕被點擊&quot;);
                     
                     const paragraphList = document.getElementById(&#39;paragraph-list&#39;);
                     if (!paragraphList) {
                         console.error(&quot;段落列表元素未找到&quot;);
                         return;
                     }
                     
                     // 获取选中的段落索引
                     const selectedIndices = [];
                     const paragraphOptions = paragraphList.querySelector(&#39;.paragraph-options&#39;);
                     if (!paragraphOptions) {
                         console.error(&quot;段落選項容器未找到&quot;);
                         return;
                     }
                     
                     const checkboxes = paragraphOptions.querySelectorAll(&#39;.paragraph-checkbox&#39;);
                     
                     checkboxes.forEach(checkbox =&gt; {
                         if (checkbox.checked) {
                             selectedIndices.push(parseInt(checkbox.dataset.index));
                         }
                     });
                     
                     // 如果没有选中任何段落，默认选中全部
                     if (selectedIndices.length === 0) {
                         if (passages[currentPassageKey]) {
                             for (let i = 0; i &lt; passages[currentPassageKey].paragraphs.length; i++) {
                                 selectedIndices.push(i);
                             }
                         }
                     }
                     
                     console.log(&quot;選中的段落索引:&quot;, selectedIndices);
                     
                     // 关闭选择器
                     if (passageContent) {
                         passageContent.classList.add(&#39;hidden&#39;);
                     }
                     if (passageToggle) {
                         passageToggle.style.transform = &#39;rotate(0deg)&#39;;
                     }
                     if (passageContainer) {
                         passageContainer.style.maxHeight = &#39;46px&#39;;
                     }
                     
                     try {
                         // 顯示水墨過渡動畫 - 等待動畫完成後再進入遊戲界面
                         console.log(&quot;開始播放水墨過渡動畫&quot;);
                         await showLoadingAnimation();
                         console.log(&quot;水墨過渡動畫播放完成&quot;);
                         
                         // 載入選中的段落 (第三個參數設為true，表示顯示遊戲界面)
                         loadSelectedParagraphs(currentPassageKey, selectedIndices, true);
                         
                         // 確保顯示返回主頁按鈕而非暫停按鈕
                         const pauseBtn = document.getElementById(&#39;pause-btn&#39;);
                         const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                         
                         if (pauseBtn &amp;&amp; returnHomeBtn) {
                             pauseBtn.classList.add(&#39;hidden&#39;);
                             returnHomeBtn.classList.remove(&#39;hidden&#39;);
                             console.log(&quot;確認按鈕：已切換為返回主頁按鈕&quot;);
                         }
                         
                         // 隱藏用戶資料界面 - 使用強制多層隱藏
                         const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                         if (userProfileContainer) {
                             // 強制徹底隱藏用戶資料表 - 使用多重方式確保隱藏
                             userProfileContainer.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;&#39;;
                             userProfileContainer.classList.add(&#39;hidden&#39;);
                             
                             // 移除任何可能顯示用戶資料表的類名
                             userProfileContainer.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                             
                             console.log(&quot;用戶資料表已被強制隱藏&quot;);
                         }
                     } catch (error) {
                         console.error(&quot;過渡到遊戲界面時發生錯誤:&quot;, error);
                         alert(&quot;載入遊戲時發生錯誤，請重試&quot;);
                     }
                 });
             }
             
             // 用于存储已回答的字符
             let lastAnsweredChars = [];
             const MAX_DISPLAYED_CHARS = 15;
             
             // 成功背誦50字恢復1點生命值的計數器
             let successfulChars = 0;
             
             // 遊戲當前使用的內容
             let content = &#39;&#39;;
             let totalNonPunctChars = 0;
             
             // 創建查看完整文章的功能
             const fullTextModal = document.createElement(&#39;div&#39;);
             fullTextModal.className = &#39;fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden&#39;;
             fullTextModal.id = &#39;full-text-modal&#39;;
             document.body.appendChild(fullTextModal);
             
             // 加載選中段落的函數，不使用水墨過渡動畫
             async function loadSelectedParagraphs(passageKey, paragraphIndices) {
                 console.log(&quot;開始加載段落:&quot;, passageKey, paragraphIndices);
                 
                 try {
                     // 保存選擇的段落索引到全局變量，供分享使用
                     window.selectedParagraphIndices = paragraphIndices;
                     console.log(&quot;已保存段落索引:&quot;, window.selectedParagraphIndices);
                     
                     // 確保遊戲頁面存在
                     const gamePage = document.getElementById(&#39;game-page&#39;);
                     if (!gamePage) {
                         console.error(&quot;遊戲頁面元素未找到&quot;);
                         return;
                     }
                     
                     // 重置游戏状态
                     currentPosition = 0;
                     correctAnswers = 0;
                     wrongAnswersCount = 0; // 重置錯誤計數
                     lives = 3;
                     updateLives();
                     
                     // 清空已回答的字符
                     successfulChars = 0;
                     const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                     if (lastAnsweredCharsElem) {
                         lastAnsweredChars = [];
                         lastAnsweredCharsElem.textContent = &#39;&#39;;
                     }
                     
                     const completedText = document.getElementById(&#39;completed-text&#39;);
                     if (completedText) {
                         completedText.textContent = &#39;&#39;;
                     }
                     
                     // 獲取選擇的篇章
                     const selectedPassage = passages[passageKey];
                     if (!selectedPassage) {
                         console.error(&quot;選中的篇章不存在:&quot;, passageKey);
                         return;
                     }
                     
                     // 根据选择的段落索引构建内容
                     content = &#39;&#39;;
                     paragraphIndices.sort((a, b) =&gt; a - b); // 确保段落按顺序排列
                     
                     paragraphIndices.forEach(index =&gt; {
                         if (index &gt;= 0 &amp;&amp; index &lt; selectedPassage.paragraphs.length) {
                             content += selectedPassage.paragraphs[index];
                         }
                     });
                     
                     // 計算非標點符號的字符數量
                     totalNonPunctChars = 0;
                     for (let i = 0; i &lt; content.length; i++) {
                         if (!isPunctuation(content[i])) {
                             totalNonPunctChars++;
                         }
                     }
                     
                     console.log(&quot;字數計算完成，總非標點字符數：&quot;, totalNonPunctChars);
                     
                     // 构建标题（添加所选段落信息）
                     const passageTitle = document.getElementById(&#39;passage-title&#39;);
                     const passageAuthor = document.getElementById(&#39;passage-author&#39;);
                     
                     if (passageTitle) {
                         if (paragraphIndices.length === selectedPassage.paragraphs.length) {
                             // 如果選擇了所有段落，只顯示標題
                             passageTitle.textContent = selectedPassage.title;
                         } else {
                             // 如果選擇了部分段落，顯示段落範圍
                             let rangeText = &#39;&#39;;
                             if (paragraphIndices.length === 1) {
                                 rangeText = `第${paragraphIndices[0] + 1}段`;
                             } else {
                                 // 判断是否是连续的段落
                                 let isConsecutive = true;
                                 for (let i = 0; i &lt; paragraphIndices.length - 1; i++) {
                                     if (paragraphIndices[i + 1] !== paragraphIndices[i] + 1) {
                                         isConsecutive = false;
                                         break;
                                     }
                                 }
                                 
                                 if (isConsecutive) {
                                     rangeText = `第${paragraphIndices[0] + 1}-${paragraphIndices[paragraphIndices.length - 1] + 1}段`;
                                 } else {
                                     rangeText = `第${paragraphIndices.map(idx =&gt; idx + 1).join(&#39;、&#39;)}段`;
                                 }
                             }
                             passageTitle.textContent = `${selectedPassage.title}（${rangeText}）`;
                         }
                     }
                     
                     if (passageAuthor) {
                         passageAuthor.textContent = selectedPassage.author;
                     }
                     
                     // 停止秒表并重置
                     stopStopwatch();
                     if (timerElement) {
                         timerElement.textContent = &quot;00:00.0&quot;;
                     }
                     // 確保恢復秒表時重新開始計時
                     elapsedTimeBeforePause = 0;
                     
                     // 更新進度顯示 - 使用選中段落的總字數
                     const totalCharsElement = document.getElementById(&#39;total-chars&#39;);
                     const progressTextElement = document.getElementById(&#39;progress-text&#39;);
                     const progressBarElement = document.getElementById(&#39;progress-bar&#39;);
                     
                     if (totalCharsElement) {
                         totalCharsElement.textContent = totalNonPunctChars;
                     }
                     
                     if (progressTextElement) {
                         progressTextElement.textContent = `0 / ${totalNonPunctChars}`;
                     }
                     
                     if (progressBarElement) {
                         progressBarElement.style.width = &#39;0%&#39;;
                     }
                     
                     // 清空选项容器
                     const optionsContainer = document.getElementById(&#39;options-container&#39;);
                     if (optionsContainer) {
                         optionsContainer.innerHTML = &#39;&#39;;
                         optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                     }
                     
                     // 確保游戏开始界面準備好
                     if (gameContent) {
                         gameContent.classList.add(&#39;hidden&#39;);
                     }
                     
                     if (gameStartScreen) {
                         gameStartScreen.classList.remove(&#39;hidden&#39;);
                     }
                     
                     // 重置暫停狀態
                     isPaused = false;
                     hasPaused = false; // 重置是否使用過暫停的標記
                     
                     // 明確更新按鈕狀態為「未開始」，顯示返回主頁按鈕
                     updateGameControlButtons(&#39;not-started&#39;);
                     
                     // 直接處理暫停/返回按鈕的顯示
                     const pauseBtn = document.getElementById(&#39;pause-btn&#39;);
                     const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                     
                     if (pauseBtn &amp;&amp; returnHomeBtn) {
                         // 在遊戲未開始時顯示返回主頁按鈕
                         pauseBtn.classList.add(&#39;hidden&#39;);
                         returnHomeBtn.classList.remove(&#39;hidden&#39;);
                         console.log(&quot;已切換為返回主頁按鈕 (加載段落)&quot;);
                     }
                     
                     // 只有當用戶通過選擇篇章明確調用時才顯示遊戲頁面
                     // 如果不是通過初始載入調用，則顯示遊戲頁面
                     if (arguments.length &gt; 2 &amp;&amp; arguments[2] === true) {
                         // 強制徹底顯示遊戲頁面 - 使用多重方式確保顯示
                         console.log(&quot;強制顯示遊戲界面&quot;);
                         gamePage.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important; pointer-events: auto !important;&#39;;
                         gamePage.classList.remove(&#39;hidden&#39;);
                         
                         // 添加顯示類名
                         gamePage.classList.add(&#39;block&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                         
                         // 確保頁面翻轉效果生效
                         const bookPage = document.querySelector(&#39;.page&#39;);
                         if (bookPage) {
                             bookPage.classList.add(&#39;turned&#39;);
                         }
                         
                         // 使用延遲檢查遊戲界面狀態
                         setTimeout(() =&gt; {
                             console.log(&quot;遊戲界面顯示狀態:&quot;, window.getComputedStyle(gamePage).display);
                             
                             // 如果遊戲界面仍未顯示，再次嘗試
                             if (window.getComputedStyle(gamePage).display === &#39;none&#39;) {
                                 console.warn(&quot;遊戲界面仍未顯示，再次嘗試...&quot;);
                                 gamePage.style.cssText = &#39;display: block !important; visibility: visible !important;&#39;;
                             }
                             
                             // 再次確認按鈕顯示狀態
                             if (pauseBtn &amp;&amp; returnHomeBtn) {
                                 if (!returnHomeBtn.classList.contains(&#39;hidden&#39;)) {
                                     console.log(&quot;確認返回主頁按鈕顯示正常&quot;);
                                 } else {
                                     console.warn(&quot;返回主頁按鈕仍然隱藏，重新設置...&quot;);
                                     pauseBtn.classList.add(&#39;hidden&#39;);
                                     returnHomeBtn.classList.remove(&#39;hidden&#39;);
                                 }
                             }
                             
                             // 再次確認按鈕顯示狀態
                             if (pauseBtn &amp;&amp; returnHomeBtn) {
                                 if (!returnHomeBtn.classList.contains(&#39;hidden&#39;)) {
                                     console.log(&quot;確認返回主頁按鈕顯示正常&quot;);
                                 } else {
                                     console.warn(&quot;返回主頁按鈕仍然隱藏，重新設置...&quot;);
                                     pauseBtn.classList.add(&#39;hidden&#39;);
                                     returnHomeBtn.classList.remove(&#39;hidden&#39;);
                                 }
                             }
                         }, 50);
                         
                         // 同時強制隱藏用戶資料容器
                         const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                         if (userProfileContainer) {
                             userProfileContainer.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;&#39;;
                             userProfileContainer.classList.add(&#39;hidden&#39;);
                             userProfileContainer.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                         }
                     } else {
                         // 確保遊戲頁面隱藏
                         gamePage.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;&#39;;
                         gamePage.classList.add(&#39;hidden&#39;);
                         gamePage.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                     }
                     
                     console.log(&quot;段落加載完成，遊戲準備就緒&quot;);
                     
                 } catch (error) {
                     console.error(&quot;加載段落時發生錯誤:&quot;, error);
                 }
             }
             
             let currentPosition = 0;
             let correctAnswers = 0;
             let canSelect = true;
             let lives = 3;
             
             const completedText = document.getElementById(&#39;completed-text&#39;);
             const currentChar = document.getElementById(&#39;current-char&#39;);
             const optionsContainer = document.getElementById(&#39;options-container&#39;);
             const feedback = document.getElementById(&#39;feedback&#39;);
             const helpBtn = document.getElementById(&#39;help-btn&#39;);
             const helpText = document.getElementById(&#39;help-text&#39;);
             
             // 秒表功能 - 修改為支持暫停/繼續
             function startStopwatch() {
                 if (isPaused) return; // 如果遊戲已暫停，不啟動計時器
                 
                 // 設置開始時間 - 考慮先前累積的時間
                 startTime = new Date();
                 
                 // 啟動計時器
                 timerInterval = setInterval(updateStopwatch, 100);
                 
                 // 遊戲開始後，顯示暫停按鈕而非返回主頁按鈕
                 updateGameControlButtons(&#39;playing&#39;);
             }
             
             // 更新暫停/返回主頁按鈕顯示狀態
             function updateGameControlButtons(gameState) {
                 const pauseBtn = document.getElementById(&#39;pause-btn&#39;);
                 const returnHomeBtn = document.getElementById(&#39;return-home-btn-game&#39;);
                 
                 if (!pauseBtn || !returnHomeBtn) return;
                 
                 if (gameState === &#39;not-started&#39; || gameState === &#39;completed&#39; || gameState === &#39;failed&#39;) {
                     // 遊戲開始前、完成後或失敗後，顯示返回主頁按鈕
                     pauseBtn.classList.add(&#39;hidden&#39;);
                     returnHomeBtn.classList.remove(&#39;hidden&#39;);
                 } else if (gameState === &#39;playing&#39;) {
                     // 遊戲進行中，顯示暫停按鈕
                     pauseBtn.classList.remove(&#39;hidden&#39;);
                     returnHomeBtn.classList.add(&#39;hidden&#39;);
                 }
             }
             
             function stopStopwatch() {
                 // 如果計時器正在運行，停止並保存累計時間
                 if (timerInterval) {
                     clearInterval(timerInterval);
                     timerInterval = null;
                     
                     // 如果是暫停操作（而非遊戲結束等其他原因停止），更新累計時間
                     if (startTime &amp;&amp; isPaused) {
                         const currentTime = new Date();
                         elapsedTimeBeforePause += (currentTime - startTime);
                         startTime = null; // 清除開始時間
                     }
                 }
             }
             
             function resetStopwatch() {
                 stopStopwatch();
                 elapsedTimeBeforePause = 0; // 重置累計時間
                 
                 if (timerElement) {
                     timerElement.textContent = &quot;00:00.0&quot;;
                 }
                 
                 // 重新開始秒錶
                 startStopwatch();
             }
             
             function updateStopwatch() {
                 if (!timerElement || isPaused) return;
                 
                 const currentTime = new Date();
                 // 計算總經過時間 = 之前累計的時間 + 當前計時段的時間
                 const totalElapsedMs = elapsedTimeBeforePause + (currentTime - startTime);
                 
                 // 轉換為時間格式
                 const totalElapsedDate = new Date(totalElapsedMs);
                 const minutes = String(totalElapsedDate.getUTCMinutes()).padStart(2, &#39;0&#39;);
                 const seconds = String(totalElapsedDate.getUTCSeconds()).padStart(2, &#39;0&#39;);
                 const tenths = Math.floor(totalElapsedDate.getUTCMilliseconds() / 100);
                 
                 timerElement.textContent = `${minutes}:${seconds}.${tenths}`;
             }
             
             // 获取完成时间（以秒为单位）
             function getCompletionTimeInSeconds() {
                 if (!timerElement) return 0;
                 
                 const timeString = timerElement.textContent;
                 const parts = timeString.split(&#39;:&#39;);
                 const minutePart = parseInt(parts[0]);
                 const secondParts = parts[1].split(&#39;.&#39;);
                 const secondPart = parseInt(secondParts[0]);
                 const tenthPart = parseInt(secondParts[1]) / 10;
                 
                 // 返回总秒数（包括小数部分）
                 return minutePart * 60 + secondPart + tenthPart;
             }
             
             // 初始显示，先不启动秒表
             if (timerElement) timerElement.textContent = &quot;00:00.0&quot;;
             
             // 帮助按钮 - 添加自動滾動功能
             if (helpBtn &amp;&amp; helpText) {
                 helpBtn.addEventListener(&#39;click&#39;, function() {
                     helpText.classList.toggle(&#39;hidden&#39;);
                     
                     // 如果幫助文本顯示，滾動頁面使其完全可見
                     if (!helpText.classList.contains(&#39;hidden&#39;)) {
                         setTimeout(() =&gt; {
                             helpText.scrollIntoView({ behavior: &#39;smooth&#39;, block: &#39;center&#39; });
                         }, 100);
                     }
                 });
             }
             
             // 初始化暫停功能
             function initializePauseSystem() {
                 const pauseBtn = document.getElementById(&#39;pause-btn&#39;);
                 const pauseOverlay = document.getElementById(&#39;pause-overlay&#39;);
                 const continueBtn = document.getElementById(&#39;continue-btn&#39;);
                 const restartFromPauseBtn = document.getElementById(&#39;restart-from-pause-btn&#39;);
                 const countdownResume = document.getElementById(&#39;countdown-resume&#39;);
                 const pauseButtons = document.getElementById(&#39;pause-buttons&#39;);
                 
                 if (!pauseBtn || !pauseOverlay || !continueBtn || !restartFromPauseBtn || !countdownResume) {
                     console.error(&quot;暫停系統元素未找到&quot;);
                     return;
                 }
                 
                 // 暫停按鈕點擊事件
                 pauseBtn.addEventListener(&#39;click&#39;, function() {
                     // 只有在遊戲進行中且未暫停時才能暫停
                     if (gameStartScreen.classList.contains(&#39;hidden&#39;) &amp;&amp; gameContent.classList.contains(&#39;hidden&#39;) === false &amp;&amp; !isPaused) {
                         pauseGame();
                     }
                 });
                 
                 // 繼續遊戲按鈕
                 continueBtn.addEventListener(&#39;click&#39;, function() {
                     // 隱藏按鈕，顯示倒計時
                     pauseButtons.classList.add(&#39;hidden&#39;);
                     countdownResume.classList.remove(&#39;hidden&#39;);
                     
                     let count = 3;
                     const countdownNumber = countdownResume.querySelector(&#39;.pause-countdown-number&#39;);
                     countdownNumber.textContent = count;
                     
                     // 清除可能存在的倒計時
                     if (resumeCountdown) {
                         clearInterval(resumeCountdown);
                     }
                     
                     // 開始新的倒計時
                     resumeCountdown = setInterval(function() {
                         count--;
                         countdownNumber.textContent = count;
                         countdownNumber.style.animation = &#39;none&#39;;
                         void countdownNumber.offsetWidth; // 重置動畫
                         countdownNumber.style.animation = &#39;countdownPulse 1s ease-out&#39;;
                         
                         if (count &lt;= 0) {
                             clearInterval(resumeCountdown);
                             resumeCountdown = null;
                             
                             // 恢復遊戲
                             resumeGame();
                             
                             // 重置界面
                             pauseButtons.classList.remove(&#39;hidden&#39;);
                             countdownResume.classList.add(&#39;hidden&#39;);
                         }
                     }, 1000);
                 });
                 
                 // 重新開始按鈕
                 restartFromPauseBtn.addEventListener(&#39;click&#39;, async function() {
                     // 先關閉暫停菜單
                     pauseOverlay.classList.add(&#39;hidden&#39;);
                     isPaused = false;
                     
                     // 清除倒計時
                     if (resumeCountdown) {
                         clearInterval(resumeCountdown);
                         resumeCountdown = null;
                     }
                     
                     // 重置界面
                     pauseButtons.classList.remove(&#39;hidden&#39;);
                     countdownResume.classList.add(&#39;hidden&#39;);
                     
                     // 執行重新開始
                     await restartGame();
                     
                     // 關鍵修復：確保顯示&quot;返回主頁&quot;按鈕而非暫停按鈕
                     updateGameControlButtons(&#39;not-started&#39;);
                     console.log(&quot;重新開始：已更新按鈕顯示狀態為&#39;未開始&#39;&quot;);
                     
                     // 關鍵修復：重新啟用設置齒輪按鈕
                     window.enableSettingsButton();
                     console.log(&quot;重新開始：已重新啟用設置齒輪按鈕&quot;);
                 });
                 
                 // 返回主頁按鈕
                 const returnHomeBtn = document.getElementById(&#39;return-home-btn&#39;);
                 if (returnHomeBtn) {
                     returnHomeBtn.addEventListener(&#39;click&#39;, async function() {
                         console.log(&quot;暫停界面的返回主頁按鈕被點擊&quot;);
                         
                         try {
                             // 先關閉暫停菜單，避免重複顯示
                             pauseOverlay.classList.add(&#39;hidden&#39;);
                             isPaused = false;
                             
                             // 清除倒計時
                             if (resumeCountdown) {
                                 clearInterval(resumeCountdown);
                                 resumeCountdown = null;
                             }
                             
                             // 重置界面
                             pauseButtons.classList.remove(&#39;hidden&#39;);
                             countdownResume.classList.add(&#39;hidden&#39;);
                             
                             // 顯示水墨過渡動畫
                             await showLoadingAnimation();
                             console.log(&quot;水墨過渡動畫播放完成&quot;);
                             
                             // 重置遊戲狀態
                             currentPosition = 0;
                             correctAnswers = 0;
                             lives = 3;
                             successfulChars = 0;
                             wrongAnswersCount = 0;
                             lastAnsweredChars = [];
                             
                             const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                             if (lastAnsweredCharsElem) {
                                 lastAnsweredCharsElem.textContent = &#39;&#39;;
                             }
                             
                             canSelect = true;
                             isPaused = false;
                             hasPaused = false;
                             updateLives();
                             
                             if (feedback) {
                                 feedback.textContent = &#39;&#39;;
                             }
                             
                             // 停止計時器
                             stopStopwatch();
                             elapsedTimeBeforePause = 0;
                             if (timerElement) {
                                 timerElement.textContent = &quot;00:00.0&quot;;
                             }
                             
                             // 更新進度條
                             const progressText = document.getElementById(&#39;progress-text&#39;);
                             const progressBar = document.getElementById(&#39;progress-bar&#39;);
                             
                             if (progressText) {
                                 progressText.textContent = `0 / ${totalNonPunctChars}`;
                             }
                             
                             if (progressBar) {
                                 progressBar.style.width = &#39;0%&#39;;
                             }
                             
                             // 獲取需要操作的元素
                             const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                             const gamePage = document.getElementById(&#39;game-page&#39;);
                             
                             // 隱藏遊戲界面
                             gamePage.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important;&#39;;
                             gamePage.classList.add(&#39;hidden&#39;);
                             gamePage.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                             
                             // 顯示用戶資料界面
                             userProfileContainer.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important;&#39;;
                             userProfileContainer.classList.remove(&#39;hidden&#39;);
                             userProfileContainer.classList.add(&#39;block&#39;);
                             
                             // 確保書本頁面回到初始狀態
                             const bookPage = document.querySelector(&#39;.page&#39;);
                             if (bookPage &amp;&amp; bookPage.classList.contains(&#39;turned&#39;)) {
                                 bookPage.classList.remove(&#39;turned&#39;);
                             }
                             
                             // 滾動到頁面頂部
                             window.scrollTo({
                                 top: 0,
                                 behavior: &#39;smooth&#39;
                             });
                             
                             // 清空選項並恢復原始的網格佈局
                             if (optionsContainer) {
                                 optionsContainer.innerHTML = &#39;&#39;;
                                 optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                             }
                             
                             // 關鍵修復：重新啟用設置按鈕，因為用戶已返回主頁
                             window.enableSettingsButton();
                             console.log(&quot;重新啟用設置按鈕&quot;);
                             
                             console.log(&quot;從暫停菜單返回主頁成功&quot;);
                         } catch (error) {
                             console.error(&quot;返回主頁按鈕處理發生錯誤:&quot;, error);
                             alert(&quot;返回主頁時發生錯誤，請重新載入頁面&quot;);
                             // 即使發生錯誤，仍嘗試啟用設置按鈕
                             try {
                                 window.enableSettingsButton();
                             } catch (e) {
                                 console.error(&quot;啟用設置按鈕時發生錯誤:&quot;, e);
                             }
                         }
                     });
                 } else {
                     console.error(&quot;返回主頁按鈕元素未找到&quot;);
                 }
                 
                 // 鍵盤事件
                 document.addEventListener(&#39;keydown&#39;, function(e) {
                     // 按下 ESC 鍵暫停/繼續
                     if (e.key === &#39;Escape&#39;) {
                         if (gameStartScreen.classList.contains(&#39;hidden&#39;) &amp;&amp; gameContent.classList.contains(&#39;hidden&#39;) === false) {
                             if (isPaused) {
                                 continueBtn.click();
                             } else {
                                 pauseBtn.click();
                             }
                         }
                     }
                 });
             }
             
             // 暫停遊戲
             function pauseGame() {
                 if (isPaused) return; // 防止重複暫停
                 
                 isPaused = true;
                 hasPaused = true; // 標記用戶使用了暫停功能
                 
                 // 暫停計時器 - 保存當前累計時間
                 stopStopwatch();
                 
                 // 禁止選擇選項
                 canSelect = false;
                 
                 // 禁用設置按鈕
                 window.disableSettingsButton();
                 
                 // 顯示暫停覆蓋層
                 const pauseOverlay = document.getElementById(&#39;pause-overlay&#39;);
                 if (pauseOverlay) {
                     pauseOverlay.classList.remove(&#39;hidden&#39;);
                 }
                 
                 console.log(&quot;遊戲已暫停&quot;);
             }
             
             // 恢復遊戲
             function resumeGame() {
                 if (!isPaused) return; // 防止非暫停狀態下恢復
                 
                 isPaused = false;
                 
                 // 隱藏暫停覆蓋層
                 const pauseOverlay = document.getElementById(&#39;pause-overlay&#39;);
                 if (pauseOverlay) {
                     pauseOverlay.classList.add(&#39;hidden&#39;);
                 }
                 
                 // 恢復計時器 - 從之前的累計時間繼續
                 startStopwatch();
                 
                 // 允許選擇選項
                 canSelect = true;
                 
                 // 重新啟用設置按鈕
                 window.enableSettingsButton();
                 
                 console.log(&quot;遊戲已恢復，累計時間: &quot; + elapsedTimeBeforePause + &quot;ms&quot;);
             }
             
             // 重新開始遊戲
             async function restartGame() {
                 // 先顯示載入動畫
                 await showLoadingAnimation();
                 
                 // 重置遊戲狀態
                 currentPosition = 0;
                 correctAnswers = 0;
                 wrongAnswersCount = 0;
                 lives = 3;
                 successfulChars = 0;
                 lastAnsweredChars = [];
                 
                 // 重置UI元素
                 const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                 if (lastAnsweredCharsElem) {
                     lastAnsweredCharsElem.textContent = &#39;&#39;;
                 }
                 
                 updateLives();
                 
                 if (completedText) {
                     completedText.textContent = &#39;&#39;;
                 }
                 
                 if (feedback) {
                     feedback.textContent = &#39;&#39;;
                     feedback.className = &#39;mt-4 text-center h-6 text-lg&#39;;
                 }
                 
                 // 更新進度條
                 const progressText = document.getElementById(&#39;progress-text&#39;);
                 const progressBar = document.getElementById(&#39;progress-bar&#39;);
                 
                 if (progressText) {
                     progressText.textContent = `0 / ${totalNonPunctChars}`;
                 }
                 
                 if (progressBar) {
                     progressBar.style.width = &#39;0%&#39;;
                 }
                 
                 // 重置遊戲狀態
                 canSelect = true;
                 isPaused = false;
                 hasPaused = false; // 重置暫停標記
                 
                 // 重置秒表
                 stopStopwatch();
                 elapsedTimeBeforePause = 0; // 重置累計時間
                 if (timerElement) {
                     timerElement.textContent = &quot;00:00.0&quot;;
                 }
                 
                 // 顯示開始屏幕
                 if (gameContent &amp;&amp; gameStartScreen) {
                     gameContent.classList.add(&#39;hidden&#39;);
                     gameStartScreen.classList.remove(&#39;hidden&#39;);
                 }
                 
                 // 清空選項並恢復原始的網格佈局
                 if (optionsContainer) {
                     optionsContainer.innerHTML = &#39;&#39;;
                     optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                 }
                 
                 // 確保選擇篇章界面關閉
                 if (passageContent &amp;&amp; passageToggle &amp;&amp; passageContainer) {
                     passageContent.classList.add(&#39;hidden&#39;);
                     passageToggle.style.transform = &#39;rotate(0deg)&#39;;
                     passageContainer.style.maxHeight = &#39;46px&#39;;
                 }
                 
                 console.log(&quot;遊戲已重新開始&quot;);
             }
             
             // 創建查看完整文章功能
             const viewFullTextBtn = document.getElementById(&#39;view-full-text-btn&#39;);
             if (viewFullTextBtn) {
                 viewFullTextBtn.addEventListener(&#39;click&#39;, function() {
                     if (!currentPassageKey) {
                         alert(&#39;請先選擇一篇文章&#39;);
                         return;
                     }
                     
                     // 獲取當前文章完整內容
                     const passage = passages[currentPassageKey];
                     if (!passage) return;
                     
                     // 將段落轉換為HTML格式，使用網格佈局顯示段落編號和內容
                     const formattedParagraphs = passage.paragraphs.map((paragraph, index) =&gt; {
                         return `
                         &lt;div class=&quot;grid grid-cols-[auto,1px,1fr] gap-3 mb-5&quot;&gt;
                             &lt;div class=&quot;text-amber-700 dark:text-amber-400 font-medium whitespace-nowrap py-1&quot;&gt;第${index + 1}段&lt;/div&gt;
                             &lt;div class=&quot;bg-gray-300 dark:bg-gray-600 w-px&quot;&gt;&lt;/div&gt;
                             &lt;div class=&quot;text-gray-700 dark:text-gray-300 py-1 text-lg&quot;&gt;${paragraph}&lt;/div&gt;
                         &lt;/div&gt;`;
                     }).join(&#39;&#39;);
                     
                     // 創建模態框內容
                     fullTextModal.innerHTML = `
                     &lt;div class=&quot;bg-white dark:bg-gray-800 p-6 rounded-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto&quot;&gt;
                         &lt;div class=&quot;flex justify-between items-center mb-4&quot;&gt;
                             &lt;h3 class=&quot;text-lg font-bold text-gray-800 dark:text-gray-100&quot;&gt;${passage.title}&lt;/h3&gt;
                             &lt;button id=&quot;close-modal-btn&quot; class=&quot;text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100&quot;&gt;
                                 &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
                             &lt;/button&gt;
                         &lt;/div&gt;
                         &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-400 mb-4&quot;&gt;${passage.author}&lt;/p&gt;
                         &lt;div class=&quot;bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg&quot;&gt;
                             ${formattedParagraphs}
                         &lt;/div&gt;
                     &lt;/div&gt;
                     `;
                     
                     // 顯示模態框
                     fullTextModal.classList.remove(&#39;hidden&#39;);
                     
                     // 關閉按鈕事件
                     document.getElementById(&#39;close-modal-btn&#39;).addEventListener(&#39;click&#39;, function() {
                         fullTextModal.classList.add(&#39;hidden&#39;);
                     });
                     
                     // 點擊背景關閉模態框
                     fullTextModal.addEventListener(&#39;click&#39;, function(e) {
                         if (e.target === fullTextModal) {
                             fullTextModal.classList.add(&#39;hidden&#39;);
                         }
                     });
                 });
             }
             
             // 獲取並存儲進度相關的DOM元素
             const progressTextElement = document.getElementById(&#39;progress-text&#39;);
             const totalCharsElement = document.getElementById(&#39;total-chars&#39;);
             const progressBarElement = document.getElementById(&#39;progress-bar&#39;);
             
             function updateDisplay() {
                 // 檢查當前位置字符是否是標點，如果是則跳過
                 while (currentPosition &lt; content.length &amp;&amp; isPunctuation(content[currentPosition])) {
                     currentPosition++;
                 }
                 
                 // 確保當前字符元素存在
                 if (!currentChar) {
                     console.error(&#39;currentChar element is missing&#39;);
                     return;
                 }
                 
                 // 更新顯示，不再預先顯示當前字符
                 if (currentPosition &lt; content.length) {
                     // 清空當前字符顯示區
                     currentChar.textContent = &#39;&#39;;
                     
                     // 直接為當前位置生成選項
                     generateOptions(currentPosition);
                 } else {
                     // 完成所有字符
                     completePassage();
                 }
                 
                 // 更新進度顯示
                 updateProgressUI();
             }
             
             // 抽取進度更新為獨立函數
             function updateProgressUI() {
                 // 計算並顯示非標點字符的進度
                 let nonPunctChars = 0;
                 for (let i = 0; i &lt; currentPosition; i++) {
                     if (!isPunctuation(content[i])) {
                         nonPunctChars++;
                     }
                 }
                 
                 // 確保進度條相關元素存在
                 try {
                     // 更新進度條 - 使用選中段落的總字數
                     if (totalCharsElement) totalCharsElement.textContent = totalNonPunctChars;
                     if (progressTextElement) progressTextElement.textContent = `${nonPunctChars} / ${totalNonPunctChars}`;
                     const progressPercentage = (totalNonPunctChars &gt; 0) ? (nonPunctChars / totalNonPunctChars * 100) : 0;
                     if (progressBarElement) progressBarElement.style.width = `${progressPercentage}%`;
                 } catch (e) {
                     console.error(&#39;Error updating progress UI:&#39;, e);
                 }
             }
             
             function generateOptions(pos) {
                 if (!optionsContainer) {
                     console.error(&quot;選項容器元素未找到&quot;);
                     return;
                 }
                 
                 // 确保 pos 不是标点符号
                 while (pos &lt; content.length &amp;&amp; isPunctuation(content[pos])) {
                     pos++;
                 }
                 
                 // 清空选项容器
                 optionsContainer.innerHTML = &#39;&#39;;
                 
                 // 正确答案
                 const correctAnswer = content[pos];
                 
                 // 生成两个干扰选项
                 let options = [correctAnswer];
                 
                 while (options.length &lt; 3) {
                     const randomIndex = Math.floor(Math.random() * content.length);
                     const randomChar = content[randomIndex];
                     
                     // 确保不重复且不是标点符号
                     if (!options.includes(randomChar) &amp;&amp; 
                         !isPunctuation(randomChar) &amp;&amp; 
                         randomChar !== correctAnswer) {
                         options.push(randomChar);
                     }
                 }
                 
                 // 打乱选项顺序
                 options = shuffleArray(options);
                 
                 // 创建选项按钮
                 options.forEach(option =&gt; {
                     const btn = document.createElement(&#39;button&#39;);
                     btn.className = &#39;option-btn h-16 md:h-20 text-2xl md:text-3xl bg-white dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none&#39;;
                     btn.textContent = option;
                     
                     btn.addEventListener(&#39;click&#39;, function() {
                         if (!canSelect || isPaused) return; // 如果已暫停，不允許選擇
                         
                         if (option === correctAnswer) {
                             // 只在正確答案時創建墨滴效果
                             createInkDrop(btn);
                             handleCorrectAnswer(btn);
                         } else {
                             // 錯誤時不創建墨滴
                             handleIncorrectAnswer(btn);
                         }
                     });
                     
                     optionsContainer.appendChild(btn);
                 });
             }
             
             function handleCorrectAnswer(btn) {
                 canSelect = false;
                 correctAnswers++;
                 
                 // 添加正确效果
                 btn.classList.add(&#39;correct&#39;);
                 
                 // 不再顯示反饋文字
                 if (feedback) {
                     feedback.textContent = &#39;&#39;;
                     feedback.className = &#39;mt-0 text-center h-0 text-lg&#39;;
                 }
                 
                 // 添加当前字符到已回答的字符列表
                 lastAnsweredChars.push(content[currentPosition]);
                 
                 // 保存当前位置
                 const savedPosition = currentPosition;
                 
                 // 检查并添加后续标点符号
                 currentPosition++;
                 while (currentPosition &lt; content.length &amp;&amp; isPunctuation(content[currentPosition])) {
                     // 将标点符号也添加到已回答列表
                     lastAnsweredChars.push(content[currentPosition]);
                     currentPosition++;
                 }
                 
                 // 如果超出最大显示字数限制，移除最早的字符
                 while (lastAnsweredChars.length &gt; MAX_DISPLAYED_CHARS) {
                     lastAnsweredChars.shift();
                 }
                 
                 // 更新已回答字符显示
                 const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                 if (lastAnsweredCharsElem) {
                     // 构建HTML内容，最后一个非标点符号字符使用特殊样式
                     if (lastAnsweredChars.length &gt; 0) {
                         let htmlContent = &#39;&#39;;
                         
                         // 找出最后一个非标点符号字符的索引
                         let lastNonPunctIndex = -1;
                         for (let i = lastAnsweredChars.length - 1; i &gt;= 0; i--) {
                             if (!isPunctuation(lastAnsweredChars[i])) {
                                 lastNonPunctIndex = i;
                                 break;
                             }
                         }
                         
                         // 构建HTML内容
                         for (let i = 0; i &lt; lastAnsweredChars.length; i++) {
                             // 如果是最后一个非标点符号字符，加粗放大
                             if (i === lastNonPunctIndex) {
                                 htmlContent += `&lt;span class=&quot;text-2xl md:text-3xl font-bold&quot;&gt;${lastAnsweredChars[i]}&lt;/span&gt;`;
                             } else {
                                 htmlContent += lastAnsweredChars[i];
                             }
                         }
                         
                         lastAnsweredCharsElem.innerHTML = htmlContent;
                     } else {
                         lastAnsweredCharsElem.innerHTML = &#39;&#39;;
                     }
                 }
                 
                 // 增加成功背誦字數計數
                 if (!isPunctuation(content[savedPosition])) {
                     successfulChars++;
                     
                     // 每成功背誦50字，恢復1點生命值（上限為3點）
                     if (successfulChars % 50 === 0 &amp;&amp; lives &lt; 3) {
                         lives++;
                         updateLives();
                         
                         // 顯示恢復生命值動畫效果
                         const healEffect = document.createElement(&#39;div&#39;);
                         healEffect.className = &#39;fixed inset-0 pointer-events-none z-50 flex items-center justify-center&#39;;
                         healEffect.innerHTML = `&lt;div class=&quot;bg-green-500 bg-opacity-30 p-4 rounded-full text-white text-2xl font-bold animate-pulse&quot;&gt;+1 ❤️&lt;/div&gt;`;
                         document.body.appendChild(healEffect);
                         
                         setTimeout(() =&gt; {
                             healEffect.remove();
                         }, 1500);
                     }
                 }
                 
                 updateDisplay();
                 canSelect = true;
             }
             
             function handleIncorrectAnswer(btn) {
                 // 添加错误效果
                 btn.classList.add(&#39;incorrect&#39;);
                 
                 // 扣除生命值
                 lives--;
                 updateLives();
                 
                 // 增加錯誤計數
                 wrongAnswersCount++;
                 
                 // 检查游戏是否结束
                 if (lives &lt;= 0) {
                     gameOver();
                     return;
                 }
                 
                 // 不再顯示反饋文字
                 if (feedback) {
                     feedback.textContent = &#39;&#39;;
                     feedback.className = &#39;mt-0 text-center h-0 text-lg&#39;;
                 }
                 
                 // 添加屏幕震动效果
                 document.body.classList.add(&#39;screen-shake&#39;);
                 setTimeout(() =&gt; {
                     document.body.classList.remove(&#39;screen-shake&#39;);
                 }, 500);
                 
                 // 延迟移除效果
                 setTimeout(() =&gt; {
                     btn.classList.remove(&#39;incorrect&#39;);
                 }, 1000);
             }
             
             function updateLives() {
                 const livesContainer = document.getElementById(&#39;lives&#39;);
                 if (!livesContainer) return;
                 
                 livesContainer.innerHTML = &#39;&#39;;
                 
                 for (let i = 0; i &lt; lives; i++) {
                     const heart = document.createElement(&#39;i&#39;);
                     heart.className = &#39;fas fa-heart mx-0.5 animate-pulse&#39;;
                     livesContainer.appendChild(heart);
                 }
                 
                 for (let i = 0; i &lt; 3 - lives; i++) {
                     const emptyHeart = document.createElement(&#39;i&#39;);
                     emptyHeart.className = &#39;far fa-heart mx-0.5 text-gray-400 dark:text-gray-600&#39;;
                     livesContainer.appendChild(emptyHeart);
                 }
             }
             
             function gameOver() {
                 // 停止遊戲
                 canSelect = false;
                 stopStopwatch();
                 
                 // 更新按鈕狀態為「失敗」，顯示返回主頁按鈕
                 updateGameControlButtons(&#39;failed&#39;);
                 
                 // 隱藏遊戲內容
                 if (gameContent) {
                     gameContent.classList.add(&#39;hidden&#39;);
                 }
                 
                 // 檢查是否過半後失敗並更新成就
                 const progressBar = document.getElementById(&#39;progress-bar&#39;);
                 if (progressBar) {
                     const progressWidth = progressBar.style.width || &#39;0%&#39;;
                     const progressPercent = parseFloat(progressWidth);
                     
                     // 如果進度超過50%，記錄為過半後失敗
                     if (progressPercent &gt;= 50) {
                         // 增加失敗計數
                         globalStats.failAfterHalfwayCount = (globalStats.failAfterHalfwayCount || 0) + 1;
                         
                         // 更新挫敗之路成就等級
                         const failCount = globalStats.failAfterHalfwayCount;
                         
                         if (failCount &gt;= 100 &amp;&amp; globalStats.achievements.defeatLevel &lt; 5) {
                             globalStats.achievements.defeatLevel = 5; // 心如止水 (100次)
                         } else if (failCount &gt;= 50 &amp;&amp; globalStats.achievements.defeatLevel &lt; 4) {
                             globalStats.achievements.defeatLevel = 4; // 小強是我 (50次)
                         } else if (failCount &gt;= 30 &amp;&amp; globalStats.achievements.defeatLevel &lt; 3) {
                             globalStats.achievements.defeatLevel = 3; // 鋼鐵意志 (30次)
                         } else if (failCount &gt;= 5 &amp;&amp; globalStats.achievements.defeatLevel &lt; 2) {
                             globalStats.achievements.defeatLevel = 2; // 堅毅 (5次)
                         } else if (failCount &gt;= 1 &amp;&amp; globalStats.achievements.defeatLevel &lt; 1) {
                             globalStats.achievements.defeatLevel = 1; // 初嘗敗績 (1次)
                         }
                         
                         console.log(`過半後失敗，總計: ${failCount}次，成就等級: ${globalStats.achievements.defeatLevel}`);
                         
                         // 保存更新的統計數據
                         saveStats();
                     }
                 }
                 
                 // 計算已完成字符的經驗值獎勵
                 const progressText = document.getElementById(&#39;progress-text&#39;);
                 if (progressText) {
                     const progressInfo = progressText.textContent.split(&#39;/&#39;);
                     if (progressInfo.length === 2) {
                         const completedChars = parseInt(progressInfo[0].trim());
                         if (!isNaN(completedChars) &amp;&amp; completedChars &gt; 0) {
                             const expGained = completedChars * 2;
                             addExperience(expGained);
                             console.log(`遊戲失敗，獲得經驗值: ${expGained} (已完成${completedChars}字符)`);
                             
                             // 顯示獲得的經驗值訊息
                             const expNotification = document.createElement(&#39;div&#39;);
                             expNotification.className = &#39;fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 py-2 px-4 rounded-lg shadow-lg z-[9999] flex items-center&#39;;
                             expNotification.style.animation = &#39;fadeInOut 3s ease-in-out forwards&#39;;
                             expNotification.innerHTML = `
                                 &lt;i class=&quot;fas fa-star text-amber-500 dark:text-amber-300 mr-2&quot;&gt;&lt;/i&gt;
                                 &lt;div&gt;獲得 &lt;span class=&quot;font-bold&quot;&gt;${expGained}&lt;/span&gt; 經驗值&lt;/div&gt;
                             `;
                             document.body.appendChild(expNotification);
                             setTimeout(() =&gt; {
                                 expNotification.remove();
                             }, 3000);
                         }
                     }
                 }
                 
                 // 清空選項容器
                 if (!optionsContainer) {
                     console.error(&quot;選項容器未找到，無法顯示遊戲結束界面&quot;);
                     return;
                 }
                 
                 // 重置容器樣式
                 optionsContainer.innerHTML = &#39;&#39;;
                 optionsContainer.className = &#39;flex justify-center items-center mb-4&#39;;
                 
                 // 創建遊戲結束視圖的容器
                 const gameOverContainer = document.createElement(&#39;div&#39;);
                 gameOverContainer.id = &#39;game-over-container&#39;;
                 gameOverContainer.className = &#39;text-center bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md w-4/5&#39;;
                 
                 // 設置結果信息
                 gameOverContainer.innerHTML = `
                     &lt;p class=&quot;text-2xl text-red-600 dark:text-red-500 mb-6 font-bold&quot;&gt;可惜！&lt;/p&gt;
                     &lt;div class=&quot;bg-gray-100 dark:bg-gray-800 p-4 rounded-lg mb-5&quot;&gt;
                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;時間: ${timerElement ? timerElement.textContent : &quot;00:00.0&quot;}&lt;/p&gt;
                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;錯誤次數: ${wrongAnswersCount}&lt;/p&gt;
                     &lt;/div&gt;
                     &lt;div id=&quot;game-over-buttons&quot; class=&quot;flex justify-center gap-6 mt-4&quot;&gt;
                         &lt;!-- 按鈕將通過JS動態添加 --&gt;
                     &lt;/div&gt;
                 `;
                 
                 // 添加到DOM
                 optionsContainer.appendChild(gameOverContainer);
                 
                 // 創建按鈕
                 const buttonsContainer = document.getElementById(&#39;game-over-buttons&#39;);
                 
                 // 1. 分享按鈕
                 const shareButton = document.createElement(&#39;button&#39;);
                 shareButton.id = &#39;share-failed-btn&#39;;
                 shareButton.className = &#39;w-12 h-12 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors flex items-center justify-center text-xl&#39;;
                 shareButton.innerHTML = &#39;&lt;i class=&quot;fas fa-share-alt&quot;&gt;&lt;/i&gt;&#39;;
                 buttonsContainer.appendChild(shareButton);
                 
                 // 2. 重來按鈕
                 const restartButton = document.createElement(&#39;button&#39;);
                 restartButton.id = &#39;restart-failed-btn&#39;;
                 restartButton.className = &#39;w-12 h-12 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors flex items-center justify-center text-xl&#39;;
                 restartButton.innerHTML = &#39;&lt;i class=&quot;fas fa-redo&quot;&gt;&lt;/i&gt;&#39;;
                 buttonsContainer.appendChild(restartButton);
                
                 
                 // 添加震動效果
                 document.body.classList.add(&#39;game-over-shake&#39;);
                 setTimeout(() =&gt; {
                     document.body.classList.remove(&#39;game-over-shake&#39;);
                 }, 1000);
                 
                 // 定義公共的遊戲重置邏輯
                 function resetGameState() {
                     console.log(&quot;重置遊戲狀態&quot;);
                     currentPosition = 0;
                     correctAnswers = 0;
                     lives = 3;
                     successfulChars = 0;
                     wrongAnswersCount = 0;
                     lastAnsweredChars = [];
                     
                     const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                     if (lastAnsweredCharsElem) {
                         lastAnsweredCharsElem.textContent = &#39;&#39;;
                     }
                     
                     canSelect = true;
                     isPaused = false;
                     hasPaused = false;
                     updateLives();
                     
                     if (feedback) {
                         feedback.textContent = &#39;&#39;;
                     }
                     
                     // 更新進度條
                     const progressText = document.getElementById(&#39;progress-text&#39;);
                     const progressBar = document.getElementById(&#39;progress-bar&#39;);
                     
                     if (progressText) {
                         progressText.textContent = `0 / ${totalNonPunctChars}`;
                     }
                     
                     if (progressBar) {
                         progressBar.style.width = &#39;0%&#39;;
                     }
                     
                     // 清空選項容器
                     if (optionsContainer) {
                         optionsContainer.innerHTML = &#39;&#39;;
                         optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                     }
                 }
                 
                 // === 直接添加事件處理器 ===
                 
                 // 1. 分享按鈕事件
                 shareButton.onclick = function() {
                     console.log(&quot;分享按鈕被點擊&quot;);
                     
                     // 顯示加載中動畫
                     const loadingOverlay = document.createElement(&#39;div&#39;);
                     loadingOverlay.className = &#39;fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[101]&#39;;
                     loadingOverlay.innerHTML = `
                         &lt;div class=&quot;bg-white dark:bg-gray-800 p-6 rounded-lg flex flex-col items-center&quot;&gt;
                             &lt;i class=&quot;fas fa-spinner fa-spin text-3xl text-primary mb-3&quot;&gt;&lt;/i&gt;
                             &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;正在生成分享圖片...&lt;/p&gt;
                         &lt;/div&gt;
                     `;
                     document.body.appendChild(loadingOverlay);
                     
                     // 獲取段落索引
                     const paragraphInfo = window.selectedParagraphIndices || [];
                     
                     // 創建分享卡片
                     const selectedPassage = passages[currentPassageKey];
                     if (selectedPassage) {
                         createShareCard(
                             selectedPassage.title, 
                             selectedPassage.author, 
                             timerElement ? timerElement.textContent : &quot;00:00.0&quot;, 
                             wrongAnswersCount, 
                             totalNonPunctChars, 
                             [], 
                             paragraphInfo
                         ).then(imageData =&gt; {
                             document.body.removeChild(loadingOverlay);
                             handleShare(imageData);
                         }).catch(err =&gt; {
                             console.error(&#39;創建分享卡片失敗:&#39;, err);
                             document.body.removeChild(loadingOverlay);
                             alert(&#39;生成分享圖片失敗，請稍後再試。&#39;);
                         });
                     } else {
                         document.body.removeChild(loadingOverlay);
                         alert(&#39;無法獲取當前篇章信息，分享失敗。&#39;);
                     }
                 };
                 
                 // 2. 重來按鈕事件 - 修復重新開始功能
                 restartButton.onclick = async function() {
                     console.log(&quot;重來按鈕被點擊&quot;);
                     
                     try {
                         // 顯示載入動畫
                         await showLoadingAnimation();
                         
                         // 重置遊戲狀態
                         currentPosition = 0;
                         correctAnswers = 0;
                         wrongAnswersCount = 0;
                         lives = 3;
                         successfulChars = 0;
                         lastAnsweredChars = [];
                         
                         // 重置UI元素
                         const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                         if (lastAnsweredCharsElem) {
                             lastAnsweredCharsElem.textContent = &#39;&#39;;
                         }
                         
                         updateLives();
                         
                         if (completedText) {
                             completedText.textContent = &#39;&#39;;
                         }
                         
                         if (feedback) {
                             feedback.textContent = &#39;&#39;;
                             feedback.className = &#39;mt-4 text-center h-6 text-lg&#39;;
                         }
                         
                         // 更新進度條
                         const progressText = document.getElementById(&#39;progress-text&#39;);
                         const progressBar = document.getElementById(&#39;progress-bar&#39;);
                         
                         if (progressText) {
                             progressText.textContent = `0 / ${totalNonPunctChars}`;
                         }
                         
                         if (progressBar) {
                             progressBar.style.width = &#39;0%&#39;;
                         }
                         
                         // 重置遊戲狀態
                         canSelect = true;
                         isPaused = false;
                         hasPaused = false; // 重置暫停標記
                         
                         // 重置秒表
                         stopStopwatch();
                         elapsedTimeBeforePause = 0; // 重置累計時間
                         if (timerElement) {
                             timerElement.textContent = &quot;00:00.0&quot;;
                         }
                         
                         // 顯示開始屏幕
                         if (gameContent &amp;&amp; gameStartScreen) {
                             gameContent.classList.add(&#39;hidden&#39;);
                             gameStartScreen.classList.remove(&#39;hidden&#39;);
                         }
                         
                         // 清空選項並恢復原始的網格佈局
                         if (optionsContainer) {
                             optionsContainer.innerHTML = &#39;&#39;;
                             optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                         }
                         
                         console.log(&quot;遊戲已重置，返回開始界面&quot;);
                     } catch (error) {
                         console.error(&quot;重新開始時出錯:&quot;, error);
                         alert(&quot;重新開始時發生錯誤，請重新載入頁面&quot;);
                     }
                 };
                 
                 // 3. 返回按鈕事件 - 徹底重寫，並添加頁面滾動至頂部功能
                 returnButton.onclick = function() {
                     console.log(&quot;返回按鈕被點擊&quot;);
                     
                     try {
                         // 重置遊戲狀態
                         resetGameState();
                         
                         // 獲取需要操作的元素
                         const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                         const gamePage = document.getElementById(&#39;game-page&#39;);
                         
                         // 簡單地檢查元素是否存在
                         if (!userProfileContainer || !gamePage) {
                             console.error(&quot;未找到必要的DOM元素&quot;);
                             alert(&quot;返回失敗，請重新載入頁面&quot;);
                             return;
                         }
                         
                         // ===== 強制徹底隱藏遊戲界面 =====
                         console.log(&quot;開始執行界面切換&quot;);
                         
                         // 先徹底隱藏遊戲界面 - 使用多重方式確保隱藏
                         gamePage.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;&#39;;
                         gamePage.classList.add(&#39;hidden&#39;);
                         
                         // 移除任何可能顯示遊戲界面的類名
                         gamePage.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                         
                         // ===== 強制徹底顯示用戶資料表 =====
                         
                         // 確保用戶資料表顯示
                         userProfileContainer.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important; pointer-events: auto !important;&#39;;
                         userProfileContainer.classList.remove(&#39;hidden&#39;);
                         
                         // 添加顯示類名
                         userProfileContainer.classList.add(&#39;block&#39;);
                         
                         // 確保書本頁面回到初始狀態
                         const bookPage = document.querySelector(&#39;.page&#39;);
                         if (bookPage &amp;&amp; bookPage.classList.contains(&#39;turned&#39;)) {
                             bookPage.classList.remove(&#39;turned&#39;);
                         }
                         
                         // **新功能** 滾動頁面至頂部
                         window.scrollTo({
                             top: 0,
                             behavior: &#39;smooth&#39;
                         });
                         
                         // 使用延遲檢查元素最終狀態
                         setTimeout(() =&gt; {
                             // 檢查狀態並記錄
                             console.log(&quot;界面切換結果檢查:&quot;);
                             console.log(&quot;- 遊戲界面顯示狀態:&quot;, window.getComputedStyle(gamePage).display);
                             console.log(&quot;- 用戶資料表顯示狀態:&quot;, window.getComputedStyle(userProfileContainer).display);
                             
                             // 強制再次確認
                             if (window.getComputedStyle(gamePage).display !== &#39;none&#39;) {
                                 console.warn(&quot;遊戲界面仍未隱藏，再次嘗試...&quot;);
                                 gamePage.style.cssText = &#39;display: none !important; visibility: hidden !important;&#39;;
                             }
                             
                             if (window.getComputedStyle(userProfileContainer).display !== &#39;block&#39;) {
                                 console.warn(&quot;用戶資料表未顯示，再次嘗試...&quot;);
                                 userProfileContainer.style.cssText = &#39;display: block !important; visibility: visible !important;&#39;;
                             }
                             
                             // 再次確保頁面滾動至頂部
                             window.scrollTo({
                                 top: 0,
                                 behavior: &#39;smooth&#39;
                             });
                         }, 50);
                         
                         console.log(&quot;界面切換指令已執行&quot;);
                     } catch (error) {
                         console.error(&quot;返回按鈕處理發生錯誤:&quot;, error);
                         alert(&quot;返回時發生錯誤，請重新載入頁面&quot;);
                     }
                 };
             }
             
             // 顯示墨水擴散載入動畫
             function showLoadingAnimation() {
                 // 創建全屏覆蓋層和墨點容器
                 const loadingContainer = document.createElement(&#39;div&#39;);
                 loadingContainer.id = &#39;loading-container&#39;;
                 loadingContainer.style.position = &#39;fixed&#39;;
                 loadingContainer.style.top = &#39;0&#39;;
                 loadingContainer.style.left = &#39;0&#39;;
                 loadingContainer.style.width = &#39;100%&#39;;
                 loadingContainer.style.height = &#39;100%&#39;;
                 loadingContainer.style.backgroundColor = &#39;rgba(245, 242, 234, 1)&#39;; // 完全不透明背景
                 loadingContainer.style.zIndex = &#39;9999&#39;; // 確保在最上層
                 loadingContainer.style.display = &#39;flex&#39;;
                 loadingContainer.style.justifyContent = &#39;center&#39;;
                 loadingContainer.style.alignItems = &#39;center&#39;;
                 loadingContainer.style.opacity = &#39;0&#39;;
                 loadingContainer.style.animation = &#39;fadeIn 0.15s ease forwards&#39;;
                 loadingContainer.innerHTML = `
                     &lt;div id=&quot;main-splash&quot;&gt;&lt;/div&gt;
                 `;
                 document.body.appendChild(loadingContainer);
         
                 // 動畫結束後返回
                 return new Promise(resolve =&gt; {
                     setTimeout(function() {
                         hideLoadingAnimation();
                         resolve();
                     }, 900);
                 });
             }
         
             function hideLoadingAnimation() {
                 const container = document.getElementById(&#39;loading-container&#39;);
                 if (container) {
                     container.classList.add(&#39;fade-out&#39;);
                     // 加快淡出時間
                     setTimeout(function() {
                         container.remove();
                     }, 200);
                 }
             }            
         
             // 創建紙屑慶祝效果
             function createConfetti() {
                 // 加載 canvas-confetti 庫
                 const script = document.createElement(&#39;script&#39;);
                 script.src = &#39;https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js&#39;;
                 document.head.appendChild(script);
                 
                 // 建立 canvas 元素
                 const canvas = document.createElement(&#39;canvas&#39;);
                 canvas.id = &#39;confetti-canvas&#39;;
                 document.body.appendChild(canvas);
                 
                 script.onload = function() {
                     // 設置 confetti
                     const myConfetti = confetti.create(canvas, {
                         resize: true,
                         useWorker: true
                     });
                     
                     // 開始紙屑效果
                     
                     // 第一波：從頂部射出
                     myConfetti({
                         particleCount: 180,
                         spread: 100,
                         origin: { y: 0 },
                         colors: [&#39;#5D5CDE&#39;, &#39;#FF8C00&#39;, &#39;#4CAF50&#39;, &#39;#FF5252&#39;, &#39;#FFC107&#39;, &#39;#2196F3&#39;],
                         startVelocity: 30,
                         gravity: 0.7,
                         scalar: 0.9
                     });
                     
                     // 從左右兩側射出
                     setTimeout(() =&gt; {
                         // 左側紙屑
                         myConfetti({
                             particleCount: 100,
                             angle: 60,
                             spread: 55,
                             origin: { x: 0, y: 0.5 },
                             colors: [&#39;#5D5CDE&#39;, &#39;#4CAF50&#39;, &#39;#FFC107&#39;, &#39;#2196F3&#39;]
                         });
                         
                         // 右側紙屑
                         myConfetti({
                             particleCount: 100,
                             angle: 120,
                             spread: 55,
                             origin: { x: 1, y: 0.5 },
                             colors: [&#39;#FF8C00&#39;, &#39;#FF5252&#39;, &#39;#E91E63&#39;, &#39;#9C27B0&#39;]
                         });
                     }, 700);
                     
                     // 第二波紙屑 - 從底部向上射出
                     setTimeout(() =&gt; {
                         myConfetti({
                             particleCount: 120,
                             spread: 120,
                             origin: { y: 0.9 },
                             startVelocity: 45,
                             gravity: 1,
                             scalar: 0.7
                         });
                     }, 1500);
                     
                     // 第三波 - 爆炸效果
                     setTimeout(() =&gt; {
                         myConfetti({
                             particleCount: 150,
                             spread: 180,
                             origin: { x: 0.5, y: 0.5 }
                         });
                     }, 2500);
                     
                     // 清理資源
                     setTimeout(() =&gt; {
                         canvas.remove();
                     }, 8000);
                 };
             }
             
             // 創建結果分享卡片
             function createShareCard(passageTitle, author, finalTime, wrongAnswersCount, totalNonPunctChars, achievements, paragraphIndices) {
                 return new Promise((resolve, reject) =&gt; {
                     try {
                         // 創建一個離屏的卡片元素用於截圖
                         const card = document.createElement(&#39;div&#39;);
                         card.id = &#39;share-card&#39;;
                         // 強制使用深色模式樣式，無論當前應用模式如何
                         card.className = &#39;fixed top-0 left-0 bg-gray-800 border-8 border-amber-900 p-6 rounded-lg shadow-xl&#39;;
                         card.style.width = &#39;350px&#39;;
                         card.style.zIndex = &#39;-100&#39;; // 確保在屏幕外不可見
                         
                         // 處理標題，添加段落範圍信息
                         let displayTitle = passageTitle;
                         let rangeText = &quot;&quot;;
                         
                         // 取得全局保存的段落索引，如果提供的參數無效
                         let indicesToUse = [];
                         if (paragraphIndices &amp;&amp; Array.isArray(paragraphIndices) &amp;&amp; paragraphIndices.length &gt; 0) {
                             indicesToUse = paragraphIndices;
                             console.log(&quot;使用提供的段落索引:&quot;, indicesToUse);
                         } else if (window.selectedParagraphIndices &amp;&amp; Array.isArray(window.selectedParagraphIndices) &amp;&amp; window.selectedParagraphIndices.length &gt; 0) {
                             indicesToUse = window.selectedParagraphIndices;
                             console.log(&quot;使用全局保存的段落索引:&quot;, indicesToUse);
                         } else {
                             console.log(&quot;未找到段落索引資訊&quot;);
                         }
                         
                         // 如果有段落索引數組，構建顯示範圍
                         if (indicesToUse.length &gt; 0) {
                             const selectedPassage = passages[currentPassageKey];
                             if (selectedPassage) {
                                 // 檢查是否是完整篇章
                                 const isFullPassage = indicesToUse.length &gt;= selectedPassage.paragraphs.length;
                                 
                                 if (!isFullPassage) {
                                     // 對段落索引進行排序
                                     indicesToUse.sort((a, b) =&gt; a - b);
                                     
                                     // 確定是否是連續的段落
                                     let isConsecutive = true;
                                     for (let i = 0; i &lt; indicesToUse.length - 1; i++) {
                                         if (indicesToUse[i + 1] !== indicesToUse[i] + 1) {
                                             isConsecutive = false;
                                             break;
                                         }
                                     }
                                     
                                     if (indicesToUse.length === 1) {
                                         rangeText = `第${indicesToUse[0] + 1}段`;
                                     } else if (isConsecutive) {
                                         rangeText = `第${indicesToUse[0] + 1}-${indicesToUse[indicesToUse.length - 1] + 1}段`;
                                     } else {
                                         rangeText = `第${indicesToUse.map(idx =&gt; idx + 1).join(&#39;、&#39;)}段`;
                                     }
                                     
                                     displayTitle = `${passageTitle}（${rangeText}）`;
                                     console.log(&quot;生成的顯示標題:&quot;, displayTitle);
                                 }
                             }
                         }
                         
                         // 生成成就徽章HTML - 修正印章內文字居中問題
                         let achievementsHTML = &#39;&#39;;
                         if (achievements &amp;&amp; achievements.length &gt; 0) {
                             achievementsHTML = `
                             &lt;div class=&quot;mt-4 mb-3 border-t border-gray-600 pt-3&quot;&gt;
                                 &lt;p class=&quot;text-sm font-medium text-amber-400 mb-2&quot;&gt;獲得成就:&lt;/p&gt;
                                 &lt;div class=&quot;flex flex-wrap justify-center mb-2&quot; style=&quot;margin: 0 -8px;&quot;&gt;
                             `;
                             
                             // 添加每個成就徽章 - 改進文字居中和邊距
                             achievements.forEach(achievement =&gt; {
                                 // 提取SVG
                                 const svg = achievement.svg;
                                 
                                 achievementsHTML += `
                                 &lt;div style=&quot;width: 70px; height: 70px; position: relative; display: inline-flex; justify-content: center; align-items: center; transform: rotate(-5deg); margin: 4px;&quot;&gt;
                                     &lt;div style=&quot;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&quot;&gt;
                                         ${svg}
                                     &lt;/div&gt;
                                     &lt;div style=&quot;position: relative; z-index: 10; font-family: &#39;Noto Serif TC&#39;, serif; font-weight: bold; color: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100%;&quot;&gt;
                                         &lt;span style=&quot;font-size: 10px; line-height: 1.2; text-align: center; width: 80%; display: block;&quot;&gt;${achievement.title}&lt;/span&gt;
                                     &lt;/div&gt;
                                 &lt;/div&gt;`;
                             });
                             
                             achievementsHTML += `&lt;/div&gt;&lt;/div&gt;`;
                         }
                         
                         // 卡片內容 - 使用深色模式的文字顏色
                         card.innerHTML = `
                             &lt;div class=&quot;relative&quot;&gt;
                                 &lt;div class=&quot;text-center mb-3&quot;&gt;
                                     &lt;h2 class=&quot;text-xl font-bold text-gray-100&quot;&gt;${displayTitle}&lt;/h2&gt;
                                     &lt;p class=&quot;text-gray-400 text-sm&quot;&gt;${author}&lt;/p&gt;
                                 &lt;/div&gt;
                                 
                                 &lt;div class=&quot;bg-gray-700 p-3 rounded-lg&quot;&gt;
                                     &lt;div class=&quot;flex justify-between mb-1&quot;&gt;
                                         &lt;span class=&quot;text-gray-300 text-sm&quot;&gt;完成時間:&lt;/span&gt;
                                         &lt;span class=&quot;font-medium text-gray-200&quot;&gt;${finalTime}&lt;/span&gt;
                                     &lt;/div&gt;
                                     &lt;div class=&quot;flex justify-between mb-1&quot;&gt;
                                         &lt;span class=&quot;text-gray-300 text-sm&quot;&gt;錯誤次數:&lt;/span&gt;
                                         &lt;span class=&quot;font-medium text-gray-200&quot;&gt;${wrongAnswersCount}&lt;/span&gt;
                                     &lt;/div&gt;
                                     &lt;div class=&quot;flex justify-between&quot;&gt;
                                         &lt;span class=&quot;text-gray-300 text-sm&quot;&gt;總字數:&lt;/span&gt;
                                         &lt;span class=&quot;font-medium text-gray-200&quot;&gt;${totalNonPunctChars}&lt;/span&gt;
                                     &lt;/div&gt;
                                 &lt;/div&gt;
                                 
                                 ${achievementsHTML}
                                 
                                 &lt;div class=&quot;mt-3 text-center text-xs text-gray-400&quot;&gt;
                                     文言大師之旅 © ${new Date().getFullYear()}
                                 &lt;/div&gt;
                             &lt;/div&gt;
                         `;
                         
                         document.body.appendChild(card);
                         
                         // 給元素一些時間渲染
                         setTimeout(() =&gt; {
                             html2canvas(card, {
                                 backgroundColor: &#39;#181818&#39;, // 強制使用深色背景
                                 scale: 2, // 高解析度
                                 logging: false,
                                 allowTaint: true,
                                 useCORS: true
                             }).then(canvas =&gt; {
                                 const imageData = canvas.toDataURL(&#39;image/png&#39;);
                                 document.body.removeChild(card);
                                 resolve(imageData);
                             }).catch(err =&gt; {
                                 document.body.removeChild(card);
                                 reject(err);
                             });
                         }, 100);
                     } catch (error) {
                         reject(error);
                     }
                 });
             }
         
             // 處理分享功能
             function handleShare(imageData) {
                 // 檢查是否支持 Web Share API
                 if (navigator.share &amp;&amp; navigator.canShare &amp;&amp; navigator.canShare({ files: [new File([dataURItoBlob(imageData)], &#39;result.png&#39;, { type: &#39;image/png&#39; })] })) {
                     // 手機分享方式
                     navigator.share({
                         files: [new File([dataURItoBlob(imageData)], &#39;result.png&#39;, { type: &#39;image/png&#39; })],
                         title: &#39;文言大師之旅&#39;,
                         text: &#39;我剛剛完成了文言文背誦挑戰！&#39;
                     }).catch(err =&gt; {
                         console.log(&#39;分享失敗:&#39;, err);
                         // 如果Web Share API失敗，提供備用選項
                         showShareOptions(imageData);
                     });
                 } else {
                     // 桌面版或不支持Web Share API時的分享選項
                     showShareOptions(imageData);
                 }
             }
             
             // 顯示分享選項
             function showShareOptions(imageData) {
                 const shareModal = document.createElement(&#39;div&#39;);
                 shareModal.className = &#39;fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]&#39;;
                 shareModal.innerHTML = `
                 &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-4 max-w-md w-full mx-4&quot;&gt;
                     &lt;div class=&quot;flex justify-between items-center mb-3&quot;&gt;
                         &lt;h3 class=&quot;text-lg font-bold text-gray-800 dark:text-gray-100&quot;&gt;分享您的成績&lt;/h3&gt;

                         &lt;button id=&quot;close-share-modal&quot; class=&quot;text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100&quot;&gt;
                             &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
                         &lt;/button&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;flex justify-center mb-4&quot;&gt;
                         &lt;img src=&quot;${imageData}&quot; alt=&quot;成績卡片&quot; class=&quot;max-h-[350px] border border-gray-200 dark:border-gray-700 rounded-lg shadow-md&quot; /&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;flex justify-center gap-4&quot;&gt;
                         &lt;button id=&quot;download-share-image&quot; class=&quot;px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90&quot;&gt;
                             &lt;i class=&quot;fas fa-download mr-2&quot;&gt;&lt;/i&gt;下載圖片
                         &lt;/button&gt;
                     &lt;/div&gt;
                     &lt;p class=&quot;text-center text-sm text-gray-500 mt-3&quot;&gt;保存圖片後可以分享到社交媒體&lt;/p&gt;
                 &lt;/div&gt;
                 `;
                 
                 document.body.appendChild(shareModal);
                 
                 // 關閉按鈕
                 document.getElementById(&#39;close-share-modal&#39;).addEventListener(&#39;click&#39;, () =&gt; {
                     document.body.removeChild(shareModal);
                 });
                 
                 // 下載圖片
                 document.getElementById(&#39;download-share-image&#39;).addEventListener(&#39;click&#39;, () =&gt; {
                     const link = document.createElement(&#39;a&#39;);
                     link.href = imageData;
                     link.download = &#39;文言文背誦成績.png&#39;;
                     document.body.appendChild(link);
                     link.click();
                     document.body.removeChild(link);
                 });
                 
                 // 點擊背景關閉模態框
                 shareModal.addEventListener(&#39;click&#39;, (e) =&gt; {
                     if (e.target === shareModal) {
                         document.body.removeChild(shareModal);
                     }
                 });
             }
             
             // 將DataURI轉換為Blob
             function dataURItoBlob(dataURI) {
                 const byteString = atob(dataURI.split(&#39;,&#39;)[1]);
                 const mimeString = dataURI.split(&#39;,&#39;)[0].split(&#39;:&#39;)[1].split(&#39;;&#39;)[0];
                 const ab = new ArrayBuffer(byteString.length);
                 const ia = new Uint8Array(ab);
                 
                 for (let i = 0; i &lt; byteString.length; i++) {
                     ia[i] = byteString.charCodeAt(i);
                 }
                 
                 return new Blob([ab], { type: mimeString });
             }
         
             function completePassage() {
                 // 停止遊戲内容顯示
                 if (gameContent) {
                     gameContent.classList.add(&#39;hidden&#39;);
                 }
                 
                 // 更新按鈕狀態為「完成」，顯示返回主頁按鈕
                 updateGameControlButtons(&#39;completed&#39;);
                 
                 // 如果指定的DOM元素不存在，則記錄錯誤並中止
                 if (!optionsContainer) {
                     console.error(&quot;optionsContainer未找到，無法顯示遊戲完成界面&quot;);
                     return;
                 }
                 
                 // 清空当前字符显示
                 if (currentChar) {
                     currentChar.textContent = &#39;&#39;;
                 }
                 
                 // 停止秒錶
                 stopStopwatch();
                 const finalTime = timerElement ? timerElement.textContent : &quot;00:00.0&quot;;
                 
                 // 計算總完成時間（秒）
                 const totalSeconds = getCompletionTimeInSeconds();
                 
                 // 記錄通關成績 - 檢查是否為完整篇章
                 const selectedPassage = passages[currentPassageKey];
                 if (selectedPassage) {
                     // 確保用於檢查完整篇章時顯示正確的結果
                     let allParagraphsContent = selectedPassage.paragraphs.join(&#39;&#39;);
                     const isFullPassage = (content === allParagraphsContent);
                     
                     console.log(&quot;完成挑戰&quot;);
                     console.log(&quot;篇章鍵值:&quot;, currentPassageKey);
                     console.log(&quot;是否為完整篇章:&quot;, isFullPassage);
                     console.log(&quot;完成時間(秒):&quot;, totalSeconds);
                     
                     // 只有完整篇章才記錄成績
                     recordCompletionStats(currentPassageKey, totalSeconds, isFullPassage);
                 }
                 
                 // 播放紙屑慶祝效果
                 createConfetti();
                 
                 // 判斷成就
                 const isPerfect = wrongAnswersCount === 0;
                 const isLightningFast = totalSeconds &lt;= totalNonPunctChars * 0.8; // 使用总字数*0.8秒作为閃電俠阈值
                 const isMaster = totalNonPunctChars &gt;= 300; // 記憶大師（字數超過300）
                 const isSnail = totalSeconds &gt;= totalNonPunctChars * 3; // 蝸牛（時間超過字數*3秒）
                 const isTireless = !hasPaused; // 不知疲倦（全程不暫停）
                 
                 // 檢查特殊時間成就 - 在這裡也檢查一次，確保成就及時展示
                 // 判斷夜貓成就 (01:00-03:00)
                 const now = new Date();
                 const hours = now.getHours();
                 const minutes = now.getMinutes();
                 
                 // 判斷是否符合夜貓時間條件
                 const isNightOwl = (hours &gt;= 1 &amp;&amp; hours &lt; 3);
                 
                 // 判斷是否符合腸胃不好時間條件
                 const isBadDigestion = ((hours == 11 &amp;&amp; minutes &gt;= 59) || (hours == 12 &amp;&amp; minutes &lt;= 45));
                 
                 // 更新極速之路和完美之路成就
                 if (isLightningFast) {
                     // 增加獲得閃電俠成就次數
                     globalStats.lightningAchievementCount = (globalStats.lightningAchievementCount || 0) + 1;
                     
                     // 更新極速之路成就等級
                     const lightningCount = globalStats.lightningAchievementCount;
                     
                     if (lightningCount &gt;= 100 &amp;&amp; globalStats.achievements.speedRouteLevel &lt; 4) {
                         globalStats.achievements.speedRouteLevel = 4; // 世界第一束光 (100次)
                     } else if (lightningCount &gt;= 50 &amp;&amp; globalStats.achievements.speedRouteLevel &lt; 3) {
                         globalStats.achievements.speedRouteLevel = 3; // 無影手 (50次)
                     } else if (lightningCount &gt;= 10 &amp;&amp; globalStats.achievements.speedRouteLevel &lt; 2) {
                         globalStats.achievements.speedRouteLevel = 2; // 肌肉記憶 (10次)
                     } else if (lightningCount &gt;= 1 &amp;&amp; globalStats.achievements.speedRouteLevel &lt; 1) {
                         globalStats.achievements.speedRouteLevel = 1; // 敏捷 (1次)
                     }
                     
                     console.log(`獲得閃電俠成就，總計: ${lightningCount}次，極速之路等級: ${globalStats.achievements.speedRouteLevel}`);
                 }
                 
                 if (isPerfect) {
                     // 增加獲得完美無瑕成就次數
                     globalStats.perfectAchievementCount = (globalStats.perfectAchievementCount || 0) + 1;
                     
                     // 更新完美之路成就等級
                     const perfectCount = globalStats.perfectAchievementCount;
                     
                     if (perfectCount &gt;= 100 &amp;&amp; globalStats.achievements.perfectRouteLevel &lt; 4) {
                         globalStats.achievements.perfectRouteLevel = 4; // 至善 (100次)
                     } else if (perfectCount &gt;= 50 &amp;&amp; globalStats.achievements.perfectRouteLevel &lt; 3) {
                         globalStats.achievements.perfectRouteLevel = 3; // 滿月 (50次)
                     } else if (perfectCount &gt;= 10 &amp;&amp; globalStats.achievements.perfectRouteLevel &lt; 2) {
                         globalStats.achievements.perfectRouteLevel = 2; // 完美主義 (10次)
                     } else if (perfectCount &gt;= 1 &amp;&amp; globalStats.achievements.perfectRouteLevel &lt; 1) {
                         globalStats.achievements.perfectRouteLevel = 1; // 如沐春風 (1次)
                     }
                     
                     console.log(`獲得完美無瑕成就，總計: ${perfectCount}次，完美之路等級: ${globalStats.achievements.perfectRouteLevel}`);
                 }
                 
                 // 創建成就徽章
                 const createSealSVG = (colors, borderColor) =&gt; {
                     // 確保每個SVG有唯一ID
                     const uniqueId = &#39;seal_&#39; + Math.random().toString(36).substr(2, 9);
                     return `
                     &lt;svg viewBox=&quot;0 0 100 100&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
                         &lt;defs&gt;
                             &lt;radialGradient id=&quot;${uniqueId}&quot; cx=&quot;50%&quot; cy=&quot;50%&quot; r=&quot;50%&quot; fx=&quot;50%&quot; fy=&quot;50%&quot;&gt;
                                 &lt;stop offset=&quot;0%&quot; style=&quot;stop-color:${colors.center}&quot; /&gt;
                                 &lt;stop offset=&quot;70%&quot; style=&quot;stop-color:${colors.middle}&quot; /&gt;
                                 &lt;stop offset=&quot;100%&quot; style=&quot;stop-color:${colors.outer}&quot; /&gt;
                             &lt;/radialGradient&gt;
                         &lt;/defs&gt;
                         &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;45&quot; fill=&quot;url(#${uniqueId})&quot; /&gt;
                         &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;42&quot; fill=&quot;none&quot; stroke=&quot;${borderColor}&quot; stroke-width=&quot;1&quot; stroke-dasharray=&quot;2,1&quot; /&gt;
                         &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;38&quot; fill=&quot;none&quot; stroke=&quot;${borderColor}&quot; stroke-width=&quot;0.5&quot; /&gt;
                     &lt;/svg&gt;
                     `;
                 };
                 
                 // 定義各成就蠟章顏色
                 const perfectColors = { center: &#39;#8B0000&#39;, middle: &#39;#5C0000&#39;, outer: &#39;#400000&#39; };
                 const lightningColors = { center: &#39;#4B0082&#39;, middle: &#39;#2A004D&#39;, outer: &#39;#1C0033&#39; };
                 const masterColors = { center: &#39;#006400&#39;, middle: &#39;#004D00&#39;, outer: &#39;#003300&#39; };
                 const snailColors = { center: &#39;#8B4513&#39;, middle: &#39;#6B3100&#39;, outer: &#39;#4A2100&#39; };
                 const tirelessColors = { center: &#39;#1E3A8A&#39;, middle: &#39;#1E40AF&#39;, outer: &#39;#1D4ED8&#39; }; // 藍色調代表專注和堅持
                 const nightOwlColors = { center: &#39;#3E2723&#39;, middle: &#39;#33211B&#39;, outer: &#39;#2E1B15&#39; }; // 深咖啡色代表夜晚
                 const badDigestionColors = { center: &#39;#E65100&#39;, middle: &#39;#D84315&#39;, outer: &#39;#BF360C&#39; }; // 橙紅色代表不舒服
                 
                 // 格式化成就信息
                 const achievements = [];
                 
                 if (isPerfect) {
                     achievements.push({
                         svg: createSealSVG(perfectColors, &#39;#FFD700&#39;),
                         title: &#39;完美無瑕&#39;,
                         desc: &#39;零錯誤通關&#39;
                     });
                 }
                 
                 if (isLightningFast) {
                     achievements.push({
                         svg: createSealSVG(lightningColors, &#39;#00FFFF&#39;),
                         title: &#39;閃電俠&#39;,
                         desc: &#39;神速完成&#39;
                     });
                 }
                 
                 if (isMaster) {
                     // 增加獲得記憶大師成就次數
                     globalStats.memoryAchievementCount = (globalStats.memoryAchievementCount || 0) + 1;
                     
                     // 更新記憶之路成就等級
                     const memoryCount = globalStats.memoryAchievementCount;
                     
                     if (memoryCount &gt;= 50 &amp;&amp; globalStats.achievements.memoryRouteLevel &lt; 4) {
                         globalStats.achievements.memoryRouteLevel = 4; // 流如背倒 (50次)
                     } else if (memoryCount &gt;= 30 &amp;&amp; globalStats.achievements.memoryRouteLevel &lt; 3) {
                         globalStats.achievements.memoryRouteLevel = 3; // 移動圖書館 (30次)
                     } else if (memoryCount &gt;= 10 &amp;&amp; globalStats.achievements.memoryRouteLevel &lt; 2) {
                         globalStats.achievements.memoryRouteLevel = 2; // 記憶麵包 (10次)
                     } else if (memoryCount &gt;= 1 &amp;&amp; globalStats.achievements.memoryRouteLevel &lt; 1) {
                         globalStats.achievements.memoryRouteLevel = 1; // 激活腦細胞 (1次)
                     }
                     
                     console.log(`獲得記憶大師成就，總計: ${memoryCount}次，記憶之路等級: ${globalStats.achievements.memoryRouteLevel}`);
                     
                     achievements.push({
                         svg: createSealSVG(masterColors, &#39;#7CFC00&#39;),
                         title: &#39;記憶大師&#39;,
                         desc: &#39;一口氣300字+&#39;
                     });
                 }
                 
                 if (isSnail) {
                     achievements.push({
                         svg: createSealSVG(snailColors, &#39;#DAA520&#39;),
                         title: &#39;蝸牛&#39;,
                         desc: &#39;慢工出細活&#39;
                     });
                 }
                 
                 // 添加新成就：不知疲倦，並更新相關計數
                 if (isTireless) {
                     // 增加獲得不知疲倦成就次數
                     globalStats.tirelessAchievementCount = (globalStats.tirelessAchievementCount || 0) + 1;
                     
                     // 檢查是否達成「眼乾」成就（獲得不知疲倦30次）
                     if (globalStats.tirelessAchievementCount &gt;= 30 &amp;&amp; !globalStats.achievements.dryEyes) {
                         globalStats.achievements.dryEyes = true;
                         console.log(&quot;獲得獨立成就：眼乾（獲得不知疲倦30次）&quot;);
                     }
                     
                     achievements.push({
                         svg: createSealSVG(tirelessColors, &#39;#38BDF8&#39;),
                         title: &#39;不知疲倦&#39;,
                         desc: &#39;全程不暫停&#39;
                     });
                 }
                 
                 // 添加夜貓成就 - 在這裡直接添加，確保用戶可以看到
                 if (isNightOwl) {
                     // 更新全局統計
                     globalStats.achievements.nightOwl = true;
                     globalStats.nightOwlAchievementCount = (globalStats.nightOwlAchievementCount || 0) + 1;
                     
                     // 檢查是否達成「夜貓王」成就
                     if (globalStats.nightOwlAchievementCount &gt;= 20 &amp;&amp; !globalStats.achievements.nightOwlKing) {
                         globalStats.achievements.nightOwlKing = true;
                         console.log(&quot;獲得獨立成就：夜貓王（獲得夜貓20次）&quot;);
                     }
                     
                     // 添加到成就列表
                     achievements.push({
                         svg: createSealSVG(nightOwlColors, &#39;#4E342E&#39;),
                         title: &#39;夜貓&#39;,
                         desc: &#39;夜深時仍不休&#39;
                     });
                     
                     console.log(`獲得夜貓成就，總計: ${globalStats.nightOwlAchievementCount}次`);
                 }
                 
                 // 添加腸胃不好成就 - 在這裡直接添加，確保用戶可以看到
                 if (isBadDigestion) {
                     // 更新全局統計
                     globalStats.achievements.badDigestion = true;
                     globalStats.badDigestionAchievementCount = (globalStats.badDigestionAchievementCount || 0) + 1;
                     
                     // 檢查是否達成「請專心吃飯」成就
                     if (globalStats.badDigestionAchievementCount &gt;= 20 &amp;&amp; !globalStats.achievements.focusOnEating) {
                         globalStats.achievements.focusOnEating = true;
                         console.log(&quot;獲得獨立成就：請專心吃飯（獲得腸胃不好20次）&quot;);
                     }
                     
                     // 添加到成就列表
                     achievements.push({
                         svg: createSealSVG(badDigestionColors, &#39;#BF360C&#39;),
                         title: &#39;腸胃不好&#39;,
                         desc: &#39;用餐時間仍勤學&#39;
                     });
                     
                     console.log(`獲得腸胃不好成就，總計: ${globalStats.badDigestionAchievementCount}次`);
                 }
                 
                 // 保存更新的統計和成就
                 saveStats();
                 
                 // 清空選項容器並修改布局為flex布局
                 optionsContainer.innerHTML = &#39;&#39;;
                 optionsContainer.className = &#39;flex flex-col justify-center items-center mb-4&#39;;
                 
                 const completionMessage = document.createElement(&#39;div&#39;);
                 completionMessage.className = &#39;text-center bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md w-full sm:w-4/5&#39;;
                 completionMessage.id = &#39;completion-result&#39;;
                 
                 // 添加經驗值獎勵
                 const expGained = totalNonPunctChars*3; // 經驗值 = 該遊戲字數
                 addExperience(expGained);
                 console.log(`遊戲完成，獲得經驗值: ${expGained}`);
                 
                 // 顯示獲得的經驗值訊息
                 const expNotification = document.createElement(&#39;div&#39;);
                 expNotification.className = &#39;fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 py-2 px-4 rounded-lg shadow-lg z-[9999] flex items-center&#39;;
                 expNotification.style.animation = &#39;fadeInOut 3s ease-in-out forwards&#39;;
                 
                 expNotification.innerHTML = `
                     &lt;i class=&quot;fas fa-star text-amber-500 dark:text-amber-300 mr-2&quot;&gt;&lt;/i&gt;
                     &lt;div&gt;獲得 &lt;span class=&quot;font-bold&quot;&gt;${expGained}&lt;/span&gt; 經驗值&lt;/div&gt;
                 `;
                 
                 document.body.appendChild(expNotification);
                 
                 setTimeout(() =&gt; {
                     expNotification.remove();
                 }, 3000);
                 
                 // 生成成就徽章HTML
                 let achievementsHTML = &#39;&#39;;
                 if (achievements.length &gt; 0) {
                     achievementsHTML = `
                     &lt;div class=&quot;mb-5 mt-4&quot;&gt;
                         &lt;p class=&quot;text-lg font-medium text-amber-700 dark:text-amber-400 mb-3&quot;&gt;獲得成就:&lt;/p&gt;
                         &lt;div class=&quot;achievements-container&quot; style=&quot;display: flex; flex-wrap: wrap; justify-content: center; gap: 0px;&quot;&gt;
                     `;
                     
                     // 添加每個成就徽章，设置为一行至少显示三个
                     achievements.forEach(achievement =&gt; {
                         achievementsHTML += `
                         &lt;div class=&quot;achievement-seal&quot; style=&quot;width: calc(33.333% - 0px); min-width: 70px; max-width: 100px; flex-grow: 0; flex-shrink: 0;&quot;&gt;
                             ${achievement.svg}
                             &lt;div class=&quot;seal-text&quot;&gt;
                                 &lt;span class=&quot;seal-title&quot;&gt;${achievement.title}&lt;/span&gt;
                                 &lt;span class=&quot;seal-desc&quot;&gt;${achievement.desc}&lt;/span&gt;
                             &lt;/div&gt;
                         &lt;/div&gt;`;
                     });
                     
                     achievementsHTML += `&lt;/div&gt;&lt;/div&gt;`;
                 }
                 
                 // 準備按鈕HTML，先不包含onClick事件，稍後會直接在DOM元素上設置
                 const buttonsHTML = `
                     &lt;div class=&quot;flex justify-center gap-6 mt-4&quot;&gt;
                         &lt;button id=&quot;share-result-btn&quot; class=&quot;w-12 h-12 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors flex items-center justify-center text-xl&quot;&gt;
                             &lt;i class=&quot;fas fa-share-alt&quot;&gt;&lt;/i&gt;
                         &lt;/button&gt;
                         &lt;button id=&quot;restart-result-btn&quot; class=&quot;w-12 h-12 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors flex items-center justify-center text-xl&quot;&gt;
                             &lt;i class=&quot;fas fa-redo&quot;&gt;&lt;/i&gt;
                         &lt;/button&gt;
                     &lt;/div&gt;
                 `;
                 
                 // 生成完整信息HTML
                 completionMessage.innerHTML = `
                     &lt;p class=&quot;text-2xl text-green-600 dark:text-green-400 mb-6 font-bold&quot;&gt;恭喜完成！&lt;/p&gt;
                     &lt;div class=&quot;bg-gray-100 dark:bg-gray-800 p-4 rounded-lg mb-4&quot;&gt;
                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;完成時間: ${finalTime}&lt;/p&gt;
                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;錯誤次數: ${wrongAnswersCount}&lt;/p&gt;
                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;總字數: ${totalNonPunctChars}&lt;/p&gt;
                     &lt;/div&gt;
                     ${achievementsHTML}
                     ${buttonsHTML}
                 `;
                 
                 optionsContainer.appendChild(completionMessage);
                 
                 // 定義重置遊戲狀態的函數
                 function resetGameState() {
                     console.log(&quot;重置遊戲狀態&quot;);
                     currentPosition = 0;
                     correctAnswers = 0;
                     lives = 3;
                     successfulChars = 0;
                     wrongAnswersCount = 0;
                     lastAnsweredChars = [];
                     
                     const lastAnsweredCharsElem = document.getElementById(&#39;last-answered-chars&#39;);
                     if (lastAnsweredCharsElem) {
                         lastAnsweredCharsElem.textContent = &#39;&#39;;
                     }
                     
                     canSelect = true;
                     isPaused = false;
                     hasPaused = false;
                     updateLives();
                     
                     if (feedback) {
                         feedback.textContent = &#39;&#39;;
                     }
                     
                     // 更新進度條
                     const progressText = document.getElementById(&#39;progress-text&#39;);
                     const progressBar = document.getElementById(&#39;progress-bar&#39;);
                     
                     if (progressText) {
                         progressText.textContent = `0 / ${totalNonPunctChars}`;
                     }
                     
                     if (progressBar) {
                         progressBar.style.width = &#39;0%&#39;;
                     }
                     
                     // 清空選項容器
                     if (optionsContainer) {
                         optionsContainer.innerHTML = &#39;&#39;;
                         optionsContainer.className = &#39;grid grid-cols-3 gap-3 md:gap-4 mb-4&#39;;
                     }
                 }
                 
                 // 獲取按鈕元素
                 const shareResultBtn = document.getElementById(&#39;share-result-btn&#39;);
                 const restartResultBtn = document.getElementById(&#39;restart-result-btn&#39;);
                 const completionReturnBtn = document.getElementById(&#39;completion-return-btn&#39;);
                 
                 // 立即為按鈕添加點擊事件
                 if (shareResultBtn) {
                     shareResultBtn.onclick = function() {
                         console.log(&quot;分享按鈕被點擊&quot;);
                         
                         // 顯示加載中動畫
                         const loadingOverlay = document.createElement(&#39;div&#39;);
                         loadingOverlay.className = &#39;fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[101]&#39;;
                         loadingOverlay.innerHTML = `
                             &lt;div class=&quot;bg-white dark:bg-gray-800 p-6 rounded-lg flex flex-col items-center&quot;&gt;
                                 &lt;i class=&quot;fas fa-spinner fa-spin text-3xl text-primary mb-3&quot;&gt;&lt;/i&gt;
                                 &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;正在生成分享圖片...&lt;/p&gt;
                             &lt;/div&gt;
                         `;
                         document.body.appendChild(loadingOverlay);
                         
                         // 獲取當前選擇的段落索引
                         const paragraphInfo = window.selectedParagraphIndices || [];
                         
                         // 創建分享卡片
                         createShareCard(
                             selectedPassage.title, 
                             selectedPassage.author, 
                             finalTime, 
                             wrongAnswersCount, 
                             totalNonPunctChars, 
                             achievements,
                             paragraphInfo
                         ).then(imageData =&gt; {
                             document.body.removeChild(loadingOverlay);
                             handleShare(imageData);
                         }).catch(err =&gt; {
                             console.error(&#39;創建分享卡片失敗:&#39;, err);
                             document.body.removeChild(loadingOverlay);
                             alert(&#39;生成分享圖片失敗，請稍後再試。&#39;);
                         });
                     };
                     console.log(&quot;已為分享按鈕設置點擊事件&quot;);
                 }
                 
                 if (restartResultBtn) {
                     restartResultBtn.addEventListener(&#39;click&#39;, async function() {
                         console.log(&quot;重來按鈕被點擊&quot;);
                         
                         try {
                             // 顯示載入動畫
                             await showLoadingAnimation();
                             
                             // 使用全局重置函數
                             resetGameState();
                             
                             // 確保遊戲頁面顯示
                             if (gamePage &amp;&amp; gamePage.classList.contains(&#39;hidden&#39;)) {
                                 gamePage.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important;&#39;;
                                 gamePage.classList.remove(&#39;hidden&#39;);
                             }
                             
                             // 先隱藏遊戲內容，確保切換到開始畫面
                             if (gameContent) {
                                 gameContent.classList.add(&#39;hidden&#39;);
                             }
                             
                             // 確保開始畫面顯示
                             if (gameStartScreen) {
                                 gameStartScreen.classList.remove(&#39;hidden&#39;);
                                 console.log(&quot;成功切換到開始屏幕&quot;);
                             } else {
                                 console.error(&quot;找不到開始屏幕元素&quot;);
                             }
                             
                             // 重置秒表
                             stopStopwatch();
                             elapsedTimeBeforePause = 0;
                             if (timerElement) {
                                 timerElement.textContent = &quot;00:00.0&quot;;
                             }
                             
                             console.log(&quot;遊戲已重置，準備重新開始&quot;);
                         } catch (error) {
                             console.error(&quot;重新開始時出錯:&quot;, error);
                             alert(&quot;重新開始時發生錯誤: &quot; + error.message);
                         }
                     });
                     console.log(&quot;已為重來按鈕設置點擊事件(addEventListener)&quot;);
                 }
                 
                 if (completionReturnBtn) {
                     completionReturnBtn.onclick = function() {
                         console.log(&quot;返回按鈕被點擊&quot;);
                         
                         try {
                             // 重置遊戲狀態
                             resetGameState();
                             
                             // 獲取需要操作的元素
                             const userProfileContainer = document.getElementById(&#39;user-profile-container&#39;);
                             const gamePage = document.getElementById(&#39;game-page&#39;);
                             
                             if (!userProfileContainer || !gamePage) {
                                 console.error(&quot;未找到必要的DOM元素&quot;);
                                 alert(&quot;返回失敗，請重新載入頁面&quot;);
                                 return;
                             }
                             
                             // 隱藏遊戲界面
                             gamePage.style.cssText = &#39;display: none !important; visibility: hidden !important; opacity: 0 !important;&#39;;
                             gamePage.classList.add(&#39;hidden&#39;);
                             gamePage.classList.remove(&#39;block&#39;, &#39;flex&#39;, &#39;visible&#39;, &#39;opacity-100&#39;);
                             
                             // 顯示用戶資料界面
                             userProfileContainer.style.cssText = &#39;display: block !important; visibility: visible !important; opacity: 1 !important;&#39;;
                             userProfileContainer.classList.remove(&#39;hidden&#39;);
                             userProfileContainer.classList.add(&#39;block&#39;);
                             
                             // 確保書本頁面回到初始狀態
                             const bookPage = document.querySelector(&#39;.page&#39;);
                             if (bookPage &amp;&amp; bookPage.classList.contains(&#39;turned&#39;)) {
                                 bookPage.classList.remove(&#39;turned&#39;);
                             }
                             
                             // 滾動到頁面頂部
                             window.scrollTo(0, 0);
                             
                             console.log(&quot;返回主頁成功&quot;);
                         } catch (error) {
                             console.error(&quot;返回按鈕處理發生錯誤:&quot;, error);
                             alert(&quot;返回時發生錯誤，請重新載入頁面&quot;);
                         }
                     };
                     console.log(&quot;已為返回按鈕設置點擊事件&quot;);
                 }
                 
                 // 以防萬一，添加額外的事件代理
                 optionsContainer.addEventListener(&#39;click&#39;, function(event) {
                     const target = event.target;
                     
                     // 檢查是否是按鈕或按鈕內的元素
                     if (target.closest(&#39;#restart-result-btn&#39;)) {
                         console.log(&quot;通過代理偵測到重來按鈕點擊&quot;);
                         const btn = document.getElementById(&#39;restart-result-btn&#39;);
                         if (btn &amp;&amp; typeof btn.onclick === &#39;function&#39;) {
                             btn.onclick();
                         }
                     }
                     
                     if (target.closest(&#39;#completion-return-btn&#39;)) {
                         console.log(&quot;通過代理偵測到返回按鈕點擊&quot;);
                         const btn = document.getElementById(&#39;completion-return-btn&#39;);
                         if (btn &amp;&amp; typeof btn.onclick === &#39;function&#39;) {
                             btn.onclick();
                         }
                     }
                     
                     if (target.closest(&#39;#share-result-btn&#39;)) {
                         console.log(&quot;通過代理偵測到分享按鈕點擊&quot;);
                         const btn = document.getElementById(&#39;share-result-btn&#39;);
                         if (btn &amp;&amp; typeof btn.onclick === &#39;function&#39;) {
                             btn.onclick();
                         }
                     }
                 });
             }
             
             // 创建墨滴效果
             function createInkDrop(element) {
                 if (!element) return;
                 
                 const inkDrop = document.createElement(&#39;div&#39;);
                 inkDrop.className = &#39;ink-drop&#39;;
                 
                 // 计算点击位置
                 const rect = element.getBoundingClientRect();
                 const x = Math.random() * (rect.width - 10);
                 const y = Math.random() * (rect.height - 10);
                 
                 inkDrop.style.left = `${x}px`;
                 inkDrop.style.top = `${y}px`;
                 
                 // 不再設置position和overflow，因為已經在CSS中預設了
                 element.appendChild(inkDrop);
                 
                 // 移除元素
                 setTimeout(() =&gt; {
                     if (inkDrop.parentNode === element) {
                         inkDrop.remove();
                     }
                 }, 2000);
             }
             
             // 辅助函数
             function isPunctuation(char) {
                 // 檢查所有可能的冒號變體和其他標點
                 if (!char) return false;
                 
                 const charCode = char.charCodeAt(0);
                 // 全形冒號(U+FF1A)和半形冒號(U+003A)
                 if (charCode === 0xFF1A || charCode === 0x003A) {
                     return true;
                 }
                 // 檢查其他標點符號
                 return &#39;「」：︰！，。；!?----……『』、？:&#39;.includes(char);
             }
             
             function shuffleArray(array) {
                 const newArray = [...array];
                 for (let i = newArray.length - 1; i &gt; 0; i--) {
                     const j = Math.floor(Math.random() * (i + 1));
                     [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                 }
                 return newArray;
             }
             
             // 初始化設置按鈕及相關功能
             initializeSettings();
             
             // 首先声明全局变量，确保它们在使用之前已完成初始化
             // 用於替代localStorage的內存存儲
             let userRecordsMemory = {};
             
             // 全局成就和統計跟踪
             let globalStats = {
                 totalCompletionCount: 0,      // 總完成次數
                 failAfterHalfwayCount: 0,     // 遊戲過半後失敗次數
                 lightningAchievementCount: 0, // 獲得閃電俠成就次數
                 perfectAchievementCount: 0,   // 獲得完美無瑕成就次數
                 memoryAchievementCount: 0,    // 獲得記憶大師成就次數
                 tirelessAchievementCount: 0,  // 獲得不知疲倦成就次數
                 nightOwlAchievementCount: 0,  // 獲得夜貓成就次數
                 badDigestionAchievementCount: 0, // 獲得腸胃不好成就次數
                 achievements: {
                     // 特殊時間成就
                     nightOwl: false,         // 夜貓（01:00-03:00完成）
                     badDigestion: false,     // 腸胃不好（11:59-12:45完成）
                     
                     // 特殊累積成就
                     dryEyes: false,          // 眼乾（獲得「不知疲倦」30次）
                     nightOwlKing: false,     // 夜貓王（獲得「夜貓」20次）
                     focusOnEating: false,    // 請專心吃飯（獲得「腸胃不好」20次）
                     
                     // 冒險之路成就
                     adventureLevel: 0,       // 0:未獲得 1:初心者 2:勇者 3:大師 4:偏執狂 5:掃地僧
                     
                     // 挫敗之路成就
                     defeatLevel: 0,          // 0:未獲得 1:初嘗敗績 2:堅毅 3:鋼鐵意志 4:小強是我 5:心如止水
                     
                     // 極速之路成就
                     speedRouteLevel: 0,      // 0:未獲得 1:敏捷 2:肌肉記憶 3:無影手 4:世界第一束光
                     
                     // 完美之路成就
                     perfectRouteLevel: 0,     // 0:未獲得 1:如沐春風 2:完美主義 3:滿月 4:至善
                     
                     // 記憶之路成就
                     memoryRouteLevel: 0       // 0:未獲得 1:激活腦細胞 2:記憶麵包 3:移動圖書館 4:流如背倒
                 }
             };
             
             // 用戶資料和經驗值系統
             let userProfile = {
                 name: &quot;文言大師&quot;,
                 level: 1,
                 exp: 0,
                 nextLevelExp: 100
             };
             
             // 計算升級所需經驗值
             function calculateExpForNextLevel(level) {
                 if (level &lt;= 10) return 100;
                 if (level &lt;= 20) return 180;
                 if (level &lt;= 30) return 260;
                 if (level &lt;= 40) return 320;
                 if (level &lt;= 50) return 400;
                 if (level &lt;= 60) return 480;
                 if (level &lt;= 70) return 560;
                 if (level &lt;= 80) return 640;
                 if (level &lt;= 90) return 720;
                 if (level &lt;= 100) return 800;
                 if (level &lt;= 999) return 500;             
                 return Infinity; // 1000級為滿級
             }
             
             // 添加經驗值
             function addExperience(amount) {
                 if (userProfile.level &gt;= 1000) return; // 已達到滿級
                 
                 userProfile.exp += amount;
                 console.log(`添加經驗值: ${amount}, 當前經驗值: ${userProfile.exp}/${userProfile.nextLevelExp}`);
                 
                 // 檢查是否升級
                 while (userProfile.exp &gt;= userProfile.nextLevelExp &amp;&amp; userProfile.level &lt; 1000) {
                     userProfile.level++;
                     userProfile.exp -= userProfile.nextLevelExp;
                     userProfile.nextLevelExp = calculateExpForNextLevel(userProfile.level);
                     
                     console.log(`升級! 新等級: ${userProfile.level}, 下一級所需經驗: ${userProfile.nextLevelExp}`);
                     
                     // 顯示升級提示
                     showLevelUpNotification(userProfile.level);
                 }
                 
                 // 更新經驗值顯示
                 updateExpDisplay();
                 
                 // 保存用戶資料
                 saveUserProfile();
             }
             
             // 顯示升級提示
             function showLevelUpNotification(newLevel) {
                 const notification = document.createElement(&#39;div&#39;);
                 notification.className = &#39;fixed top-1/4 left-1/2 transform -translate-x-1/2 bg-amber-100 dark:bg-amber-800 text-amber-900 dark:text-amber-100 py-3 px-6 rounded-lg shadow-lg z-[9999] flex flex-col items-center&#39;;
                 notification.style.animation = &#39;fadeInOut 3s ease-in-out forwards&#39;;
                 
                 notification.innerHTML = `
                     &lt;div class=&quot;text-2xl font-bold mb-1&quot;&gt;恭喜升級!&lt;/div&gt;
                     &lt;div class=&quot;text-3xl font-bold text-primary&quot;&gt;Lv.${newLevel}&lt;/div&gt;
                 `;
                 
                 document.body.appendChild(notification);
                 
                 // 添加淡入淡出動畫樣式
                 const style = document.createElement(&#39;style&#39;);
                 style.textContent = `
                     @keyframes fadeInOut {
                         0% { opacity: 0; transform: translate(-50%, -20px); }
                         15% { opacity: 1; transform: translate(-50%, 0); }
                         85% { opacity: 1; transform: translate(-50%, 0); }
                         100% { opacity: 0; transform: translate(-50%, -20px); }
                     }
                 `;
                 document.head.appendChild(style);
                 
                 // 檢查是否有新解鎖的頭像
                 checkNewUnlockedAvatars(newLevel);
                 
                 // 刪除通知
                 setTimeout(() =&gt; {
                     notification.remove();
                     style.remove();
                 }, 3000);
             }
             
             // 檢查新解鎖的頭像並顯示通知
             function checkNewUnlockedAvatars(newLevel) {
                 // 獲取所有等級為當前等級的頭像
                 const newUnlockedAvatars = [];
                 
                 Object.keys(window.avatarUnlockLevels).forEach(avatarKey =&gt; {
                     const requiredLevel = window.avatarUnlockLevels[avatarKey];
                     if (requiredLevel &lt;= newLevel) {
                         // 找到此等級解鎖的頭像
                         const avatarData = avatarPixelData[avatarKey];
                         if (avatarData) {
                             newUnlockedAvatars.push({
                                 key: avatarKey,
                                 name: avatarData.name
                             });
                         }
                     }
                 });
                 
                 if (newUnlockedAvatars.length &gt; 0) {
                     // 延遲顯示解鎖通知，讓升級通知先顯示
                     setTimeout(() =&gt; {
                         showAvatarUnlockNotification(newUnlockedAvatars);
                         
                         // 如果頭像選擇器是打開的，則重新生成頭像選項
                         const avatarSelector = document.getElementById(&#39;avatar-selector-modal&#39;);
                         if (avatarSelector &amp;&amp; !avatarSelector.classList.contains(&#39;hidden&#39;)) {
                             const avatarGrid = document.getElementById(&#39;avatar-grid&#39;);
                             if (avatarGrid) {
                                 generateAvatarOptions(avatarGrid);
                             }
                         }
                     }, 1000);
                 }
             }
             
             // 顯示頭像解鎖通知
             function showAvatarUnlockNotification(avatars) {
                 const notification = document.createElement(&#39;div&#39;);
                 notification.className = &#39;fixed top-1/3 left-1/2 transform -translate-x-1/2 bg-blue-100 dark:bg-blue-800 text-blue-900 dark:text-blue-100 py-3 px-6 rounded-lg shadow-lg z-[9999] flex flex-col items-center max-w-sm&#39;;
                 notification.style.animation = &#39;fadeInOut 4s ease-in-out forwards&#39;;
                 
                 // 創建通知內容
                 let avatarsList = &#39;&#39;;
                 avatars.forEach(avatar =&gt; {
                     avatarsList += `&lt;li class=&quot;mb-1&quot;&gt;${avatar.name}&lt;/li&gt;`;
                 });
                 
                 notification.innerHTML = `
                     &lt;div class=&quot;text-xl font-bold mb-2&quot;&gt;新頭像解鎖!&lt;/div&gt;
                     &lt;div class=&quot;text-m mt-2&quot;&gt;刷新頁面後在「頭像」頁面查看！&lt;/div&gt;
                 `;
                 
                 document.body.appendChild(notification);
                 
                 // 刪除通知
                 setTimeout(() =&gt; {
                     notification.remove();
                 }, 4000);
             }
             
             // 更新經驗值顯示
             function updateExpDisplay() {
                 const expBar = document.getElementById(&#39;exp-bar&#39;);
                 const expText = document.getElementById(&#39;exp-text&#39;);
                 const userLevel = document.getElementById(&#39;user-level&#39;);
                 
                 if (expBar &amp;&amp; expText &amp;&amp; userLevel) {
                     const percentage = userProfile.level &gt;= 100 ? 100 : (userProfile.exp / userProfile.nextLevelExp * 100);
                     expBar.style.width = `${percentage}%`;
                     expText.textContent = userProfile.level &gt;= 100 
                         ? &quot;滿級&quot; 
                         : `${userProfile.exp} / ${userProfile.nextLevelExp}`;
                     userLevel.textContent = `Lv.${userProfile.level}`;
                 }
             }
             
             // 從localStorage加載用戶資料
             function loadUserProfile() {
                 try {
                     const savedProfile = localStorage.getItem(&#39;MemoryMaster_userProfile&#39;);
                     if (savedProfile) {
                         userProfile = JSON.parse(savedProfile);
                         console.log(&quot;加載用戶資料:&quot;, userProfile);
                         updateExpDisplay();
                         
                         // 更新顯示的用戶名稱
                         const userNameElement = document.getElementById(&#39;user-name&#39;);
                         if (userNameElement &amp;&amp; userProfile.name) {
                             userNameElement.textContent = userProfile.name;
                         }
                     }
                 } catch (error) {
                     console.error(&quot;加載用戶資料出錯:&quot;, error);
                 }
             }
             
             // 保存用戶資料到localStorage
             function saveUserProfile() {
                 try {
                     localStorage.setItem(&#39;MemoryMaster_userProfile&#39;, JSON.stringify(userProfile));
                     console.log(&quot;保存用戶資料成功&quot;);
                 } catch (error) {
                     console.error(&quot;保存用戶資料出錯:&quot;, error);
                 }
             }
             
             // 用戶名稱編輯功能
             function initializeNameEditor() {
                 const editNameBtn = document.getElementById(&#39;edit-name-btn&#39;);
                 const saveNameBtn = document.getElementById(&#39;save-name-btn&#39;);
                 const cancelNameBtn = document.getElementById(&#39;cancel-name-btn&#39;);
                 const nameDisplayMode = document.getElementById(&#39;name-display-mode&#39;);
                 const nameEditMode = document.getElementById(&#39;name-edit-mode&#39;);
                 const userNameElement = document.getElementById(&#39;user-name&#39;);
                 const userNameInput = document.getElementById(&#39;user-name-input&#39;);
                 const charCounter = document.getElementById(&#39;char-counter&#39;);
                 
                 // 檢查必要元素是否存在
                 if (!editNameBtn || !saveNameBtn || !cancelNameBtn || !nameDisplayMode || !nameEditMode || !userNameElement || !userNameInput || !charCounter) {
                     console.error(&quot;用戶名稱編輯器初始化失敗：缺少必要元素&quot;);
                     return;
                 }
                 
                 // 更新字符計數器
                 function updateCharCounter() {
                     const currentLength = userNameInput.value.length;
                     const maxLength = userNameInput.maxLength;
                     charCounter.textContent = `${currentLength}/${maxLength}`;
                     
                     // 當接近字符上限時改變計數器顏色
                     if (currentLength &gt;= maxLength) {
                         charCounter.classList.add(&#39;text-red-500&#39;);
                         charCounter.classList.remove(&#39;text-gray-500&#39;, &#39;text-amber-500&#39;);
                     } else if (currentLength &gt;= maxLength * 0.75) {
                         charCounter.classList.add(&#39;text-amber-500&#39;);
                         charCounter.classList.remove(&#39;text-gray-500&#39;, &#39;text-red-500&#39;);
                     } else {
                         charCounter.classList.add(&#39;text-gray-500&#39;);
                         charCounter.classList.remove(&#39;text-amber-500&#39;, &#39;text-red-500&#39;);
                     }
                 }
                 
                 // 編輯按鈕點擊事件
                 editNameBtn.addEventListener(&#39;click&#39;, function() {
                     // 將目前的用戶名填入輸入框
                     userNameInput.value = userNameElement.textContent;
                     
                     // 更新字符計數
                     updateCharCounter();
                     
                     // 切換到編輯模式
                     nameDisplayMode.classList.add(&#39;hidden&#39;);
                     nameEditMode.classList.remove(&#39;hidden&#39;);
                     
                     // 自動聚焦輸入框
                     userNameInput.focus();
                 });
                 
                 // 輸入時更新字符計數
                 userNameInput.addEventListener(&#39;input&#39;, updateCharCounter);
                 
                 // 保存按鈕點擊事件
                 saveNameBtn.addEventListener(&#39;click&#39;, function() {
                     // 獲取輸入的新名稱
                     const newName = userNameInput.value.trim();
                     
                     // 名稱不能為空
                     if (newName === &#39;&#39;) {
                         alert(&#39;用戶名稱不能為空&#39;);
                         return;
                     }
                     
                     // 更新用戶名稱
                     userNameElement.textContent = newName;
                     
                     // 更新用戶資料
                     userProfile.name = newName;
                     
                     // 保存到localStorage
                     saveUserProfile();
                     
                     // 切換回顯示模式
                     nameEditMode.classList.add(&#39;hidden&#39;);
                     nameDisplayMode.classList.remove(&#39;hidden&#39;);
                     
                     // 顯示成功提示
                     const notification = document.createElement(&#39;div&#39;);
                     notification.className = &#39;fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-green-100 text-green-800 py-2 px-4 rounded-lg shadow-lg z-50&#39;;
                     notification.innerHTML = &#39;&lt;i class=&quot;fas fa-check-circle mr-2&quot;&gt;&lt;/i&gt;用戶名稱已保存&#39;;
                     document.body.appendChild(notification);
                     
                     // 3秒後移除提示
                     setTimeout(() =&gt; {
                         notification.remove();
                     }, 3000);
                 });
                 
                 // 取消按鈕點擊事件
                 cancelNameBtn.addEventListener(&#39;click&#39;, function() {
                     // 不做任何更改，切換回顯示模式
                     nameEditMode.classList.add(&#39;hidden&#39;);
                     nameDisplayMode.classList.remove(&#39;hidden&#39;);
                 });
                 
                 // 支持按Enter鍵保存
                 userNameInput.addEventListener(&#39;keydown&#39;, function(event) {
                     if (event.key === &#39;Enter&#39;) {
                         saveNameBtn.click();
                     } else if (event.key === &#39;Escape&#39;) {
                         cancelNameBtn.click();
                     }
                 });
                 
                 console.log(&quot;用戶名稱編輯器初始化完成&quot;);
             }
             
             // 初始化本地存儲功能 - 用於記錄用戶成績
             initializeLocalStorage();
             
             // 加載用戶資料
             loadUserProfile();
             
             // 在遊戲初始化時設置按鈕狀態為「未開始」
             updateGameControlButtons(&#39;not-started&#39;);
             
             // 設置功能初始化
             function initializeSettings() {
                 const settingsButton = document.getElementById(&#39;settings-button&#39;);
                 const settingsMenu = document.getElementById(&#39;settings-menu&#39;);
                 const closeSettings = document.getElementById(&#39;close-settings&#39;);
                 const settingsOptions = document.querySelectorAll(&#39;.settings-option&#39;);
                 const infoModal = document.getElementById(&#39;info-modal&#39;);
                 const closeInfoModal = document.getElementById(&#39;close-info-modal&#39;);
                 const infoModalTitle = document.getElementById(&#39;info-modal-title&#39;);
                 const infoModalContent = document.getElementById(&#39;info-modal-content&#39;);
                 
                 if (!settingsButton || !settingsMenu || !closeSettings || !infoModal || !closeInfoModal || !infoModalTitle || !infoModalContent) {
                     console.error(&#39;設置相關元素未找到&#39;);
                     return;
                 }
                 
                 // 添加設置按鈕狀態控制功能 - 設為全局函數以便在其他地方調用
                 window.disableSettingsButton = function() {
                     settingsButton.classList.add(&#39;disabled&#39;);
                     settingsButton.style.opacity = &#39;0.5&#39;;
                     settingsButton.style.cursor = &#39;not-allowed&#39;;
                     settingsButton.style.pointerEvents = &#39;none&#39;; // 阻止所有點擊
                 }
                 
                 window.enableSettingsButton = function() {
                     settingsButton.classList.remove(&#39;disabled&#39;);
                     settingsButton.style.opacity = &#39;1&#39;;
                     settingsButton.style.cursor = &#39;pointer&#39;;
                     settingsButton.style.pointerEvents = &#39;auto&#39;;
                 }
                 
                 // 打開設置菜單
                 settingsButton.addEventListener(&#39;click&#39;, function() {
                     settingsMenu.classList.remove(&#39;hidden&#39;);
                     // 禁用設置按鈕直到關閉菜單
                     disableSettingsButton();
                 });
                 
                 // 關閉設置菜單並重新啟用設置按鈕
                 closeSettings.addEventListener(&#39;click&#39;, function() {
                     settingsMenu.classList.add(&#39;hidden&#39;);
                     enableSettingsButton();
                 });
                 
                 // 點擊背景關閉設置菜單並重新啟用設置按鈕
                 settingsMenu.addEventListener(&#39;click&#39;, function(e) {
                     if (e.target === settingsMenu) {
                         settingsMenu.classList.add(&#39;hidden&#39;);
                         enableSettingsButton();
                     }
                 });
                 
                 // 關閉信息模態框時重新啟用設置按鈕
                 closeInfoModal.addEventListener(&#39;click&#39;, function() {
                     infoModal.classList.add(&#39;hidden&#39;);
                     enableSettingsButton();
                 });
                 
                 // 點擊背景關閉信息模態框時重新啟用設置按鈕
                 infoModal.addEventListener(&#39;click&#39;, function(e) {
                     if (e.target === infoModal) {
                         infoModal.classList.add(&#39;hidden&#39;);
                         enableSettingsButton();
                     }
                 });
                 
                 // 設置選項點擊事件 - 修正版本，附帶調試輸出
                 settingsOptions.forEach(option =&gt; {
                     option.addEventListener(&#39;click&#39;, function() {
                         const section = this.dataset.section;
                         console.log(`點擊了設置選項: ${section}`);
                         
                         try {
                             // 關閉設置菜單
                             settingsMenu.classList.add(&#39;hidden&#39;);
                             
                             // 確保模態框元素及其內容區域可用
                             if (!infoModal || !infoModalTitle || !infoModalContent) {
                                 console.error(&quot;模態框元素未找到:&quot;, {
                                     infoModal: !!infoModal,
                                     infoModalTitle: !!infoModalTitle,
                                     infoModalContent: !!infoModalContent
                                 });
                                 alert(&quot;系統錯誤：無法顯示信息視窗&quot;);
                                 return;
                             }
                             
                             // 根據選項顯示不同內容
                             if (section === &#39;help&#39;) {
                                 // 遊玩說明 - 顯示遊玩說明內容
                                 infoModalTitle.textContent = &#39;遊玩說明&#39;;
                                 infoModalContent.innerHTML = `
                                     &lt;div class=&quot;space-y-4&quot;&gt;
                                         &lt;ol class=&quot;list-decimal pl-5 space-y-1&quot;&gt;
                                             &lt;li&gt;&lt;strong&gt;螢幕將顯示文章背誦進度；&lt;/strong&gt;&lt;/li&gt;
                                             &lt;li&gt;&lt;strong&gt;從三個選項中選擇正確答案；&lt;/strong&gt;&lt;/li&gt;
                                             &lt;li&gt;&lt;strong&gt;初始擁有3點生命值，每次錯誤扣除1點；&lt;/strong&gt;&lt;/li&gt;
                                             &lt;li&gt;&lt;strong&gt;每完成50個字恢復1點生命值（最多3點）；&lt;/strong&gt;&lt;/li&gt;
                                             &lt;li&gt;&lt;strong&gt;以最快的時間完成挑戰，爭取獲得成就！&lt;/strong&gt;&lt;/li&gt;
                                         &lt;/ol&gt;
                                         &lt;div class=&quot;mt-4 p-3 bg-amber-50 dark:bg-amber-900/30 rounded-lg&quot;&gt;
                                             &lt;p class=&quot;text-amber-800 dark:text-amber-400 font-medium&quot;&gt;成就系統：&lt;/p&gt;
                                             &lt;ul class=&quot;list-disc pl-5 mt-2 text-gray-700 dark:text-gray-300&quot;&gt;
                                                 &lt;li&gt;&lt;strong&gt;完美無瑕&lt;/strong&gt;&lt;/li&gt;
                                                 &lt;li&gt;&lt;strong&gt;閃電俠&lt;/strong&gt;&lt;/li&gt;
                                                 &lt;li&gt;&lt;strong&gt;記憶大師&lt;/strong&gt;&lt;/li&gt;
                                                 &lt;li&gt;&lt;strong&gt;不知疲倦&lt;/strong&gt;&lt;/li&gt;
                                                 &lt;li&gt;&lt;strong&gt;更多隱藏成就！&lt;/strong&gt;&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
                                         &lt;p class=&quot;mt-2&quot;&gt;更多功能，敬請期待！&lt;/p&gt;
                                     &lt;/div&gt;
                                 `;
                                 infoModal.classList.remove(&#39;hidden&#39;);
                                 console.log(&quot;已顯示遊玩說明&quot;);
                                 
                             } else if (section === &#39;records&#39;) {
                                 try {
                                     // 我的記錄 - 顯示用戶的記錄
                                     infoModalTitle.textContent = &#39;我的記錄（只計算完整篇章）&#39;;
                                     
                                     // 檢查userRecordsMemory是否已初始化
                                     if (typeof userRecordsMemory !== &#39;object&#39; || userRecordsMemory === null) {
                                         userRecordsMemory = {};
                                         console.log(&quot;在點擊處理函數中初始化userRecordsMemory&quot;);
                                     }
                                     
                                     // 檢查displayUserRecords函數是否存在
                                     if (typeof displayUserRecords !== &#39;function&#39;) {
                                         console.error(&quot;displayUserRecords函數未定義&quot;);
                                         infoModalContent.innerHTML = `
                                             &lt;div class=&quot;text-center p-4&quot;&gt;
                                                 &lt;i class=&quot;fas fa-exclamation-triangle text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                                 &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;系統錯誤：無法顯示記錄功能&lt;/p&gt;
                                             &lt;/div&gt;
                                         `;
                                     } else {
                                         // 先顯示加載訊息
                                         infoModalContent.innerHTML = `
                                             &lt;div class=&quot;text-center p-4&quot;&gt;
                                                 &lt;i class=&quot;fas fa-spinner fa-spin text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                                 &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;載入記錄中...&lt;/p&gt;
                                             &lt;/div&gt;
                                         `;
                                         
                                         // 確保模態框先顯示
                                         infoModal.classList.remove(&#39;hidden&#39;);
                                         
                                         // 使用setTimeout讓UI先更新，再調用顯示記錄函數
                                         setTimeout(() =&gt; {
                                             try {
                                                 displayUserRecords();
                                                 console.log(&quot;已顯示用戶記錄&quot;);
                                             } catch (err) {
                                                 console.error(&quot;顯示記錄時發生錯誤:&quot;, err);
                                                 infoModalContent.innerHTML = `
                                                     &lt;div class=&quot;text-center p-4&quot;&gt;
                                                         &lt;i class=&quot;fas fa-exclamation-triangle text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;載入記錄時發生錯誤&lt;/p&gt;
                                                         &lt;p class=&quot;text-gray-500 dark:text-gray-400 text-sm mt-2&quot;&gt;${err.message}&lt;/p&gt;
                                                     &lt;/div&gt;
                                                 `;
                                             }
                                         }, 50);
                                     }
                                 } catch (err) {
                                     console.error(&quot;處理記錄選項時發生錯誤:&quot;, err);
                                     infoModalContent.innerHTML = `
                                         &lt;div class=&quot;text-center p-4&quot;&gt;
                                             &lt;i class=&quot;fas fa-exclamation-triangle text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                             &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;處理記錄時發生錯誤&lt;/p&gt;
                                             &lt;p class=&quot;text-gray-500 dark:text-gray-400 text-sm mt-2&quot;&gt;${err.message}&lt;/p&gt;
                                         &lt;/div&gt;
                                     `;
                                     infoModal.classList.remove(&#39;hidden&#39;);
                                 }
                                 
                             } else if (section === &#39;saveload&#39;) {
                                 // 保存及載入進度 - 顯示保存及載入進度界面
                                 infoModalTitle.textContent = &#39;保存及載入進度&#39;;
                                 infoModalContent.innerHTML = `
                                     &lt;div class=&quot;space-y-6&quot;&gt;
                                         &lt;div class=&quot;bg-gray-50 dark:bg-gray-700/50 rounded-lg p-5&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-amber-700 dark:text-amber-400 mb-3&quot;&gt;保存進度&lt;/h4&gt;
                                             &lt;p class=&quot;text-gray-700 dark:text-gray-300 mb-4&quot;&gt;點擊下方按鈕獲取當前進度代碼。保存此代碼以便日後載入進度。&lt;/p&gt;
                                             &lt;div class=&quot;text-center&quot;&gt;
                                                 &lt;button id=&quot;generate-save-code-btn&quot; class=&quot;px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90&quot;&gt;
                                                     &lt;i class=&quot;fas fa-save mr-2&quot;&gt;&lt;/i&gt;生成進度代碼
                                                 &lt;/button&gt;
                                             &lt;/div&gt;
                                             &lt;div id=&quot;save-code-container&quot; class=&quot;mt-4 hidden&quot;&gt;
                                                 &lt;p class=&quot;text-gray-600 dark:text-gray-400 text-sm mb-2&quot;&gt;您的進度代碼（請保存此代碼）：&lt;/p&gt;
                                                 &lt;div class=&quot;relative&quot;&gt;
                                                     &lt;textarea id=&quot;save-code&quot; class=&quot;w-full h-24 p-3 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-800 dark:text-gray-200 text-sm font-mono&quot; readonly&gt;&lt;/textarea&gt;
                                                     &lt;button id=&quot;copy-save-code-btn&quot; class=&quot;absolute top-2 right-2 p-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-lg text-gray-700 dark:text-gray-300&quot;&gt;
                                                         &lt;i class=&quot;fas fa-copy&quot;&gt;&lt;/i&gt;
                                                     &lt;/button&gt;
                                                 &lt;/div&gt;
                                             &lt;/div&gt;
                                         &lt;/div&gt;
                                         
                                         &lt;div class=&quot;bg-gray-50 dark:bg-gray-700/50 rounded-lg p-5&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-amber-700 dark:text-amber-400 mb-3&quot;&gt;載入進度&lt;/h4&gt;
                                             &lt;p class=&quot;text-gray-700 dark:text-gray-300 mb-4&quot;&gt;將保存的進度代碼粘貼到下方輸入框，然後點擊載入按鈕。&lt;/p&gt;
                                             &lt;textarea id=&quot;load-code-input&quot; class=&quot;w-full h-24 p-3 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-800 dark:text-gray-200 text-sm font-mono&quot; placeholder=&quot;在此處粘貼您的進度代碼...&quot;&gt;&lt;/textarea&gt;
                                             &lt;div class=&quot;text-center mt-4&quot;&gt;
                                                 &lt;button id=&quot;load-save-code-btn&quot; class=&quot;px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90&quot;&gt;
                                                     &lt;i class=&quot;fas fa-upload mr-2&quot;&gt;&lt;/i&gt;載入進度
                                                 &lt;/button&gt;
                                             &lt;/div&gt;
                                         &lt;/div&gt;
                                         
                                         &lt;div class=&quot;p-4 bg-amber-50 dark:bg-amber-900/30 rounded-lg&quot;&gt;
                                             &lt;p class=&quot;text-amber-800 dark:text-amber-400 font-medium&quot;&gt;提示&lt;/p&gt;
                                             &lt;ul class=&quot;list-disc pl-5 mt-2 text-gray-700 dark:text-gray-300 text-sm space-y-1&quot;&gt;
                                                 &lt;li&gt;進度代碼包含您的用戶資料和歷史成就&lt;/li&gt;
                                                 &lt;li&gt;載入新進度將覆蓋當前進度，請謹慎操作&lt;/li&gt;
                                                 &lt;li&gt;建議定期保存進度，避免資料丟失&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
                                     &lt;/div&gt;
                                 `;
                                 
                                 // 確保模態框先顯示
                                 infoModal.classList.remove(&#39;hidden&#39;);
                                 
                                 // 使用setTimeout讓UI先更新，再添加事件監聽器
                                 setTimeout(() =&gt; {
                                     // 生成進度代碼按鈕點擊事件
                                     const generateSaveCodeBtn = document.getElementById(&#39;generate-save-code-btn&#39;);
                                     const saveCodeContainer = document.getElementById(&#39;save-code-container&#39;);
                                     const saveCodeTextarea = document.getElementById(&#39;save-code&#39;);
                                     const copySaveCodeBtn = document.getElementById(&#39;copy-save-code-btn&#39;);
                                     
                                     if (generateSaveCodeBtn &amp;&amp; saveCodeContainer &amp;&amp; saveCodeTextarea) {
                                         generateSaveCodeBtn.addEventListener(&#39;click&#39;, function() {
                                             try {
                                                 // 收集需要保存的數據
                                                 const saveData = {
                                                     userProfile: userProfile,
                                                     userRecordsMemory: userRecordsMemory,
                                                     globalStats: globalStats,
                                                     userAvatar: userSelectedAvatar,
                                                     selectedAchievements: []
                                                 };
                                                 
                                                 // 嘗試從localStorage獲取已選擇的成就
                                                 try {
                                                     const saved = localStorage.getItem(&#39;MemoryMaster_selectedAchievements&#39;);
                                                     if (saved) {
                                                         saveData.selectedAchievements = JSON.parse(saved);
                                                     }
                                                 } catch (e) {
                                                     console.error(&quot;讀取選擇的成就出錯:&quot;, e);
                                                 }
                                                 
                                                 // 將數據轉換為JSON字符串
                                                 const jsonData = JSON.stringify(saveData);
                                                 
                                                 // 簡單加密數據（僅為混淆，非真正加密）
                                                 const encodedData = btoa(jsonData);
                                                 
                                                 // 生成隨機字符前綴和後綴，增加代碼複雜度
                                                 const prefix = Math.random().toString(36).substring(2, 8);
                                                 const suffix = Math.random().toString(36).substring(2, 8);
                                                 
                                                 // 組合最終代碼
                                                 const finalCode = `WY-${prefix}-${encodedData}-${suffix}`;
                                                 
                                                 // 顯示代碼
                                                 saveCodeTextarea.value = finalCode;
                                                 saveCodeContainer.classList.remove(&#39;hidden&#39;);
                                                 
                                                 // 顯示成功提示
                                                 const notification = document.createElement(&#39;div&#39;);
                                                 notification.className = &#39;fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-green-100 text-green-800 py-2 px-4 rounded-lg shadow-lg z-50&#39;;
                                                 notification.innerHTML = &#39;&lt;i class=&quot;fas fa-check-circle mr-2&quot;&gt;&lt;/i&gt;進度代碼已生成&#39;;
                                                 document.body.appendChild(notification);
                                                 
                                                 // 3秒後移除提示
                                                 setTimeout(() =&gt; {
                                                     notification.remove();
                                                 }, 3000);
                                                 
                                             } catch (error) {
                                                 console.error(&quot;生成進度代碼時出錯:&quot;, error);
                                                 alert(&quot;生成進度代碼失敗: &quot; + error.message);
                                             }
                                         });
                                     }
                                     
                                     // 複製進度代碼按鈕點擊事件
                                     if (copySaveCodeBtn &amp;&amp; saveCodeTextarea) {
                                         copySaveCodeBtn.addEventListener(&#39;click&#39;, function() {
                                             // 選中文本
                                             saveCodeTextarea.select();
                                             saveCodeTextarea.setSelectionRange(0, 99999); // 對於移動設備
                                             
                                             try {
                                                 // 複製到剪貼板
                                                 const successful = document.execCommand(&#39;copy&#39;);
                                                 
                                                 // 顯示成功提示
                                                 const notification = document.createElement(&#39;div&#39;);
                                                 notification.className = &#39;fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-green-100 text-green-800 py-2 px-4 rounded-lg shadow-lg z-50&#39;;
                                                 notification.innerHTML = &#39;&lt;i class=&quot;fas fa-check-circle mr-2&quot;&gt;&lt;/i&gt;進度代碼已複製到剪貼板&#39;;
                                                 document.body.appendChild(notification);
                                                 
                                                 // 3秒後移除提示
                                                 setTimeout(() =&gt; {
                                                     notification.remove();
                                                 }, 3000);
                                             } catch (err) {
                                                 console.error(&quot;複製文本時出錯:&quot;, err);
                                                 alert(&quot;複製失敗: &quot; + err.message);
                                             }
                                         });
                                     }
                                     
                                     // 載入進度代碼按鈕點擊事件
                                     const loadSaveCodeBtn = document.getElementById(&#39;load-save-code-btn&#39;);
                                     const loadCodeInput = document.getElementById(&#39;load-code-input&#39;);
                                     
                                     if (loadSaveCodeBtn &amp;&amp; loadCodeInput) {
                                         loadSaveCodeBtn.addEventListener(&#39;click&#39;, function() {
                                             try {
                                                 const inputCode = loadCodeInput.value.trim();
                                                 
                                                 if (!inputCode) {
                                                     alert(&quot;請輸入進度代碼&quot;);
                                                     return;
                                                 }
                                                 
                                                 // 驗證代碼格式
                                                 if (!inputCode.startsWith(&#39;WY-&#39;) || inputCode.split(&#39;-&#39;).length &lt; 4) {
                                                     alert(&quot;無效的進度代碼格式&quot;);
                                                     return;
                                                 }
                                                 
                                                 // 確認用戶是否確實要加載進度
                                                 if (!confirm(&quot;載入進度將覆蓋當前所有數據，確定要繼續嗎？&quot;)) {
                                                     return;
                                                 }
                                                 
                                                 // 提取編碼部分
                                                 const parts = inputCode.split(&#39;-&#39;);
                                                 const encodedData = parts.slice(2, -1).join(&#39;-&#39;);
                                                 
                                                 // 解碼數據
                                                 const jsonData = atob(encodedData);
                                                 
                                                 // 解析JSON
                                                 const saveData = JSON.parse(jsonData);
                                                 
                                                 // 應用數據
                                                 if (saveData.userProfile) {
                                                     userProfile = saveData.userProfile;
                                                     // 更新UI顯示
                                                     const userNameElement = document.getElementById(&#39;user-name&#39;);
                                                     if (userNameElement &amp;&amp; userProfile.name) {
                                                         userNameElement.textContent = userProfile.name;
                                                     }
                                                     
                                                     // 更新經驗值和等級顯示
                                                     updateExpDisplay();
                                                 }
                                                 
                                                 if (saveData.userRecordsMemory) {
                                                     userRecordsMemory = saveData.userRecordsMemory;
                                                 }
                                                 
                                                 if (saveData.globalStats) {
                                                     globalStats = saveData.globalStats;
                                                 }
                                                 
                                                 if (saveData.userAvatar !== undefined) {
                                                     userSelectedAvatar = saveData.userAvatar;
                                                     // 更新頭像顯示
                                                     const userAvatarElement = document.getElementById(&#39;user-avatar&#39;);
                                                     if (userAvatarElement) {
                                                         renderUserAvatar(userAvatarElement, userSelectedAvatar);
                                                     }
                                                 }
                                                 
                                                 if (saveData.selectedAchievements) {
                                                     // 更新成就展示
                                                     updateAchievementsDisplay(saveData.selectedAchievements);
                                                 }
                                                 
                                                 // 保存到localStorage
                                                 try {
                                                     localStorage.setItem(&#39;MemoryMaster_userProfile&#39;, JSON.stringify(userProfile));
                                                     localStorage.setItem(&#39;MemoryMaster_userRecords&#39;, JSON.stringify(userRecordsMemory));
                                                     localStorage.setItem(&#39;MemoryMaster_globalStats&#39;, JSON.stringify(globalStats));
                                                     
                                                     if (userSelectedAvatar === null) {
                                                         localStorage.removeItem(&#39;MemoryMaster_userAvatar&#39;);
                                                     } else {
                                                         localStorage.setItem(&#39;MemoryMaster_userAvatar&#39;, userSelectedAvatar);
                                                     }
                                                     
                                                     localStorage.setItem(&#39;MemoryMaster_selectedAchievements&#39;, JSON.stringify(saveData.selectedAchievements || []));
                                                 } catch (e) {
                                                     console.error(&quot;保存數據到localStorage時出錯:&quot;, e);
                                                 }
                                                 
                                                 // 顯示成功提示
                                                 const notification = document.createElement(&#39;div&#39;);
                                                 notification.className = &#39;fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-green-100 text-green-800 py-2 px-4 rounded-lg shadow-lg z-50&#39;;
                                                 notification.innerHTML = &#39;&lt;i class=&quot;fas fa-check-circle mr-2&quot;&gt;&lt;/i&gt;進度已成功載入&#39;;
                                                 document.body.appendChild(notification);
                                                 
                                                 // 3秒後移除提示
                                                 setTimeout(() =&gt; {
                                                     notification.remove();
                                                 }, 3000);
                                                 
                                                 // 關閉模態框
                                                 infoModal.classList.add(&#39;hidden&#39;);
                                                 
                                                 // 在載入進度後，稍微延遲刷新頁面
                                                 setTimeout(() =&gt; {
                                                     window.location.reload();
                                                 }, 2000);
                                                 
                                             } catch (error) {
                                                 console.error(&quot;載入進度代碼時出錯:&quot;, error);
                                                 alert(&quot;載入進度失敗: &quot; + error.message);
                                             }
                                         });
                                     }
                                 }, 100);
                                 
                             } else if (section === &#39;version&#39;) {
                                 // 版本資訊 - 顯示版本更新內容
                                 infoModalTitle.textContent = &#39;版本資訊（只顯示主要更新）&#39;;
                                 infoModalContent.innerHTML = `
                                     &lt;div class=&quot;space-y-4&quot;&gt;
         
                                         &lt;div class=&quot;p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-primary mb-3&quot;&gt;v1.4 更新資訊&lt;/h4&gt;
                                             &lt;ul class=&quot;list-disc pl-4 text-gray-700 dark:text-gray-300 space-y-2&quot;&gt;
                                                 &lt;li&gt;新增頭像&lt;/li&gt;
                                                 &lt;li&gt;減少升級所需經驗，調整部分成就條件&lt;/li&gt;
                                                 &lt;li&gt;完善成就設計及展示功能&lt;/li&gt;
                                                 &lt;li&gt;添加更多篇章&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
                                         
                                         &lt;div class=&quot;p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-primary mb-3&quot;&gt;v1.3 更新資訊&lt;/h4&gt;
                                             &lt;ul class=&quot;list-disc pl-4 text-gray-700 dark:text-gray-300 space-y-2&quot;&gt;
                                                 &lt;li&gt;添加本地儲存功能，儲存用戶資料和成就&lt;/li&gt;
                                                 &lt;li&gt;記錄功能改進：只在完成全文時才計入記錄&lt;/li&gt;
                                                 &lt;li&gt;修復已知問題，提升遊戲穩定性&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
         
                                         &lt;div class=&quot;p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-primary mb-3&quot;&gt;v1.2 更新資訊&lt;/h4&gt;
                                             &lt;ul class=&quot;list-disc pl-5 text-gray-700 dark:text-gray-300 space-y-2&quot;&gt;
                                                 &lt;li&gt;新增設置中心，包含遊玩說明、記錄和成就查詢、版本資訊等&lt;/li&gt;
                                                 &lt;li&gt;新增用戶記錄功能，可查看各篇章通關次數和最佳成績&lt;/li&gt;
                                                 &lt;li&gt;新增若干成就&lt;/li&gt;
                                                 &lt;li&gt;改善遊戲介面，提升視覺效果和用戶體驗&lt;/li&gt;
                                                 &lt;li&gt;修復已知問題，提升遊戲穩定性&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
                                         
                                         &lt;div class=&quot;p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-primary mb-3&quot;&gt;v1.1 更新資訊&lt;/h4&gt;
                                             &lt;ul class=&quot;list-disc pl-5 text-gray-700 dark:text-gray-300 space-y-2&quot;&gt;
                                                 &lt;li&gt;新增暫停功能&lt;/li&gt;
                                                 &lt;li&gt;新增多種成就獎勵&lt;/li&gt;
                                                 &lt;li&gt;改善選擇篇章界面&lt;/li&gt;
                                                 &lt;li&gt;新增生命恢復機制&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
                                         
                                         &lt;div class=&quot;p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg&quot;&gt;
                                             &lt;h4 class=&quot;text-lg font-medium text-primary mb-3&quot;&gt;v1.0 初始版本&lt;/h4&gt;
                                             &lt;ul class=&quot;list-disc pl-5 text-gray-700 dark:text-gray-300 space-y-2&quot;&gt;
                                                 &lt;li&gt;基礎遊戲功能上線&lt;/li&gt;
                                                 &lt;li&gt;支持多篇文言文背誦&lt;/li&gt;
                                                 &lt;li&gt;支持分段練習&lt;/li&gt;
                                             &lt;/ul&gt;
                                         &lt;/div&gt;
                                         
                                     &lt;/div&gt;
                                 `;
                                 infoModal.classList.remove(&#39;hidden&#39;);
                                 console.log(&quot;已顯示版本資訊&quot;);
                                 
                             } else if (section === &#39;achievements&#39;) {
                                 // 顯示歷史成就
                                 infoModalTitle.textContent = &#39;歷史成就&#39;;
                                 
                                 // 確保顯示成就函數已定義
                                 if (typeof displayAchievements !== &#39;function&#39;) {
                                     console.error(&quot;displayAchievements函數未定義&quot;);
                                     infoModalContent.innerHTML = `
                                         &lt;div class=&quot;text-center p-4&quot;&gt;
                                             &lt;i class=&quot;fas fa-exclamation-triangle text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                             &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;系統錯誤：無法顯示成就功能&lt;/p&gt;
                                         &lt;/div&gt;
                                     `;
                                 } else {
                                     // 先顯示加載訊息
                                     infoModalContent.innerHTML = `
                                         &lt;div class=&quot;text-center p-4&quot;&gt;
                                             &lt;i class=&quot;fas fa-spinner fa-spin text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                             &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;載入成就中...&lt;/p&gt;
                                         &lt;/div&gt;
                                     `;
                                     
                                     // 確保模態框先顯示
                                     infoModal.classList.remove(&#39;hidden&#39;);
                                     
                                     // 使用setTimeout讓UI先更新，再調用顯示成就函數
                                     setTimeout(() =&gt; {
                                         try {
                                             displayAchievements();
                                             console.log(&quot;已顯示歷史成就&quot;);
                                         } catch (err) {
                                             console.error(&quot;顯示成就時發生錯誤:&quot;, err);
                                             infoModalContent.innerHTML = `
                                                 &lt;div class=&quot;text-center p-4&quot;&gt;
                                                     &lt;i class=&quot;fas fa-exclamation-triangle text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                                                     &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;載入成就時發生錯誤&lt;/p&gt;
                                                     &lt;p class=&quot;text-gray-500 dark:text-gray-400 text-sm mt-2&quot;&gt;${err.message}&lt;/p&gt;
                                                 &lt;/div&gt;
                                             `;
                                         }
                                     }, 50);
                                 }
                             } else if (section === &#39;about&#39;) {
                                 // 關於製作者 - 顯示製作者相關信息
                                 infoModalTitle.textContent = &#39;關於製作者&#39;;
                                 infoModalContent.innerHTML = `
                                     &lt;div class=&quot;space-y-4&quot;&gt;
                                         &lt;div class=&quot;flex flex-col items-center mb-4&quot;&gt;
                                             &lt;div class=&quot;w-20 h-20 bg-amber-100 dark:bg-amber-800 rounded-full flex items-center justify-center text-2xl text-amber-800 dark:text-amber-100 mb-2&quot;&gt;
                                                 &lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt;
                                             &lt;/div&gt;
                                             &lt;h3 class=&quot;text-lg font-medium&quot;&gt;IG：@dse.chinese.meme&lt;/h3&gt;
                                             &lt;p class=&quot;text-gray-500 dark:text-gray-400 text-sm&quot;&gt;瀝源邨校 中文科老師&lt;/p&gt;
                                         &lt;/div&gt;
                                         
                                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;
                                             最近沉迷用POE製作教學工具。早前跟同事展示文言文翻譯bot時，有同事提了一句：「我們是不是讓學習文言文變得枯燥了？」我驀然想起《範文爭霸戰》，一款我中學時風靡一時，卻不知何時消失於歷史的遊戲。於是，我用相同的概念做了《文言大師之旅》。
                                         &lt;/p&gt;
                                         
                                         &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;
                                             知之者不如好之者，好之者不如樂之者。我想，如果熱愛一件事，總能把它做好的。
                                         &lt;/p&gt;
                                         
                                         &lt;div class=&quot;mt-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg&quot;&gt;
                                             &lt;p class=&quot;text-gray-600 dark:text-gray-400 text-sm text-center&quot;&gt;
                                                 沒什麼事情是做不到的，除了數學。
                                             &lt;/p&gt;
                                         &lt;/div&gt;
                                     &lt;/div&gt;
                                 `;
                                 infoModal.classList.remove(&#39;hidden&#39;);
                                 console.log(&quot;已顯示關於製作者&quot;);
                             }
                         } catch (err) {
                             console.error(&quot;設置選項點擊處理發生錯誤:&quot;, err);
                             alert(&quot;發生錯誤，請檢查控制台以獲取詳細信息&quot;);
                         }
                     });
                 });
             }
             
             // 初始化本地存儲功能
             function initializeLocalStorage() {
                 console.log(&quot;初始化本地存儲功能...&quot;);
                 
                 // 首先檢查瀏覽器是否支持localStorage
                 try {
                     // 進行測試寫入和讀取以確認localStorage可用性
                     localStorage.setItem(&#39;test&#39;, &#39;test&#39;);
                     if (localStorage.getItem(&#39;test&#39;) !== &#39;test&#39;) {
                         throw new Error(&quot;localStorage讀寫測試失敗&quot;);
                     }
                     localStorage.removeItem(&#39;test&#39;);
                     console.log(&quot;localStorage可用性測試通過&quot;);
                 } catch (e) {
                     console.error(&quot;localStorage不可用:&quot;, e);
                     // 儲存功能不可用時繼續使用內存存儲
                     userRecordsMemory = {};
                     initializeDefaultStats();
                     alert(&quot;注意：本地儲存功能不可用，您的記錄將不會被保存。可能原因：私隱模式瀏覽或瀏覽器限制。&quot;);
                     return;
                 }
                 
                 try {
                     // 從localStorage載入用戶記錄
                     let rawUserRecords = localStorage.getItem(&#39;MemoryMaster_userRecords&#39;);
                     // 關鍵點：修正了localStorage的鍵名，添加了應用前綴避免命名衝突
                     
                     console.log(&quot;原始用戶記錄數據:&quot;, rawUserRecords);
                     
                     if (rawUserRecords) {
                         try {
                             userRecordsMemory = JSON.parse(rawUserRecords);
                             console.log(&quot;解析後的用戶記錄:&quot;, userRecordsMemory);
                             console.log(&quot;從localStorage載入記錄成功:&quot;, Object.keys(userRecordsMemory).length, &quot;個記錄&quot;);
                         } catch (e) {
                             console.error(&quot;解析userRecords時出錯:&quot;, e);
                             console.log(&quot;無效的JSON格式:&quot;, rawUserRecords);
                             userRecordsMemory = {};
                             localStorage.setItem(&#39;MemoryMaster_userRecords&#39;, JSON.stringify({}));
                         }
                     } else {
                         console.log(&quot;未找到現有記錄，創建新的空記錄&quot;);
                         userRecordsMemory = {};
                         localStorage.setItem(&#39;MemoryMaster_userRecords&#39;, JSON.stringify({}));
                         console.log(&quot;初始化userRecords本地存儲&quot;);
                     }
                     
                     // 從localStorage載入全局統計數據
                     let rawGlobalStats = localStorage.getItem(&#39;MemoryMaster_globalStats&#39;);
                     console.log(&quot;原始全局統計數據:&quot;, rawGlobalStats);
                     
                     if (rawGlobalStats) {
                         try {
                             globalStats = JSON.parse(rawGlobalStats);
                             console.log(&quot;解析後的全局統計:&quot;, globalStats);
                             console.log(&quot;從localStorage載入統計數據成功&quot;);
                         } catch (e) {
                             console.error(&quot;解析globalStats時出錯:&quot;, e);
                             console.log(&quot;無效的JSON格式:&quot;, rawGlobalStats);
                             initializeDefaultStats();
                         }
                     } else {
                         console.log(&quot;未找到現有全局統計，創建默認統計數據&quot;);
                         initializeDefaultStats();
                         console.log(&quot;初始化globalStats本地存儲&quot;);
                     }
                     
                     // 立即保存一次，確認數據能夠正確寫入
                     saveStats(true);
                 } catch (error) {
                     console.error(&quot;載入本地存儲數據時出錯:&quot;, error);
                     // 初始化默認數據
                     userRecordsMemory = {};
                     initializeDefaultStats();
                 }
             }
             
             // 初始化默認統計數據
             function initializeDefaultStats() {
                 console.log(&quot;初始化默認統計數據&quot;);
                 globalStats = {
                     totalCompletionCount: 0,
                     failAfterHalfwayCount: 0,
                     lightningAchievementCount: 0,
                     perfectAchievementCount: 0,
                     memoryAchievementCount: 0,
                     tirelessAchievementCount: 0,
                     nightOwlAchievementCount: 0,
                     badDigestionAchievementCount: 0,
                     // 記錄各分類篇章完成情況
                     specifiedTextCompletions: {}, // 指定文言篇章完成次數
                     literatureCompletions: {},   // 文學篇章完成次數
                     achievements: {
                         nightOwl: false,
                         badDigestion: false,
                         dryEyes: false,
                         nightOwlKing: false,
                         focusOnEating: false,
                         adventureLevel: 0,
                         defeatLevel: 0,
                         speedRouteLevel: 0,
                         perfectRouteLevel: 0,
                         memoryRouteLevel: 0,
                         specifiedTextRouteLevel: 0, // 指定文言篇章大師之路
                         literatureRouteLevel: 0     // 文學冒險者之路
                     }
                 };
                 
                 try {
                     localStorage.setItem(&#39;MemoryMaster_globalStats&#39;, JSON.stringify(globalStats));
                     console.log(&quot;默認統計數據已保存到localStorage&quot;);
                 } catch (e) {
                     console.error(&quot;保存默認統計數據時出錯:&quot;, e);
                 }
             }
             
             // 保存統計數據到localStorage
             function saveStats(isInitial = false) {
                 if (!isInitial) {
                     console.log(&quot;保存統計數據到localStorage...&quot;);
                 }
                 
                 // 測試localStorage可用性
                 try {
                     localStorage.setItem(&#39;test&#39;, &#39;test&#39;);
                     localStorage.removeItem(&#39;test&#39;);
                 } catch (e) {
                     console.error(&quot;localStorage不可用，無法保存數據:&quot;, e);
                     return false;
                 }
                 
                 try {
                     // 將要保存的數據轉為JSON字符串
                     const userRecordsJson = JSON.stringify(userRecordsMemory);
                     const globalStatsJson = JSON.stringify(globalStats);
                     
                     // 檢查數據大小是否超過瀏覽器限制(通常約5MB)
                     const totalSize = userRecordsJson.length + globalStatsJson.length;
                     if (totalSize &gt; 4 * 1024 * 1024) { // 4MB警告閾值
                         console.warn(&quot;數據大小接近localStorage限制:&quot;, totalSize, &quot;bytes&quot;);
                     }
                     
                     // 保存用戶記錄和全局統計
                     localStorage.setItem(&#39;MemoryMaster_userRecords&#39;, userRecordsJson);
                     localStorage.setItem(&#39;MemoryMaster_globalStats&#39;, globalStatsJson);
                     
                     // 驗證保存是否成功
                     const savedUserRecords = localStorage.getItem(&#39;MemoryMaster_userRecords&#39;);
                     const savedGlobalStats = localStorage.getItem(&#39;MemoryMaster_globalStats&#39;);
                     
                     if (savedUserRecords !== userRecordsJson || savedGlobalStats !== globalStatsJson) {
                         console.error(&quot;數據驗證失敗，保存的數據與原始數據不一致&quot;);
                         return false;
                     }
                     
                     if (!isInitial) {
                         console.log(&quot;數據已成功保存並驗證&quot;);
                     }
                     return true;
                 } catch (error) {
                     console.error(&quot;保存數據到localStorage時出錯:&quot;, error);
                     return false;
                 }
             }
             
             // 顯示用戶記錄 - 改良版 (包含未完成篇章)
             function displayUserRecords() {
                 const infoModalContent = document.getElementById(&#39;info-modal-content&#39;);
                 if (!infoModalContent) return;
                 
                 // 使用內存中的記錄
                 const hasRecords = Object.keys(userRecordsMemory).length &gt; 0;
                 
                 // 定義分類順序
                 const categoryOrder = [&#39;中一&#39;, &#39;中二&#39;, &#39;中三&#39;, &#39;指定文言&#39;, &#39;文學&#39;, &#39;其他&#39;];
                 
                 // 分類選擇器
                 let recordsHTML = `
                 &lt;div class=&quot;mb-6&quot;&gt;
                     &lt;div class=&quot;flex items-center justify-between mb-3&quot;&gt;
                         &lt;h4 class=&quot;text-lg font-medium text-amber-800 dark:text-amber-400&quot;&gt;按分類查看&lt;/h4&gt;
                     &lt;/div&gt;
                     &lt;div class=&quot;flex flex-wrap gap-2&quot;&gt;
                         &lt;button class=&quot;category-filter py-1 px-3 bg-primary text-white rounded-lg hover:bg-opacity-90 text-sm&quot; data-category=&quot;all&quot;&gt;全部&lt;/button&gt;
                 `;
                 
                 // 分類所有篇章，包括尚未完成的
                 const categorizedPassages = {};
                 
                 // 先將所有篇章按分類整理
                 Object.keys(passages).forEach(passageKey =&gt; {
                     const passage = passages[passageKey];
                     const category = passage.category || &#39;其他&#39;;
                     
                     if (!categorizedPassages[category]) {
                         categorizedPassages[category] = [];
                     }
                     
                     // 檢查是否有記錄
                     const record = userRecordsMemory[passageKey] || null;
                     
                     categorizedPassages[category].push({
                         passageKey,
                         title: passage.title,
                         author: passage.author,
                         category: category,
                         record: record,
                         hasRecord: !!record
                     });
                 });
                 
                 // 為每個有篇章的分類創建篩選按鈕
                 categoryOrder.forEach(category =&gt; {
                     if (categorizedPassages[category] &amp;&amp; categorizedPassages[category].length &gt; 0) {
                         recordsHTML += `
                             &lt;button class=&quot;category-filter py-1 px-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 text-sm&quot; data-category=&quot;${category}&quot;&gt;
                                 ${category}
                             &lt;/button&gt;
                         `;
                     }
                 });
                 
                 recordsHTML += `&lt;/div&gt;&lt;/div&gt;`;
                 
                 // 如果完全沒有篇章記錄
                 if (Object.keys(categorizedPassages).length === 0) {
                     recordsHTML += `
                         &lt;div class=&quot;text-center p-4&quot;&gt;
                             &lt;i class=&quot;fas fa-info-circle text-amber-500 text-3xl mb-3&quot;&gt;&lt;/i&gt;
                             &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;尚未加載任何篇章&lt;/p&gt;
                         &lt;/div&gt;
                     `;
                     infoModalContent.innerHTML = recordsHTML;
                     return;
                 }
                 
                 recordsHTML += `&lt;div class=&quot;space-y-4 records-container&quot;&gt;`;
                 
                 // 按照預定義順序處理分類
                 categoryOrder.forEach(category =&gt; {
                     if (categorizedPassages[category] &amp;&amp; categorizedPassages[category].length &gt; 0) {
                         recordsHTML += `
                             &lt;div class=&quot;category-section mb-4&quot; data-category=&quot;${category}&quot;&gt;
                                 &lt;h4 class=&quot;text-lg font-medium text-amber-800 dark:text-amber-400 mb-2&quot;&gt;${category}&lt;/h4&gt;
                                 &lt;div class=&quot;bg-gray-50 dark:bg-gray-700/50 rounded-lg overflow-hidden&quot;&gt;
                         `;
                         
                         // 對該分類中的所有篇章按標題排序
                         categorizedPassages[category].sort((a, b) =&gt; {
                             if (a.title &lt; b.title) return -1;
                             if (a.title &gt; b.title) return 1;
                             return 0;
                         });
                         
                         // 生成該分類下的所有篇章記錄 (包括未完成的)
                         categorizedPassages[category].forEach((item, index) =&gt; {
                             // 判斷是否有記錄
                             if (item.hasRecord) {
                                 // 格式化最佳時間
                                 let bestTimeFormatted = &quot;未有記錄&quot;;
                                 if (item.record.bestTime) {
                                     const minutes = Math.floor(item.record.bestTime / 60);
                                     const seconds = (item.record.bestTime % 60).toFixed(1);
                                     bestTimeFormatted = `${minutes.toString().padStart(2, &#39;0&#39;)}:${seconds.toString().padStart(4, &#39;0&#39;)}`;
                                 }
                                 
                                 recordsHTML += `
                                     &lt;div class=&quot;p-3 ${index &gt; 0 ? &#39;border-t border-gray-200 dark:border-gray-600&#39; : &#39;&#39;}&quot;&gt;
                                         &lt;div class=&quot;flex justify-between items-start&quot;&gt;
                                             &lt;div&gt;
                                                 &lt;p class=&quot;font-medium text-gray-800 dark:text-gray-200&quot;&gt;${item.title}&lt;/p&gt;
                                                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-400&quot;&gt;${item.author}&lt;/p&gt;
                                             &lt;/div&gt;
                                             &lt;div class=&quot;text-right&quot;&gt;
                                                 &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;完成：&lt;span class=&quot;font-medium&quot;&gt;${item.record.completionCount || 0}&lt;/span&gt; 次&lt;/p&gt;
                                                 &lt;p class=&quot;text-gray-700 dark:text-gray-300&quot;&gt;最佳：&lt;span class=&quot;font-medium&quot;&gt;${bestTimeFormatted}&lt;/span&gt;&lt;/p&gt;
                                             &lt;/div&gt;
                                         &lt;/div&gt;
                                     &lt;/div&gt;
                                 `;
                             } else {
                                 // 顯示未完成的篇章
                                 recordsHTML += `
                                     &lt;div class=&quot;p-3 ${index &gt; 0 ? &#39;border-t border-gray-200 dark:border-gray-600&#39; : &#39;&#39;} bg-gray-50 dark:bg-gray-800/30&quot;&gt;
                                         &lt;div class=&quot;flex justify-between items-start&quot;&gt;
                                             &lt;div&gt;
                                                 &lt;p class=&quot;font-medium text-gray-600 dark:text-gray-400&quot;&gt;${item.title}&lt;/p&gt;
                                                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500&quot;&gt;${item.author}&lt;/p&gt;
                                             &lt;/div&gt;
                                             &lt;div class=&quot;text-right&quot;&gt;
                                                 &lt;p class=&quot;text-amber-600 dark:text-amber-500 italic text-sm&quot;&gt;未有記錄&lt;/p&gt;
                                             &lt;/div&gt;
                                         &lt;/div&gt;
                                     &lt;/div&gt;
                                 `;
                             }
                         });
                         
                         recordsHTML += `&lt;/div&gt;&lt;/div&gt;`;
                     }
                 });
                 
                 recordsHTML += `&lt;/div&gt;`;
                 
                 infoModalContent.innerHTML = recordsHTML;
                 
                 // 為分類篩選按鈕添加事件監聽器
                 setTimeout(() =&gt; {
                     const categoryFilters = infoModalContent.querySelectorAll(&#39;.category-filter&#39;);
                     const categorySections = infoModalContent.querySelectorAll(&#39;.category-section&#39;);
                     
                     categoryFilters.forEach(filter =&gt; {
                         filter.addEventListener(&#39;click&#39;, function() {
                             // 移除所有按鈕的高亮樣式
                             categoryFilters.forEach(btn =&gt; {
                                 btn.classList.remove(&#39;bg-primary&#39;, &#39;text-white&#39;);
                                 btn.classList.add(&#39;bg-gray-200&#39;, &#39;dark:bg-gray-700&#39;, &#39;text-gray-800&#39;, &#39;dark:text-gray-200&#39;);
                             });
                             
                             // 高亮當前選中的按鈕
                             this.classList.remove(&#39;bg-gray-200&#39;, &#39;dark:bg-gray-700&#39;, &#39;text-gray-800&#39;, &#39;dark:text-gray-200&#39;);
                             this.classList.add(&#39;bg-primary&#39;, &#39;text-white&#39;);
                             
                             // 獲取選中的分類
                             const selectedCategory = this.dataset.category;
                             
                             // 顯示/隱藏相應的分類板塊
                             if (selectedCategory === &#39;all&#39;) {
                                 // 顯示所有分類
                                 categorySections.forEach(section =&gt; {
                                     section.style.display = &#39;block&#39;;
                                 });
                             } else {
                                 // 只顯示選中的分類
                                 categorySections.forEach(section =&gt; {
                                     if (section.dataset.category === selectedCategory) {
                                         section.style.display = &#39;block&#39;;
                                     } else {
                                         section.style.display = &#39;none&#39;;
                                     }
                                 });
                             }
                         });
                     });
                     
                     // 默認選中&quot;全部&quot;按鈕
                     const allFilter = infoModalContent.querySelector(&#39;.category-filter[data-category=&quot;all&quot;]&#39;);
                     if (allFilter) {
                         allFilter.click();
                     }
                 }, 100);
             }
             
             // 完全移除重複的宣告和對象定義，因為這些已經在前面定義過了
             
             // 記錄通關成績
             function recordCompletionStats(passageKey, completionTime, isFullPassage) {
                 // 只記錄完整篇章的成績
                 if (!isFullPassage) {
                     console.log(&quot;非完整篇章，不記錄成績&quot;);
                     return;
                 }
                 
                 try {
                     // 確保userRecordsMemory已初始化
                     if (typeof userRecordsMemory !== &#39;object&#39; || userRecordsMemory === null) {
                         userRecordsMemory = {};
                         console.log(&quot;初始化userRecordsMemory&quot;);
                     }
                     
                     // 確保globalStats已初始化
                     if (typeof globalStats !== &#39;object&#39; || globalStats === null) {
                         initializeDefaultStats();
                     }
                     
                     // 確保分類完成情況記錄已初始化
                     if (!globalStats.specifiedTextCompletions) {
                         globalStats.specifiedTextCompletions = {};
                     }
                     if (!globalStats.literatureCompletions) {
                         globalStats.literatureCompletions = {};
                     }
                     
                     // 更新記錄
                     if (!userRecordsMemory[passageKey]) {
                         userRecordsMemory[passageKey] = {
                             completionCount: 0,
                             bestTime: null
                         };
                     }
                     
                     // 增加完成次數
                     userRecordsMemory[passageKey].completionCount = (userRecordsMemory[passageKey].completionCount || 0) + 1;
                     
                     // 更新全局完成次數
                     globalStats.totalCompletionCount = (globalStats.totalCompletionCount || 0) + 1;
                     
                     // 獲取當前篇章資訊
                     const passage = passages[passageKey];
                     if (passage) {
                         const category = passage.category || &#39;其他&#39;;
                         
                         // 更新分類完成統計
                         if (category === &#39;指定文言&#39;) {
                             if (!globalStats.specifiedTextCompletions[passageKey]) {
                                 globalStats.specifiedTextCompletions[passageKey] = 0;
                             }
                             globalStats.specifiedTextCompletions[passageKey]++;
                             
                             // 檢查更新指定文言篇章大師之路成就等級
                             updateSpecifiedTextAchievement();
                         } else if (category === &#39;文學&#39;) {
                             if (!globalStats.literatureCompletions[passageKey]) {
                                 globalStats.literatureCompletions[passageKey] = 0;
                             }
                             globalStats.literatureCompletions[passageKey]++;
                             
                             // 檢查更新文學冒險者之路成就等級
                             updateLiteratureAchievement();
                         }
                     }
                     
                     // 更新冒險之路成就
                     if (globalStats.totalCompletionCount &gt;= 300 &amp;&amp; globalStats.achievements.adventureLevel &lt; 5) {
                         globalStats.achievements.adventureLevel = 5; // 掃地僧
                     } else if (globalStats.totalCompletionCount &gt;= 150 &amp;&amp; globalStats.achievements.adventureLevel &lt; 4) {
                         globalStats.achievements.adventureLevel = 4; // 偏執狂
                     } else if (globalStats.totalCompletionCount &gt;= 50 &amp;&amp; globalStats.achievements.adventureLevel &lt; 3) {
                         globalStats.achievements.adventureLevel = 3; // 大師
                     } else if (globalStats.totalCompletionCount &gt;= 10 &amp;&amp; globalStats.achievements.adventureLevel &lt; 2) {
                         globalStats.achievements.adventureLevel = 2; // 勇者
                     } else if (globalStats.totalCompletionCount &gt;= 1 &amp;&amp; globalStats.achievements.adventureLevel &lt; 1) {
                         globalStats.achievements.adventureLevel = 1; // 初心者
                     }
                     
                     // 檢查特殊時間成就
                     const now = new Date();
                     const hours = now.getHours();
                     const minutes = now.getMinutes();
                     
                     // 判斷夜貓成就 (01:00-03:00)
                     if (hours &gt;= 1 &amp;&amp; hours &lt; 3) {
                         globalStats.achievements.nightOwl = true;
                         
                         // 增加獲得夜貓成就次數
                         globalStats.nightOwlAchievementCount = (globalStats.nightOwlAchievementCount || 0) + 1;
                         
                         // 檢查是否達成「夜貓王」成就（獲得夜貓20次）
                         if (globalStats.nightOwlAchievementCount &gt;= 20 &amp;&amp; !globalStats.achievements.nightOwlKing) {
                             globalStats.achievements.nightOwlKing = true;
                             console.log(&quot;獲得獨立成就：夜貓王（獲得夜貓20次）&quot;);
                         }
                     }
                     
                     // 判斷腸胃不好成就 (11:59-12:45)
                     if ((hours == 11 &amp;&amp; minutes &gt;= 59) || (hours == 12 &amp;&amp; minutes &lt;= 45)) {
                         globalStats.achievements.badDigestion = true;
                         
                         // 增加獲得腸胃不好成就次數
                         globalStats.badDigestionAchievementCount = (globalStats.badDigestionAchievementCount || 0) + 1;
                         
                         // 檢查是否達成「請專心吃飯」成就（獲得腸胃不好20次）
                         if (globalStats.badDigestionAchievementCount &gt;= 20 &amp;&amp; !globalStats.achievements.focusOnEating) {
                             globalStats.achievements.focusOnEating = true;
                             console.log(&quot;獲得獨立成就：請專心吃飯（獲得腸胃不好20次）&quot;);
                         }
                     }
                     
                     // 更新最佳時間（如果比現有記錄更好或沒有記錄）
                     if (userRecordsMemory[passageKey].bestTime === null || completionTime &lt; userRecordsMemory[passageKey].bestTime) {
                         userRecordsMemory[passageKey].bestTime = completionTime;
                     }
                     
                     // 保存更新後的數據到localStorage
                     saveStats();
                     
                     console.log(`更新記錄：${passageKey}，完成次數: ${userRecordsMemory[passageKey].completionCount}, 最佳時間: ${userRecordsMemory[passageKey].bestTime}`);
                     console.log(&quot;當前記錄數據：&quot;, JSON.stringify(userRecordsMemory));
                     console.log(&quot;全局統計：&quot;, JSON.stringify(globalStats));
                 } catch (e) {
                     console.error(&#39;記錄成績時發生錯誤&#39;, e);
                 }
             }
             
             // 檢查並更新指定文言篇章大師之路成就
             function updateSpecifiedTextAchievement() {
                 // 要求的完成次數對應每個等級
                 const requirements = [1, 3, 10, 20];
                 
                 // 獲取所有指定文言類別的篇章
                 const specifiedTextPassages = Object.keys(passages).filter(key =&gt; 
                     passages[key].category === &#39;指定文言&#39;
                 );
                 
                 // 如果沒有指定文言篇章，則退出
                 if (specifiedTextPassages.length === 0) return;
                 
                 // 獲取每個指定文言篇章的完成次數
                 const completionCounts = specifiedTextPassages.map(key =&gt; 
                     globalStats.specifiedTextCompletions[key] || 0
                 );
                 
                 // 找出最小完成次數（所有篇章中完成次數最少的）
                 const minCompletions = Math.min(...completionCounts);
                 
                 // 更新成就等級
                 for (let i = requirements.length - 1; i &gt;= 0; i--) {
                     if (minCompletions &gt;= requirements[i]) {
                         // 所有篇章至少都完成了這個等級的要求次數
                         if (globalStats.achievements.specifiedTextRouteLevel &lt; i + 1) {
                             globalStats.achievements.specifiedTextRouteLevel = i + 1;
                             console.log(`更新指定文言篇章大師之路成就等級: ${i + 1}`);
                         }
                         break;
                     }
                 }
             }
             
             // 檢查並更新文學冒險者之路成就
             function updateLiteratureAchievement() {
                 // 要求的完成次數對應每個等級
                 const requirements = [1, 3, 10, 20];
                 
                 // 獲取所有文學類別的篇章
                 const literaturePassages = Object.keys(passages).filter(key =&gt; 
                     passages[key].category === &#39;文學&#39;
                 );
                 
                 // 如果沒有文學篇章，則退出
                 if (literaturePassages.length === 0) return;
                 
                 // 獲取每個文學篇章的完成次數
                 const completionCounts = literaturePassages.map(key =&gt; 
                     globalStats.literatureCompletions[key] || 0
                 );
                 
                 // 找出最小完成次數（所有篇章中完成次數最少的）
                 const minCompletions = Math.min(...completionCounts);
                 
                 // 更新成就等級
                 for (let i = requirements.length - 1; i &gt;= 0; i--) {
                     if (minCompletions &gt;= requirements[i]) {
                         // 所有篇章至少都完成了這個等級的要求次數
                         if (globalStats.achievements.literatureRouteLevel &lt; i + 1) {
                             globalStats.achievements.literatureRouteLevel = i + 1;
                             console.log(`更新文學冒險者之路成就等級: ${i + 1}`);
                         }
                         break;
                     }
                 }
             }
             
             // 顯示歷史成就
         function displayAchievements() {
         const infoModalContent = document.getElementById(&#39;info-modal-content&#39;);
         if (!infoModalContent) return;
         
         // 確保globalStats已初始化
         if (typeof globalStats !== &#39;object&#39; || globalStats === null) {
         initializeDefaultStats();
         }
         
         // 創建SVG徽章
         const createAchievementSVG = (colors, borderColor) =&gt; {
         const uniqueId = &#39;seal_&#39; + Math.random().toString(36).substr(2, 9);
         return `
         &lt;svg viewBox=&quot;0 0 100 100&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
             &lt;defs&gt;
                 &lt;radialGradient id=&quot;${uniqueId}&quot; cx=&quot;50%&quot; cy=&quot;50%&quot; r=&quot;50%&quot; fx=&quot;50%&quot; fy=&quot;50%&quot;&gt;
                     &lt;stop offset=&quot;0%&quot; style=&quot;stop-color:${colors.center}&quot; /&gt;
                     &lt;stop offset=&quot;70%&quot; style=&quot;stop-color:${colors.middle}&quot; /&gt;
                     &lt;stop offset=&quot;100%&quot; style=&quot;stop-color:${colors.outer}&quot; /&gt;
                 &lt;/radialGradient&gt;
             &lt;/defs&gt;
             &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;45&quot; fill=&quot;url(#${uniqueId})&quot; /&gt;
             &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;42&quot; fill=&quot;none&quot; stroke=&quot;${borderColor}&quot; stroke-width=&quot;1&quot; stroke-dasharray=&quot;2,1&quot; /&gt;
             &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;38&quot; fill=&quot;none&quot; stroke=&quot;${borderColor}&quot; stroke-width=&quot;0.5&quot; /&gt;
         &lt;/svg&gt;
         `;
         };
         
         // 各成就顏色定義
         // 冒險之路成就顏色
         const adventureColors = [
         { center: &#39;#B3E5FC&#39;, middle: &#39;#4FC3F7&#39;, outer: &#39;#0288D1&#39; }, // 初心者
         { center: &#39;#EF5350&#39;, middle: &#39;#E53935&#39;, outer: &#39;#C62828&#39; }, // 勇者
         { center: &#39;#FFD54F&#39;, middle: &#39;#FFC107&#39;, outer: &#39;#FFA000&#39; }, // 大師
         { center: &#39;#BA68C8&#39;, middle: &#39;#AB47BC&#39;, outer: &#39;#8E24AA&#39; }, // 偏執狂
         { center: &#39;#A5D6A7&#39;, middle: &#39;#81C784&#39;, outer: &#39;#4CAF50&#39; }  // 掃地僧
         ];
         
         // 挫敗之路成就顏色
         const defeatColors = [
         { center: &#39;#D7CCC8&#39;, middle: &#39;#8D6E63&#39;, outer: &#39;#4E342E&#39; }, // 初嘗敗績
         { center: &#39;#E3F2FD&#39;, middle: &#39;#90CAF9&#39;, outer: &#39;#1565C0&#39; }, // 堅毅
         { center: &#39;#80DEEA&#39;, middle: &#39;#26A69A&#39;, outer: &#39;#004D40&#39; }, // 鋼鐵意志
         { center: &#39;#FFE0B2&#39;, middle: &#39;#FFB74D&#39;, outer: &#39;#E65100&#39; }, // 小強是我
         { center: &#39;#E0F7FA&#39;, middle: &#39;#80DEEA&#39;, outer: &#39;#00838F&#39; }  // 心如止水
         ];
         
         // 極速之路成就顏色
         const speedColors = [
         { center: &#39;#FF5252&#39;, middle: &#39;#D50000&#39;, outer: &#39;#B71C1C&#39; }, // 敏捷
         { center: &#39;#FF9800&#39;, middle: &#39;#F57C00&#39;, outer: &#39;#E65100&#39; }, // 肌肉記憶
         { center: &#39;#00B4D8&#39;, middle: &#39;#0096C7&#39;, outer: &#39;#023E8A&#39; }, // 無影手
         { center: &#39;#FFEE58&#39;, middle: &#39;#FFD600&#39;, outer: &#39;#F9A825&#39; }  // 世界第一束光
         ];
         
         // 完美之路成就顏色
         const perfectColors = [
         { center: &#39;#80CBC4&#39;, middle: &#39;#4DB6AC&#39;, outer: &#39;#E8F5E9&#39; }, // 如沐春風
         { center: &#39;#F06292&#39;, middle: &#39;#EC407A&#39;, outer: &#39;#AD1457&#39; }, // 完美主義
         { center: &#39;#FFD54F&#39;, middle: &#39;#FFB300&#39;, outer: &#39;#5D4037&#39; }, // 滿月
         { center: &#39;#B39DDB&#39;, middle: &#39;#7E57C2&#39;, outer: &#39;#4527A0&#39; }  // 至善
         ];
         
         // 記憶之路成就顏色
         const memoryColors = [
         { center: &#39;#00E5FF&#39;, middle: &#39;#00B8D4&#39;, outer: &#39;#006064&#39; }, // 激活腦細胞
         { center: &#39;#FFD54F&#39;, middle: &#39;#FFB300&#39;, outer: &#39;#F57F17&#39; }, // 記憶麵包
         { center: &#39;#5C6BC0&#39;, middle: &#39;#3949AB&#39;, outer: &#39;#283593&#39; }, // 移動圖書館
         { center: &#39;#26C6DA&#39;, middle: &#39;#00ACC1&#39;, outer: &#39;#00838F&#39; }  // 流如背倒
         ];
         
         // 特殊累積成就顏色
         const dryEyesColors = { center: &#39;#FFCC80&#39;, middle: &#39;#FFA726&#39;, outer: &#39;#EF6C00&#39; }; // 眼乾
         const nightOwlKingColors = { center: &#39;#5D4037&#39;, middle: &#39;#3E2723&#39;, outer: &#39;#1B0000&#39; }; // 夜貓王
         const focusOnEatingColors = { center: &#39;#FFFFFF&#39;, middle: &#39;#FFD0B0&#39;, outer: &#39;#FF8A65&#39; }; // 請專心吃飯
         
         let contentHTML = `
         &lt;div class=&quot;space-y-6&quot;&gt;
         &lt;!-- 冒險之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;冒險之路（只計算完整篇章）&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 冒險之路成就等級名稱
         const adventureLevels = [&#39;初心者&#39;, &#39;勇者&#39;, &#39;大師&#39;, &#39;偏執狂&#39;, &#39;掃地僧&#39;];
         const adventureRequirements = [1, 10, 50, 150, 300];
         const adventureBorderColors = [&#39;#90CAF9&#39;, &#39;#4CAF50&#39;, &#39;#F4511E&#39;, &#39;#673AB7&#39;, &#39;#FFC107&#39;];
         
         // 當前冒險等級
         const currentLevel = globalStats.achievements.adventureLevel;
         
         // 如果已經達成任何等級
         if (currentLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(adventureColors[levelIndex], adventureBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${adventureLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;完成${adventureRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-5&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${adventureLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;總完成次數：${globalStats.totalCompletionCount}&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentLevel &lt; 5) {
             const nextLevelIndex = currentLevel;
             const nextRequirement = adventureRequirements[nextLevelIndex];
             const progress = Math.min(100, (globalStats.totalCompletionCount / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${adventureLevels[nextLevelIndex]}&quot; 還需 ${nextRequirement - globalStats.totalCompletionCount} 次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-medal text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得冒險成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;完成至少1次挑戰解鎖「初心者」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 挫敗之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;挫敗之路（只計算完整篇章）&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 挫敗之路成就等級名稱
         const defeatLevels = [&#39;初嘗敗績&#39;, &#39;堅毅&#39;, &#39;鋼鐵意志&#39;, &#39;小強是我&#39;, &#39;心如止水&#39;];
         const defeatRequirements = [1, 5, 30, 50, 100];
         const defeatBorderColors = [&#39;#7E57C2&#39;, &#39;#42A5F5&#39;, &#39;#00796B&#39;, &#39;#F57C00&#39;, &#39;#D32F2F&#39;];
         
         // 當前挫敗等級
         const currentDefeatLevel = globalStats.achievements.defeatLevel;
         
         // 如果已經達成任何等級
         if (currentDefeatLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentDefeatLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(defeatColors[levelIndex], defeatBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${defeatLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;失敗${defeatRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-5&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${defeatLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;遊戲過半後失敗：${globalStats.failAfterHalfwayCount}次&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentDefeatLevel &lt; 5) {
             const nextLevelIndex = currentDefeatLevel;
             const nextRequirement = defeatRequirements[nextLevelIndex];
             const progress = Math.min(100, (globalStats.failAfterHalfwayCount / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${defeatLevels[nextLevelIndex]}&quot; 還需 ${nextRequirement - globalStats.failAfterHalfwayCount} 次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-bolt-lightning text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得挫敗成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;在遊戲過半後失敗至少1次解鎖「初嘗敗績」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 極速之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;極速之路&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 極速之路成就等級名稱
         const speedLevels = [&#39;敏捷&#39;, &#39;肌肉記憶&#39;, &#39;無影手&#39;, &#39;世界第一束光&#39;];
         const speedRequirements = [1, 10, 50, 100];
         const speedBorderColors = [&#39;#311B92&#39;, &#39;#283593&#39;, &#39;#1565C0&#39;, &#39;#0277BD&#39;];
         
         // 當前極速等級
         const currentSpeedLevel = globalStats.achievements.speedRouteLevel;
         
         // 如果已經達成任何等級
         if (currentSpeedLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentSpeedLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(speedColors[levelIndex], speedBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${speedLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;獲得${speedRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-5&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${speedLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;閃電俠成就獲得次數：${globalStats.lightningAchievementCount}次&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentSpeedLevel &lt; 4) {
             const nextLevelIndex = currentSpeedLevel;
             const nextRequirement = speedRequirements[nextLevelIndex];
             const progress = Math.min(100, (globalStats.lightningAchievementCount / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${speedLevels[nextLevelIndex]}&quot; 還需 ${nextRequirement - globalStats.lightningAchievementCount} 次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-bolt text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得極速成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;獲得「閃電俠」成就至少1次解鎖「敏捷」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 完美之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;完美之路&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 完美之路成就等級名稱
         const perfectLevels = [&#39;如沐春風&#39;, &#39;完美主義&#39;, &#39;滿月&#39;, &#39;至善&#39;];
         const perfectRequirements = [1, 10, 50, 100];
         const perfectBorderColors = [&#39;#AD1457&#39;, &#39;#6A1B9A&#39;, &#39;#4527A0&#39;, &#39;#283593&#39;];
         
         // 當前完美等級
         const currentPerfectLevel = globalStats.achievements.perfectRouteLevel;
         
         // 如果已經達成任何等級
         if (currentPerfectLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentPerfectLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(perfectColors[levelIndex], perfectBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${perfectLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;獲得${perfectRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-5&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${perfectLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;完美無瑕成就獲得次數：${globalStats.perfectAchievementCount}次&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentPerfectLevel &lt; 4) {
             const nextLevelIndex = currentPerfectLevel;
             const nextRequirement = perfectRequirements[nextLevelIndex];
             const progress = Math.min(100, (globalStats.perfectAchievementCount / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${perfectLevels[nextLevelIndex]}&quot; 還需 ${nextRequirement - globalStats.perfectAchievementCount} 次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-gem text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得完美成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;獲得「完美無瑕」成就至少1次解鎖「如沐春風」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 記憶之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;記憶之路&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 記憶之路成就等級名稱
         const memoryLevels = [&#39;激活腦細胞&#39;, &#39;記憶麵包&#39;, &#39;移動圖書館&#39;, &#39;流如背倒&#39;];
         const memoryRequirements = [1, 10, 30, 50];
         const memoryBorderColors = [&#39;#004D40&#39;, &#39;#00838F&#39;, &#39;#2E7D32&#39;, &#39;#558B2F&#39;];
         
         // 當前記憶等級
         const currentMemoryLevel = globalStats.achievements.memoryRouteLevel;
         
         // 如果已經達成任何等級
         if (currentMemoryLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentMemoryLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(memoryColors[levelIndex], memoryBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${memoryLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;獲得${memoryRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-5&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${memoryLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;記憶大師成就獲得次數：${globalStats.memoryAchievementCount}次&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentMemoryLevel &lt; 4) {
             const nextLevelIndex = currentMemoryLevel;
             const nextRequirement = memoryRequirements[nextLevelIndex];
             const progress = Math.min(100, (globalStats.memoryAchievementCount / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${memoryLevels[nextLevelIndex]}&quot; 還需 ${nextRequirement - globalStats.memoryAchievementCount} 次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-brain text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得記憶成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;獲得「記憶大師」成就至少1次解鎖「激活腦細胞」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 指定文言篇章大師之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;指定文言篇章大師之路（只計算完整篇章）&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 指定文言篇章大師之路成就等級名稱
         const specifiedTextLevels = [&#39;新兵上陣&#39;, &#39;唯手熟爾&#39;, &#39;功在不舍&#39;, &#39;四望如一&#39;];
         const specifiedTextRequirements = [1, 3, 10, 20];
         const specifiedTextBorderColors = [&#39;#8D6E63&#39;, &#39;#6D4C41&#39;, &#39;#5D4037&#39;, &#39;#4E342E&#39;];
         const specifiedTextColors = [
         { center: &#39;#A1887F&#39;, middle: &#39;#8D6E63&#39;, outer: &#39;#795548&#39; }, // 新兵上陣
         { center: &#39;#8D6E63&#39;, middle: &#39;#795548&#39;, outer: &#39;#6D4C41&#39; }, // 唯手熟爾
         { center: &#39;#795548&#39;, middle: &#39;#6D4C41&#39;, outer: &#39;#5D4037&#39; }, // 功在不舍
         { center: &#39;#6D4C41&#39;, middle: &#39;#5D4037&#39;, outer: &#39;#4E342E&#39; }  // 四望如一
         ];
         
         // 獲取所有「指定文言」分類的篇章
         const specifiedTextPassages = Object.keys(passages).filter(key =&gt; 
         passages[key].category === &#39;指定文言&#39;
         );
         
         // 從用戶記錄中讀取每篇篇章的完成次數
         const completionCounts = specifiedTextPassages.map(key =&gt; 
         userRecordsMemory[key]?.completionCount || 0
         );
         
         // 找出最小完成次數
         const minCompletions = completionCounts.length &gt; 0 ? Math.min(...completionCounts) : 0;
         
         // 確定成就等級 - 基於所有篇章的最小完成次數
         let calculatedLevel = 0;
         for (let i = 0; i &lt; specifiedTextRequirements.length; i++) {
         if (minCompletions &gt;= specifiedTextRequirements[i]) {
             calculatedLevel = i + 1;
         } else {
             break;
         }
         }
         
         // 更新全局統計中的成就等級（如果計算出的等級更高）
         if (calculatedLevel &gt; globalStats.achievements.specifiedTextRouteLevel) {
         globalStats.achievements.specifiedTextRouteLevel = calculatedLevel;
         // 保存更新的統計
         saveStats();
         }
         
         // 使用更新後的等級
         const currentSpecifiedTextLevel = globalStats.achievements.specifiedTextRouteLevel;
         
         // 如果已經達成任何等級
         if (currentSpecifiedTextLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentSpecifiedTextLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(specifiedTextColors[levelIndex], specifiedTextBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${specifiedTextLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;完成各${specifiedTextRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-4 flex-1&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${specifiedTextLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;指定文言篇章最少完成：${minCompletions}次&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentSpecifiedTextLevel &lt; 4) {
             const nextLevelIndex = currentSpecifiedTextLevel;
             const nextRequirement = specifiedTextRequirements[nextLevelIndex];
             const progress = Math.min(100, (minCompletions / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${specifiedTextLevels[nextLevelIndex]}&quot; 還需完成所有指定文言篇章至少${nextRequirement - minCompletions}次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-book-open text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得指定文言篇章大師成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;完成所有「指定文言篇章」各1次解鎖「新兵上陣」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 文學冒險者之路成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;文學冒險者之路（只計算完整篇章）&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
         `;
         
         // 文學冒險者之路成就等級名稱
         const literatureLevels = [&#39;青青子衿&#39;, &#39;悠悠我心&#39;, &#39;但為君故&#39;, &#39;沉吟至今&#39;];
         const literatureRequirements = [1, 3, 10, 20];
         const literatureBorderColors = [&#39;#9CCC65&#39;, &#39;#8BC34A&#39;, &#39;#7CB342&#39;, &#39;#689F38&#39;];
         const literatureColors = [
         { center: &#39;#C5E1A5&#39;, middle: &#39;#AED581&#39;, outer: &#39;#9CCC65&#39; }, // 青青子衿
         { center: &#39;#AED581&#39;, middle: &#39;#9CCC65&#39;, outer: &#39;#8BC34A&#39; }, // 悠悠我心
         { center: &#39;#9CCC65&#39;, middle: &#39;#8BC34A&#39;, outer: &#39;#7CB342&#39; }, // 但為君故
         { center: &#39;#8BC34A&#39;, middle: &#39;#7CB342&#39;, outer: &#39;#689F38&#39; }  // 沉吟至今
         ];
         
         // 獲取所有「文學」分類的篇章
         const literaturePassages = Object.keys(passages).filter(key =&gt; 
         passages[key].category === &#39;文學&#39;
         );
         
         // 從用戶記錄中讀取每篇篇章的完成次數
         const literatureCompletionCounts = literaturePassages.map(key =&gt; 
         userRecordsMemory[key]?.completionCount || 0
         );
         
         // 找出最小完成次數
         const literatureMinCompletions = literatureCompletionCounts.length &gt; 0 ? Math.min(...literatureCompletionCounts) : 0;
         
         // 確定成就等級 - 基於所有篇章的最小完成次數
         let calculatedLiteratureLevel = 0;
         for (let i = 0; i &lt; literatureRequirements.length; i++) {
         if (literatureMinCompletions &gt;= literatureRequirements[i]) {
             calculatedLiteratureLevel = i + 1;
         } else {
             break;
         }
         }
         
         // 更新全局統計中的成就等級（如果計算出的等級更高）
         if (calculatedLiteratureLevel &gt; globalStats.achievements.literatureRouteLevel) {
         globalStats.achievements.literatureRouteLevel = calculatedLiteratureLevel;
         // 保存更新的統計
         saveStats();
         }
         
         // 使用更新後的等級
         const currentLiteratureLevel = globalStats.achievements.literatureRouteLevel;
         
         // 如果已經達成任何等級
         if (currentLiteratureLevel &gt; 0) {
         // 顯示當前等級成就
         const levelIndex = currentLiteratureLevel - 1;
         contentHTML += `
             &lt;div class=&quot;flex items-center mb-6&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 110px; height: 110px;&quot;&gt;
                     ${createAchievementSVG(literatureColors[levelIndex], literatureBorderColors[levelIndex])}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title text-lg&quot;&gt;${literatureLevels[levelIndex]}&lt;/span&gt;
                         &lt;span class=&quot;seal-desc&quot;&gt;完成各${literatureRequirements[levelIndex]}次&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-5&quot;&gt;
                     &lt;p class=&quot;text-lg font-bold text-gray-800 dark:text-gray-200&quot;&gt;目前等級：${literatureLevels[levelIndex]}&lt;/p&gt;
                     &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;文學篇章最少完成：${literatureMinCompletions}次&lt;/p&gt;
         `;
         
         // 如果還有下一等級，顯示進度
         if (currentLiteratureLevel &lt; 4) {
             const nextLevelIndex = currentLiteratureLevel;
             const nextRequirement = literatureRequirements[nextLevelIndex];
             const progress = Math.min(100, (literatureMinCompletions / nextRequirement) * 100);
             
             contentHTML += `
                     &lt;div class=&quot;mt-3&quot;&gt;
                         &lt;p class=&quot;text-sm text-gray-700 dark:text-gray-300 mb-1&quot;&gt;距離 &quot;${literatureLevels[nextLevelIndex]}&quot; 還需完成所有文學篇章至少${nextRequirement - literatureMinCompletions}次&lt;/p&gt;
                         &lt;div class=&quot;h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden&quot;&gt;
                             &lt;div class=&quot;h-full bg-primary rounded-full transition-all duration-300&quot; style=&quot;width: ${progress}%&quot;&gt;&lt;/div&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
             `;
         } else {
             contentHTML += `
                     &lt;p class=&quot;mt-3 text-sm text-green-500 dark:text-green-400&quot;&gt;&lt;i class=&quot;fas fa-crown mr-1&quot;&gt;&lt;/i&gt; 已達成最高等級！&lt;/p&gt;
             `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         // 顯示尚未獲得任何成就的提示
         contentHTML += `
             &lt;div class=&quot;text-center py-8&quot;&gt;
                 &lt;i class=&quot;fas fa-feather-alt text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;尚未獲得文學冒險者成就&lt;/p&gt;
                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;完成所有「文學」篇章各1次解鎖「青青子衿」成就&lt;/p&gt;
             &lt;/div&gt;
         `;
         }
         
         // 特殊成就
         contentHTML += `
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;!-- 特殊成就 --&gt;
         &lt;div&gt;
             &lt;h4 class=&quot;text-xl font-bold text-amber-700 dark:text-amber-400 mb-4&quot;&gt;特殊成就&lt;/h4&gt;
             &lt;div class=&quot;bg-gray-50 dark:bg-gray-800 rounded-lg p-5&quot;&gt;
                 &lt;div class=&quot;space-y-4&quot;&gt;
         `;
         
         // 眼乾成就 (獲得不知疲倦30次)
         if (globalStats.achievements.dryEyes) {
         contentHTML += `
             &lt;div class=&quot;flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 80px; height: 80px; margin: 0 10px 0 0;&quot;&gt;
                     ${createAchievementSVG(dryEyesColors, &#39;#0277BD&#39;)}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title&quot;&gt;眼乾&lt;/span&gt;
                         &lt;span class=&quot;seal-desc text-[8px]&quot;&gt;不暫停成癮&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-3&quot;&gt;
                     &lt;p class=&quot;font-medium text-gray-800 dark:text-gray-200&quot;&gt;眼乾&lt;/p&gt;
                     &lt;p class=&quot;text-sm text-gray-600 dark:text-gray-400&quot;&gt;獲得不知疲倦30次&lt;/p&gt;
                     &lt;p class=&quot;text-xs text-green-500 dark:text-green-400 mt-1&quot;&gt;&lt;i class=&quot;fas fa-check-circle mr-1&quot;&gt;&lt;/i&gt; 已獲得&lt;/p&gt;
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         contentHTML += `
             &lt;div class=&quot;flex items-center p-4 bg-gray-100 dark:bg-gray-700/40 rounded-lg&quot;&gt;
                 &lt;div class=&quot;w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center mr-3&quot;&gt;
                     &lt;i class=&quot;fas fa-eye text-gray-400 dark:text-gray-500&quot;&gt;&lt;/i&gt;
                 &lt;/div&gt;
                 &lt;div&gt;
                     &lt;p class=&quot;font-medium text-gray-500 dark:text-gray-400&quot;&gt;眼乾&lt;/p&gt;
                     &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500&quot;&gt;獲得「不知疲倦」30次&lt;/p&gt;
                     &lt;p class=&quot;text-xs text-gray-400 dark:text-gray-500 mt-1&quot;&gt;&lt;i class=&quot;fas fa-lock mr-1&quot;&gt;&lt;/i&gt; 未解鎖&lt;/p&gt;
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         }
         
         // 夜貓王成就 (獲得夜貓20次)
         if (globalStats.achievements.nightOwlKing) {
         contentHTML += `
             &lt;div class=&quot;flex items-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 80px; height: 80px; margin: 0 10px 0 0;&quot;&gt;
                     ${createAchievementSVG(nightOwlKingColors, &#39;#5D4037&#39;)}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title&quot;&gt;夜貓王&lt;/span&gt;
                         &lt;span class=&quot;seal-desc text-[8px]&quot;&gt;深夜成癮&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-3&quot;&gt;
                     &lt;p class=&quot;font-medium text-gray-800 dark:text-gray-200&quot;&gt;夜貓王&lt;/p&gt;
                     &lt;p class=&quot;text-sm text-gray-600 dark:text-gray-400&quot;&gt;獲得「夜貓」20次&lt;/p&gt;
                     &lt;p class=&quot;text-xs text-green-500 dark:text-green-400 mt-1&quot;&gt;&lt;i class=&quot;fas fa-check-circle mr-1&quot;&gt;&lt;/i&gt; 已獲得&lt;/p&gt;
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         contentHTML += `
             &lt;div class=&quot;flex items-center p-4 bg-gray-100 dark:bg-gray-700/40 rounded-lg&quot;&gt;
                 &lt;div class=&quot;w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center mr-3&quot;&gt;
                     &lt;i class=&quot;fas fa-moon text-gray-400 dark:text-gray-500&quot;&gt;&lt;/i&gt;
                 &lt;/div&gt;
                 &lt;div&gt;
                     &lt;p class=&quot;font-medium text-gray-500 dark:text-gray-400&quot;&gt;夜貓王&lt;/p&gt;
                     &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500&quot;&gt;獲得「夜貓」20次&lt;/p&gt;
                     &lt;p class=&quot;text-xs text-gray-400 dark:text-gray-500 mt-1&quot;&gt;&lt;i class=&quot;fas fa-lock mr-1&quot;&gt;&lt;/i&gt; 未解鎖&lt;/p&gt;
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         }
         
         // 請專心吃飯成就 (獲得腸胃不好20次)
         if (globalStats.achievements.focusOnEating) {
         contentHTML += `
             &lt;div class=&quot;flex items-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg&quot;&gt;
                 &lt;div class=&quot;achievement-seal&quot; style=&quot;width: 80px; height: 80px; margin: 0 10px 0 0;&quot;&gt;
                     ${createAchievementSVG(focusOnEatingColors, &#39;#E65100&#39;)}
                     &lt;div class=&quot;seal-text&quot;&gt;
                         &lt;span class=&quot;seal-title&quot;&gt;請專心吃飯&lt;/span&gt;
                         &lt;span class=&quot;seal-desc text-[8px]&quot;&gt;午餐時背誦&lt;/span&gt;
                     &lt;/div&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;ml-3&quot;&gt;
                     &lt;p class=&quot;font-medium text-gray-800 dark:text-gray-200&quot;&gt;請專心吃飯&lt;/p&gt;
                     &lt;p class=&quot;text-sm text-gray-600 dark:text-gray-400&quot;&gt;獲得「腸胃不好」20次&lt;/p&gt;
                     &lt;p class=&quot;text-xs text-green-500 dark:text-green-400 mt-1&quot;&gt;&lt;i class=&quot;fas fa-check-circle mr-1&quot;&gt;&lt;/i&gt; 已獲得&lt;/p&gt;
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         } else {
         contentHTML += `
             &lt;div class=&quot;flex items-center p-4 bg-gray-100 dark:bg-gray-700/40 rounded-lg&quot;&gt;
                 &lt;div class=&quot;w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center mr-3&quot;&gt;
                     &lt;i class=&quot;fas fa-utensils text-gray-400 dark:text-gray-500&quot;&gt;&lt;/i&gt;
                 &lt;/div&gt;
                 &lt;div&gt;
                     &lt;p class=&quot;font-medium text-gray-500 dark:text-gray-400&quot;&gt;請專心吃飯&lt;/p&gt;
                     &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500&quot;&gt;獲得「腸胃不好」20次&lt;/p&gt;
                     &lt;p class=&quot;text-xs text-gray-400 dark:text-gray-500 mt-1&quot;&gt;&lt;i class=&quot;fas fa-lock mr-1&quot;&gt;&lt;/i&gt; 未解鎖&lt;/p&gt;
                 &lt;/div&gt;
             &lt;/div&gt;
         `;
         }
         
         contentHTML += `
                 &lt;/div&gt;
             &lt;/div&gt;
         &lt;/div&gt;
         
         &lt;div class=&quot;text-center text-sm text-gray-500 dark:text-gray-400 mt-8&quot;&gt;
             持續挑戰，解鎖更多成就！
         &lt;/div&gt;
         &lt;/div&gt;
         `;
         
         infoModalContent.innerHTML = contentHTML;
         }            
             // 初始化用戶名編輯功能
             initializeNameEditor();
             
             // 初始化成就展示功能
             initializeAchievementsDisplay();
             
             // 初始化頭像選擇功能
             initializeAvatarSelector();
             
             // 頭像選擇功能
             function initializeAvatarSelector() {
                 // 獲取DOM元素
                 const changeAvatarBtn = document.getElementById(&#39;change-avatar-btn&#39;);
                 const avatarSelectorModal = document.getElementById(&#39;avatar-selector-modal&#39;);
                 const closeAvatarSelector = document.getElementById(&#39;close-avatar-selector&#39;);
                 const avatarGrid = document.getElementById(&#39;avatar-grid&#39;);
                 const userAvatar = document.getElementById(&#39;user-avatar&#39;);
                 
                 // 檢查元素是否存在
                 if (!changeAvatarBtn || !avatarSelectorModal || !closeAvatarSelector || !avatarGrid || !userAvatar) {
                     console.error(&quot;頭像選擇器初始化失敗：缺少必要元素&quot;);
                     return;
                 }
                 
                 // 載入之前選擇的頭像
                 try {
                     const savedAvatar = localStorage.getItem(&#39;MemoryMaster_userAvatar&#39;);
                     if (savedAvatar) {
                         userSelectedAvatar = savedAvatar;
                         renderUserAvatar(userAvatar, savedAvatar);
                     }
                 } catch (e) {
                     console.error(&quot;加載用戶頭像出錯:&quot;, e);
                 }
                 
                 // 生成頭像選項
                 generateAvatarOptions(avatarGrid);
                 
                 // 打開頭像選擇器
                 changeAvatarBtn.addEventListener(&#39;click&#39;, function() {
                     avatarSelectorModal.classList.remove(&#39;hidden&#39;);
                     
                     // 標記當前選中的頭像
                     highlightSelectedAvatar();
                     
                     // 禁用設置齒輪按鈕
                     window.disableSettingsButton();
                 });
                 
                 // 關閉頭像選擇器並重新啟用設置按鈕
                 function closeAvatarSelectorModal() {
                     avatarSelectorModal.classList.add(&#39;hidden&#39;);
                     window.enableSettingsButton();
                 }
                 
                 // 關閉頭像選擇器
                 closeAvatarSelector.addEventListener(&#39;click&#39;, function() {
                     closeAvatarSelectorModal();
                 });
                 
                 // 點擊背景關閉
                 avatarSelectorModal.addEventListener(&#39;click&#39;, function(e) {
                     if (e.target === avatarSelectorModal) {
                         closeAvatarSelectorModal();
                     }
                 });
                 
                 // 將關閉模態框函數設為全局，以便在選擇頭像後使用
                 window.closeAvatarSelectorModal = closeAvatarSelectorModal;
             }
             
             // 檢查頭像是否已解鎖
             function isAvatarUnlocked(avatarKey) {
                 // 默認頭像永遠解鎖
                 if (avatarKey === &#39;default&#39;) return true;
                 
                 // 檢查用戶等級是否達到解鎖要求
                 const requiredLevel = window.avatarUnlockLevels[avatarKey] || 1;
                 return userProfile.level &gt;= requiredLevel;
             }
             
             // 生成頭像選項
             function generateAvatarOptions(container) {
                 if (!container) return;
                 
                 // 清空容器
                 container.innerHTML = &#39;&#39;;
                 
                 // 添加默認頭像選項
                 const defaultOption = document.createElement(&#39;div&#39;);
                 defaultOption.className = &#39;avatar-option &#39; + (userSelectedAvatar === null ? &#39;selected&#39; : &#39;&#39;);
                 defaultOption.dataset.avatar = &#39;default&#39;;
                 defaultOption.innerHTML = `
                     &lt;div class=&quot;pixel-avatar flex items-center justify-center&quot;&gt;
                         &lt;i class=&quot;fas fa-user text-2xl text-gray-800 dark:text-gray-100&quot;&gt;&lt;/i&gt;
                     &lt;/div&gt;
                 `;
                 container.appendChild(defaultOption);
                 
                 // 為默認頭像添加點擊事件
                 defaultOption.addEventListener(&#39;click&#39;, function() {
                     selectAvatar(&#39;default&#39;);
                 });
                 
                 // 添加每個8-bit像素頭像選項
                 Object.keys(avatarPixelData).forEach(key =&gt; {
                     const avatarData = avatarPixelData[key];
                     const isUnlocked = isAvatarUnlocked(key);
                     const requiredLevel = avatarUnlockLevels[key] || 1;
                     
                     const option = document.createElement(&#39;div&#39;);
                     option.className = &#39;avatar-option &#39; + (userSelectedAvatar === key ? &#39;selected&#39; : &#39;&#39;);
                     option.dataset.avatar = key;
                     option.dataset.level = requiredLevel;
                     option.title = isUnlocked ? avatarData.name : `${avatarData.name} (需要等級 ${requiredLevel})`;
                     
                     // 如果頭像未解鎖，添加禁用樣式類
                     if (!isUnlocked) {
                         option.classList.add(&#39;locked&#39;);
                     }
                     
                     // 添加到容器
                     container.appendChild(option);
                     
                     // 添加頭像震動樣式
                     const avatarShakeStyle = document.createElement(&#39;style&#39;);
                     avatarShakeStyle.textContent = `
                         @keyframes avatar-shake {
                             0%, 100% { transform: translateX(0); }
                             25% { transform: translateX(-5px); }
                             50% { transform: translateX(5px); }
                             75% { transform: translateX(-5px); }
                         }
                         
                         .avatar-shake {
                             animation: avatar-shake 0.4s ease-in-out;
                         }
                     `;
                     document.head.appendChild(avatarShakeStyle);
                     
                     // 添加點擊事件
                     option.addEventListener(&#39;click&#39;, function() {
                         // 檢查頭像是否已解鎖
                         if (isUnlocked) {
                             selectAvatar(key);
                         } else {
                             // 未解鎖時輕微震動而不是顯示提醒文字
                             this.classList.add(&#39;avatar-shake&#39;);
                             
                             // 震動結束後移除類
                             setTimeout(() =&gt; {
                                 this.classList.remove(&#39;avatar-shake&#39;);
                             }, 400); // 與動畫持續時間相同
                         }
                     });
                     
                     // 渲染像素頭像
                     renderPixelAvatar(option, key, !isUnlocked);
                     
                     // 如果頭像未解鎖，添加等級指示器
                     if (!isUnlocked) {
                         const levelIndicator = document.createElement(&#39;div&#39;);
                         levelIndicator.className = &#39;absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-lg&#39;;
                         levelIndicator.innerHTML = `&lt;span class=&quot;text-white font-bold text-sm&quot;&gt;Lv.${requiredLevel}&lt;/span&gt;`;
                         option.appendChild(levelIndicator);
                     }
                 });
             }
             
             // 選擇頭像
             function selectAvatar(avatarKey) {
                 // 取消所有選中狀態
                 document.querySelectorAll(&#39;.avatar-option&#39;).forEach(option =&gt; {
                     option.classList.remove(&#39;selected&#39;);
                 });
                 
                 // 設置新選中狀態
                 const selectedOption = document.querySelector(`.avatar-option[data-avatar=&quot;${avatarKey}&quot;]`);
                 if (selectedOption) {
                     selectedOption.classList.add(&#39;selected&#39;);
                 }
                 
                 // 保存選擇
                 userSelectedAvatar = avatarKey === &#39;default&#39; ? null : avatarKey;
                 
                 try {
                     if (userSelectedAvatar === null) {
                         localStorage.removeItem(&#39;MemoryMaster_userAvatar&#39;);
                     } else {
                         localStorage.setItem(&#39;MemoryMaster_userAvatar&#39;, userSelectedAvatar);
                     }
                 } catch (e) {
                     console.error(&quot;保存用戶頭像出錯:&quot;, e);
                 }
                 
                 // 更新用戶頭像顯示
                 const userAvatar = document.getElementById(&#39;user-avatar&#39;);
                 if (userAvatar) {
                     renderUserAvatar(userAvatar, userSelectedAvatar);
                 }
                 
                 // 顯示成功提示
                 const notification = document.createElement(&#39;div&#39;);
                 notification.className = &#39;fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-green-100 text-green-800 py-2 px-4 rounded-lg shadow-lg z-50&#39;;
                 notification.innerHTML = &#39;&lt;i class=&quot;fas fa-check-circle mr-2&quot;&gt;&lt;/i&gt;頭像已更新&#39;;
                 document.body.appendChild(notification);
                 
                 // 3秒後移除提示
                 setTimeout(() =&gt; {
                     notification.remove();
                 }, 3000);
                 
                 // 選擇頭像後自動關閉選擇器
                 if (window.closeAvatarSelectorModal) {
                     window.closeAvatarSelectorModal();
                 }
             }
             
             // 標記當前選中的頭像
             function highlightSelectedAvatar() {
                 document.querySelectorAll(&#39;.avatar-option&#39;).forEach(option =&gt; {
                     option.classList.remove(&#39;selected&#39;);
                     
                     if ((userSelectedAvatar === null &amp;&amp; option.dataset.avatar === &#39;default&#39;) || 
                         option.dataset.avatar === userSelectedAvatar) {
                         option.classList.add(&#39;selected&#39;);
                     }
                 });
             }
            
             
             // 幫助函數 - 創建一個基於字符串的哈希值
             function hashString(str) {
                 let hash = 0;
                 if (str.length === 0) return hash;
                 for (let i = 0; i &lt; str.length; i++) {
                     const char = str.charCodeAt(i);
                     hash = ((hash &lt;&lt; 5) - hash) + char;
                     hash = hash &amp; hash; // 轉換為32位整數
                 }
                 return hash &gt;&gt;&gt; 0; // 轉換為無符號整數
             }
             
             // 幫助函數 - 基於種子的隨機數生成器
             function mulberry32(seed) {
                 return function() {
                     let t = seed += 0x6D2B79F5;
                     t = Math.imul(t ^ t &gt;&gt;&gt; 15, t | 1);
                     t ^= t + Math.imul(t ^ t &gt;&gt;&gt; 7, t | 61);
                     return ((t ^ t &gt;&gt;&gt; 14) &gt;&gt;&gt; 0) / 4294967296;
                 };
             }
             
             // 成就展示功能
             function initializeAchievementsDisplay() {
                 // 嘗試從localStorage加載已選擇的成就
                 let selectedAchievements = [];
                 try {
                     const saved = localStorage.getItem(&#39;MemoryMaster_selectedAchievements&#39;);
                     if (saved) {
                         selectedAchievements = JSON.parse(saved);
                     }
                 } catch (e) {
                     console.error(&quot;加載選擇的成就出錯:&quot;, e);
                 }
                 
                 // 更新成就展示
                 updateAchievementsDisplay(selectedAchievements);
                 
                 // 管理成就按鈕點擊事件
                 const manageAchievementsBtn = document.getElementById(&#39;manage-achievements-btn&#39;);
                 if (manageAchievementsBtn) {
                     manageAchievementsBtn.addEventListener(&#39;click&#39;, function() {
                         showAchievementSelector(selectedAchievements);
                     });
                 }
             }
             
             // 更新成就展示
             function updateAchievementsDisplay(selectedAchievements) {
                 const achievementsDisplay = document.getElementById(&#39;achievements-display&#39;);
                 if (!achievementsDisplay) return;
                 
                 // 如果沒有選擇任何成就，顯示提示信息
                 if (!selectedAchievements || selectedAchievements.length === 0) {
                     achievementsDisplay.innerHTML = `
                         &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-400 italic&quot;&gt;從設置菜單的「歷史成就」中選擇展示&lt;/p&gt;
                     `;
                     return;
                 }
                 
                 // 清空現有內容
                 achievementsDisplay.innerHTML = &#39;&#39;;
                 
                 // 創建SVG徽章
                 const createAchievementSVG = (colors, borderColor) =&gt; {
                     const uniqueId = &#39;seal_&#39; + Math.random().toString(36).substr(2, 9);
                     return `
                     &lt;svg viewBox=&quot;0 0 100 100&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
                         &lt;defs&gt;
                             &lt;radialGradient id=&quot;${uniqueId}&quot; cx=&quot;50%&quot; cy=&quot;50%&quot; r=&quot;50%&quot; fx=&quot;50%&quot; fy=&quot;50%&quot;&gt;
                                 &lt;stop offset=&quot;0%&quot; style=&quot;stop-color:${colors.center}&quot; /&gt;
                                 &lt;stop offset=&quot;70%&quot; style=&quot;stop-color:${colors.middle}&quot; /&gt;
                                 &lt;stop offset=&quot;100%&quot; style=&quot;stop-color:${colors.outer}&quot; /&gt;
                             &lt;/radialGradient&gt;
                         &lt;/defs&gt;
                         &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;45&quot; fill=&quot;url(#${uniqueId})&quot; /&gt;
                         &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;42&quot; fill=&quot;none&quot; stroke=&quot;${borderColor}&quot; stroke-width=&quot;1&quot; stroke-dasharray=&quot;2,1&quot; /&gt;
                         &lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;38&quot; fill=&quot;none&quot; stroke=&quot;${borderColor}&quot; stroke-width=&quot;0.5&quot; /&gt;
                     &lt;/svg&gt;
                     `;
                 };
                 
                 // 定義各成就色彩
                 const achievementColors = {
                     &#39;complete&#39;: { colors: { center: &#39;#8B0000&#39;, middle: &#39;#5C0000&#39;, outer: &#39;#400000&#39; }, border: &#39;#FFD700&#39; },
                     &#39;lightning&#39;: { colors: { center: &#39;#4B0082&#39;, middle: &#39;#2A004D&#39;, outer: &#39;#1C0033&#39; }, border: &#39;#00FFFF&#39; },
                     &#39;master&#39;: { colors: { center: &#39;#006400&#39;, middle: &#39;#004D00&#39;, outer: &#39;#003300&#39; }, border: &#39;#7CFC00&#39; },
                     &#39;snail&#39;: { colors: { center: &#39;#8B4513&#39;, middle: &#39;#6B3100&#39;, outer: &#39;#4A2100&#39; }, border: &#39;#DAA520&#39; },
                     &#39;tireless&#39;: { colors: { center: &#39;#1E3A8A&#39;, middle: &#39;#1E40AF&#39;, outer: &#39;#1D4ED8&#39; }, border: &#39;#38BDF8&#39; },
                     &#39;nightOwl&#39;: { colors: { center: &#39;#3E2723&#39;, middle: &#39;#33211B&#39;, outer: &#39;#2E1B15&#39; }, border: &#39;#4E342E&#39; },
                     &#39;badDigestion&#39;: { colors: { center: &#39;#E65100&#39;, middle: &#39;#D84315&#39;, outer: &#39;#BF360C&#39; }, border: &#39;#BF360C&#39; },
                     &#39;dryEyes&#39;: { colors: { center: &#39;#FFCC80&#39;, middle: &#39;#FFA726&#39;, outer: &#39;#EF6C00&#39; }, border: &#39;#0277BD&#39; },
                     &#39;nightOwlKing&#39;: { colors: { center: &#39;#5D4037&#39;, middle: &#39;#3E2723&#39;, outer: &#39;#1B0000&#39; }, border: &#39;#5D4037&#39; },
                     &#39;focusOnEating&#39;: { colors: { center: &#39;#FFFFFF&#39;, middle: &#39;#FFD0B0&#39;, outer: &#39;#FF8A65&#39; }, border: &#39;#E65100&#39; },
                     
                     // 冒險之路
                     &#39;adventure1&#39;: { colors: { center: &#39;#B3E5FC&#39;, middle: &#39;#4FC3F7&#39;, outer: &#39;#0288D1&#39; }, border: &#39;#90CAF9&#39; },
                     &#39;adventure2&#39;: { colors: { center: &#39;#EF5350&#39;, middle: &#39;#E53935&#39;, outer: &#39;#C62828&#39; }, border: &#39;#4CAF50&#39; },
                     &#39;adventure3&#39;: { colors: { center: &#39;#FFD54F&#39;, middle: &#39;#FFC107&#39;, outer: &#39;#FFA000&#39; }, border: &#39;#F4511E&#39; },
                     &#39;adventure4&#39;: { colors: { center: &#39;#BA68C8&#39;, middle: &#39;#AB47BC&#39;, outer: &#39;#8E24AA&#39; }, border: &#39;#673AB7&#39; },
                     &#39;adventure5&#39;: { colors: { center: &#39;#A5D6A7&#39;, middle: &#39;#81C784&#39;, outer: &#39;#4CAF50&#39; }, border: &#39;#FFC107&#39; },
                     
                     // 挫敗之路
                     &#39;defeat1&#39;: { colors: { center: &#39;#D7CCC8&#39;, middle: &#39;#8D6E63&#39;, outer: &#39;#4E342E&#39; }, border: &#39;#7E57C2&#39; },
                     &#39;defeat2&#39;: { colors: { center: &#39;#E3F2FD&#39;, middle: &#39;#90CAF9&#39;, outer: &#39;#1565C0&#39; }, border: &#39;#42A5F5&#39; },
                     &#39;defeat3&#39;: { colors: { center: &#39;#80DEEA&#39;, middle: &#39;#26A69A&#39;, outer: &#39;#004D40&#39; }, border: &#39;#00796B&#39; },
                     &#39;defeat4&#39;: { colors: { center: &#39;#FFE0B2&#39;, middle: &#39;#FFB74D&#39;, outer: &#39;#E65100&#39; }, border: &#39;#F57C00&#39; },
                     &#39;defeat5&#39;: { colors: { center: &#39;#E0F7FA&#39;, middle: &#39;#80DEEA&#39;, outer: &#39;#00838F&#39; }, border: &#39;#D32F2F&#39; },
                     
                     // 極速之路
                     &#39;speed1&#39;: { colors: { center: &#39;#FF5252&#39;, middle: &#39;#D50000&#39;, outer: &#39;#B71C1C&#39; }, border: &#39;#311B92&#39; },
                     &#39;speed2&#39;: { colors: { center: &#39;#FF9800&#39;, middle: &#39;#F57C00&#39;, outer: &#39;#E65100&#39; }, border: &#39;#283593&#39; },
                     &#39;speed3&#39;: { colors: { center: &#39;#00B4D8&#39;, middle: &#39;#0096C7&#39;, outer: &#39;#023E8A&#39; }, border: &#39;#1565C0&#39; },
                     &#39;speed4&#39;: { colors: { center: &#39;#FFEE58&#39;, middle: &#39;#FFD600&#39;, outer: &#39;#F9A825&#39; }, border: &#39;#0277BD&#39; },
                     
                     // 完美之路
                     &#39;perfect1&#39;: { colors: { center: &#39;#80CBC4&#39;, middle: &#39;#4DB6AC&#39;, outer: &#39;#E8F5E9&#39; }, border: &#39;#AD1457&#39; },
                     &#39;perfect2&#39;: { colors: { center: &#39;#F06292&#39;, middle: &#39;#EC407A&#39;, outer: &#39;#AD1457&#39; }, border: &#39;#6A1B9A&#39; },
                     &#39;perfect3&#39;: { colors: { center: &#39;#FFD54F&#39;, middle: &#39;#FFB300&#39;, outer: &#39;#5D4037&#39; }, border: &#39;#4527A0&#39; },
                     &#39;perfect4&#39;: { colors: { center: &#39;#B39DDB&#39;, middle: &#39;#7E57C2&#39;, outer: &#39;#4527A0&#39; }, border: &#39;#283593&#39; },
                     
                     // 記憶之路
                     &#39;memory1&#39;: { colors: { center: &#39;#00E5FF&#39;, middle: &#39;#00B8D4&#39;, outer: &#39;#006064&#39; }, border: &#39;#004D40&#39; },
                     &#39;memory2&#39;: { colors: { center: &#39;#FFD54F&#39;, middle: &#39;#FFB300&#39;, outer: &#39;#F57F17&#39; }, border: &#39;#00838F&#39; },
                     &#39;memory3&#39;: { colors: { center: &#39;#5C6BC0&#39;, middle: &#39;#3949AB&#39;, outer: &#39;#283593&#39; }, border: &#39;#2E7D32&#39; },
                     &#39;memory4&#39;: { colors: { center: &#39;#26C6DA&#39;, middle: &#39;#00ACC1&#39;, outer: &#39;#00838F&#39; }, border: &#39;#558B2F&#39; }
                 };
                 
                 // 顯示選擇的成就
                 selectedAchievements.forEach(achievement =&gt; {
                     const colorInfo = achievementColors[achievement.id];
                     if (!colorInfo) return;
                     
                     const achievementElement = document.createElement(&#39;div&#39;);
                     achievementElement.className = &#39;achievement-seal&#39;;
                     achievementElement.style.width = &#39;70px&#39;;
                     achievementElement.style.height = &#39;70px&#39;;
                     achievementElement.style.margin = &#39;0 5px&#39;;
                     achievementElement.style.transform = &#39;rotate(-5deg)&#39;;
                     
                     achievementElement.innerHTML = `
                         &lt;div style=&quot;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&quot;&gt;
                             ${createAchievementSVG(colorInfo.colors, colorInfo.border)}
                         &lt;/div&gt;
                         &lt;div class=\&quot;seal-text\&quot;&gt;
                         &lt;span class=\&quot;seal-title\&quot;&gt;${achievement.title}
                         &lt;/span&gt;
                         &lt;span class=\&quot;seal-desc\&quot; style=\&quot;font-size: 10px; opacity: 0.9;\&quot;&gt;成就&lt;/span&gt;
                         &lt;/div&gt;
                     `;
                     
                     achievementsDisplay.appendChild(achievementElement);
                 });
             }
             
             // 顯示成就選擇器
             function showAchievementSelector(currentSelected) {
                 // 確保globalStats已初始化
                 if (typeof globalStats !== &#39;object&#39; || globalStats === null) {
                     initializeDefaultStats();
                 }
                 
                 // 創建模態框
                 const modal = document.createElement(&#39;div&#39;);
                 modal.className = &#39;fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]&#39;;
                 modal.id = &#39;achievement-selector-modal&#39;;
                 
                 // 獲取可供選擇的成就
                 const availableAchievements = getAvailableAchievements();
                 
                 // 創建模態框內容
                 modal.innerHTML = `
                     &lt;div class=&quot;bg-white dark:bg-gray-800 rounded-lg p-5 max-w-xl w-full mx-4 max-h-[80vh] overflow-y-auto&quot;&gt;
                         &lt;div class=&quot;flex justify-between items-center mb-4&quot;&gt;
                             &lt;h3 class=&quot;text-xl font-bold text-gray-800 dark:text-gray-100&quot;&gt;展示歷史成就&lt;/h3&gt;
                             &lt;button id=&quot;close-achievement-selector&quot; class=&quot;text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100&quot;&gt;
                                 &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
                             &lt;/button&gt;
                         &lt;/div&gt;
                         
                         &lt;p class=&quot;text-gray-600 dark:text-gray-400 mb-4&quot;&gt;可選擇最多三個歷史成就&lt;/p&gt;
                         
                         &lt;div id=&quot;achievement-list&quot; class=&quot;space-y-4&quot;&gt;
                             &lt;!-- 成就列表將在這裡生成 --&gt;
                         &lt;/div&gt;
                         
                         &lt;div class=&quot;flex justify-end mt-6&quot;&gt;
                             &lt;button id=&quot;save-achievements-btn&quot; class=&quot;px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90&quot;&gt;保存選擇&lt;/button&gt;
                         &lt;/div&gt;
                     &lt;/div&gt;
                 `;
                 
                 document.body.appendChild(modal);
                 
                 // 填充成就列表
                 const achievementList = document.getElementById(&#39;achievement-list&#39;);
                 if (achievementList) {
                     // 組織成就為類別
                     const categories = [
                         {
                             name: &#39;遊戲成就&#39;,
                             achievements: availableAchievements.filter(a =&gt; [&#39;complete&#39;, &#39;lightning&#39;, &#39;master&#39;, &#39;snail&#39;, &#39;tireless&#39;, &#39;nightOwl&#39;, &#39;badDigestion&#39;].includes(a.id))
                         },
                         {
                             name: &#39;冒險之路&#39;,
                             achievements: availableAchievements.filter(a =&gt; a.id.startsWith(&#39;adventure&#39;))
                         },
                         {
                             name: &#39;挫敗之路&#39;,
                             achievements: availableAchievements.filter(a =&gt; a.id.startsWith(&#39;defeat&#39;))
                         },
                         {
                             name: &#39;極速之路&#39;,
                             achievements: availableAchievements.filter(a =&gt; a.id.startsWith(&#39;speed&#39;))
                         },
                         {
                             name: &#39;完美之路&#39;,
                             achievements: availableAchievements.filter(a =&gt; a.id.startsWith(&#39;perfect&#39;))
                         },
                         {
                             name: &#39;記憶之路&#39;,
                             achievements: availableAchievements.filter(a =&gt; a.id.startsWith(&#39;memory&#39;))
                         },
                         {
                             name: &#39;特殊成就&#39;,
                             achievements: availableAchievements.filter(a =&gt; [&#39;dryEyes&#39;, &#39;nightOwlKing&#39;, &#39;focusOnEating&#39;].includes(a.id))
                         }
                     ];
                     
                     // 只顯示有成就的類別
                     categories.forEach(category =&gt; {
                         if (category.achievements.length &gt; 0) {
                             const categoryElement = document.createElement(&#39;div&#39;);
                             categoryElement.className = &#39;mb-6&#39;;
                             categoryElement.innerHTML = `
                                 &lt;h4 class=&quot;text-lg font-medium text-amber-700 dark:text-amber-400 mb-3&quot;&gt;${category.name}&lt;/h4&gt;
                                 &lt;div class=&quot;bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 grid grid-cols-1 md:grid-cols-2 gap-3 category-achievements&quot;&gt;
                                     &lt;!-- 成就將在這裡添加 --&gt;
                                 &lt;/div&gt;
                             `;
                             
                             const achievementsContainer = categoryElement.querySelector(&#39;.category-achievements&#39;);
                             
                             category.achievements.forEach(achievement =&gt; {
                                 const isSelected = currentSelected.some(a =&gt; a.id === achievement.id);
                                 
                                 const achievementItem = document.createElement(&#39;div&#39;);
                                 achievementItem.className = `p-3 border ${isSelected ? &#39;border-primary&#39; : &#39;border-gray-200 dark:border-gray-600&#39;} rounded-lg flex items-center achievement-item ${isSelected ? &#39;selected&#39; : &#39;&#39;}`;
                                 achievementItem.dataset.id = achievement.id;
                                 achievementItem.dataset.title = achievement.title;
                                 
                                 achievementItem.innerHTML = `
                                     &lt;div class=&quot;w-12 h-12 flex-shrink-0 flex items-center justify-center&quot;&gt;
                                         &lt;i class=&quot;${achievement.icon} text-2xl ${isSelected ? &#39;text-primary&#39; : &#39;text-gray-500 dark:text-gray-400&#39;}&quot;&gt;&lt;/i&gt;
                                     &lt;/div&gt;
                                     &lt;div class=&quot;ml-3 flex-1&quot;&gt;
                                         &lt;p class=&quot;font-medium text-gray-800 dark:text-gray-200&quot;&gt;${achievement.title}&lt;/p&gt;
                                         &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-400&quot;&gt;${achievement.description}&lt;/p&gt;
                                     &lt;/div&gt;
                                 `;
                                 
                                 achievementsContainer.appendChild(achievementItem);
                                 
                                 // 添加點擊事件
                                     achievementItem.addEventListener(&#39;click&#39;, function() {
                                     const isCurrentlySelected = this.classList.contains(&#39;selected&#39;);
                                     const isNowSelected = !isCurrentlySelected;
                                     
                                     // 獲取當前選中的成就數量
                                     const selectedCount = document.querySelectorAll(&#39;.achievement-item.selected&#39;).length;
                                     
                                     // 如果選中數量已經達到3個且當前操作是選中，則不進行操作
                                     if (selectedCount &gt;= 3 &amp;&amp; isNowSelected &amp;&amp; !isCurrentlySelected) {
                                         alert(&#39;最多只能選擇3個成就&#39;);
                                         return;
                                     }
                                     
                                 // 更新選中狀態
                                     if (isNowSelected) {
                                         this.classList.add(&#39;selected&#39;);
                                         this.classList.remove(&#39;border-gray-200&#39;, &#39;dark:border-gray-600&#39;);
                                         this.classList.add(&#39;border-primary&#39;);
                                         this.querySelector(&#39;i&#39;).classList.remove(&#39;text-gray-500&#39;, &#39;dark:text-gray-400&#39;);
                                         this.querySelector(&#39;i&#39;).classList.add(&#39;text-primary&#39;);
                                     } else {
                                         this.classList.remove(&#39;selected&#39;);
                                         this.classList.add(&#39;border-gray-200&#39;, &#39;dark:border-gray-600&#39;);
                                         this.classList.remove(&#39;border-primary&#39;);
                                         this.querySelector(&#39;i&#39;).classList.add(&#39;text-gray-500&#39;, &#39;dark:text-gray-400&#39;);
                                         this.querySelector(&#39;i&#39;).classList.remove(&#39;text-primary&#39;);
                                     }
                                 });
                             });
                             
                             achievementList.appendChild(categoryElement);
         
                         }
                     });
                     
                     // 如果沒有可用成就
                     if (availableAchievements.length === 0) {
                         achievementList.innerHTML = `
                             &lt;div class=&quot;text-center p-6&quot;&gt;
                                 &lt;i class=&quot;fas fa-medal text-gray-300 dark:text-gray-600 text-4xl mb-3&quot;&gt;&lt;/i&gt;
                                 &lt;p class=&quot;text-gray-600 dark:text-gray-400&quot;&gt;您還沒有獲得任何成就&lt;/p&gt;
                                 &lt;p class=&quot;text-sm text-gray-500 dark:text-gray-500 mt-2&quot;&gt;完成更多挑戰來獲得成就！&lt;/p&gt;
                             &lt;/div&gt;
                         `;
                     }
                 }
                 
                 // 關閉按鈕事件
                 const closeBtn = document.getElementById(&#39;close-achievement-selector&#39;);
                 if (closeBtn) {
                     closeBtn.addEventListener(&#39;click&#39;, function() {
                         document.body.removeChild(modal);
                     });
                 }
                 
                 // 點擊背景關閉
                 modal.addEventListener(&#39;click&#39;, function(e) {
                     if (e.target === modal) {
                         document.body.removeChild(modal);
                     }
                 });
                 
                 // 保存按鈕事件
                 const saveBtn = document.getElementById(&#39;save-achievements-btn&#39;);
                 if (saveBtn) {
                     saveBtn.addEventListener(&#39;click&#39;, function() {
                         // 獲取選中的成就
                         const selectedItems = document.querySelectorAll(&#39;.achievement-item.selected&#39;);
                         const selected = [];
                         
                         selectedItems.forEach(item =&gt; {
                             selected.push({
                                 id: item.dataset.id,
                                 title: item.dataset.title
                             });
                         });
                         
                         // 保存到localStorage
                         try {
                             localStorage.setItem(&#39;MemoryMaster_selectedAchievements&#39;, JSON.stringify(selected));
                         } catch (e) {
                             console.error(&quot;保存選擇的成就出錯:&quot;, e);
                         }
                         
                         // 更新顯示
                         updateAchievementsDisplay(selected);
                         
                         // 關閉模態框
                         document.body.removeChild(modal);
                     });
                 }
             }
             
             // 獲取可用成就
             function getAvailableAchievements() {
                 const achievements = [];
                 
                 // 特殊累積成就
                 if (globalStats.achievements.dryEyes) {
                     achievements.push({ id: &#39;dryEyes&#39;, title: &#39;眼乾&#39;, description: &#39;獲得不知疲倦30次&#39;, icon: &#39;fas fa-eye&#39; });
                 }
                 
                 if (globalStats.achievements.nightOwlKing) {
                     achievements.push({ id: &#39;nightOwlKing&#39;, title: &#39;夜貓王&#39;, description: &#39;獲得夜貓20次&#39;, icon: &#39;fas fa-crown&#39; });
                 }
                 
                 if (globalStats.achievements.focusOnEating) {
                     achievements.push({ id: &#39;focusOnEating&#39;, title: &#39;請專心吃飯&#39;, description: &#39;獲得腸胃不好20次&#39;, icon: &#39;fas fa-drumstick-bite&#39; });
                 }
                 
                 // 冒險之路成就
                 const adventureLevels = [&#39;初心者&#39;, &#39;勇者&#39;, &#39;大師&#39;, &#39;偏執狂&#39;, &#39;掃地僧&#39;];
                 const adventureRequirements = [1, 10, 50, 150, 300];
                 const adventureIcons = [&#39;fas fa-hiking&#39;, &#39;fas fa-running&#39;, &#39;fas fa-dragon&#39;, &#39;fas fa-atom&#39;, &#39;fas fa-broom&#39;];
                 
                 for (let i = 0; i &lt; globalStats.achievements.adventureLevel; i++) {
                     achievements.push({
                         id: `adventure${i+1}`,
                         title: adventureLevels[i],
                         description: `完成${adventureRequirements[i]}次挑戰`,
                         icon: adventureIcons[i]
                     });
                 }
                 
                 // 挫敗之路成就
                 const defeatLevels = [&#39;初嘗敗績&#39;, &#39;堅毅&#39;, &#39;鋼鐵意志&#39;, &#39;小強是我&#39;, &#39;心如止水&#39;];
                 const defeatRequirements = [1, 5, 30, 50, 100];
                 const defeatIcons = [&#39;fas fa-dizzy&#39;, &#39;fas fa-fist-raised&#39;, &#39;fas fa-shield-alt&#39;, &#39;fas fa-bug&#39;, &#39;fas fa-water&#39;];
                 
                 for (let i = 0; i &lt; globalStats.achievements.defeatLevel; i++) {
                     achievements.push({
                         id: `defeat${i+1}`,
                         title: defeatLevels[i],
                         description: `失敗${defeatRequirements[i]}次`,
                         icon: defeatIcons[i]
                     });
                 }
                 
                 // 極速之路成就
                 const speedLevels = [&#39;敏捷&#39;, &#39;肌肉記憶&#39;, &#39;無影手&#39;, &#39;世界第一束光&#39;];
                 const speedRequirements = [1, 10, 50, 100];
                 const speedIcons = [&#39;fas fa-tachometer-alt&#39;, &#39;fas fa-dumbbell&#39;, &#39;fas fa-hand-paper&#39;, &#39;fas fa-lightbulb&#39;];
                 
                 for (let i = 0; i &lt; globalStats.achievements.speedRouteLevel; i++) {
                     achievements.push({
                         id: `speed${i+1}`,
                         title: speedLevels[i],
                         description: `獲得閃電俠${speedRequirements[i]}次`,
                         icon: speedIcons[i]
                     });
                 }
                 
                 // 完美之路成就
                 const perfectLevels = [&#39;如沐春風&#39;, &#39;完美主義&#39;, &#39;滿月&#39;, &#39;至善&#39;];
                 const perfectRequirements = [1, 10, 50, 100];
                 const perfectIcons = [&#39;fas fa-wind&#39;, &#39;fas fa-ruler&#39;, &#39;fas fa-circle&#39;, &#39;fas fa-dove&#39;];
                 
                 for (let i = 0; i &lt; globalStats.achievements.perfectRouteLevel; i++) {
                     achievements.push({
                         id: `perfect${i+1}`,
                         title: perfectLevels[i],
                         description: `獲得完美無瑕${perfectRequirements[i]}次`,
                         icon: perfectIcons[i]
                     });
                 }
                 
                 // 記憶之路成就
                 const memoryLevels = [&#39;激活腦細胞&#39;, &#39;記憶麵包&#39;, &#39;移動圖書館&#39;, &#39;流如背倒&#39;];
                 const memoryRequirements = [1, 10, 30, 50];
                 const memoryIcons = [&#39;fas fa-brain&#39;, &#39;fas fa-bread-slice&#39;, &#39;fas fa-book&#39;, &#39;fas fa-stream&#39;];
                 
                 for (let i = 0; i &lt; globalStats.achievements.memoryRouteLevel; i++) {
                     achievements.push({
                         id: `memory${i+1}`,
                         title: memoryLevels[i],
                         description: `獲得記憶大師${memoryRequirements[i]}次`,
                         icon: memoryIcons[i]
                     });
                 }
                 
                 return achievements;
             }
             
             console.log(&quot;初始化完成&quot;);
         });
      &lt;/script&gt;
      &lt;script&gt;
         // 全屏控制逻辑
         function toggleFullscreen() {
           if (!document.fullscreenElement) {
             document.documentElement.requestFullscreen();
           } else {
             document.exitFullscreen();
           }
         }
         
         // 监听全屏变化
         document.addEventListener(&#39;fullscreenchange&#39;, () =&gt; {
           if (!document.fullscreenElement) {
             // 退出全屏后的处理
             console.log(&#39;已退出全屏模式&#39;);
           }
         });
      &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;
